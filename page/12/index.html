<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"swzxsyh.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="swzxsyh">
<meta property="og:url" content="https://swzxsyh.github.io/page/12/index.html">
<meta property="og:site_name" content="swzxsyh">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="swzxsyh">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://swzxsyh.github.io/page/12/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>swzxsyh</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="swzxsyh" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">swzxsyh</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">--笔记</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-rss">

    <a href="/atom.xml" rel="section"><i class="fa fa-rss fa-fw"></i>RSS</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swzxsyh.github.io/2020/07/13/SpringCloud%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="swzxsyh">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="swzxsyh">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/13/SpringCloud%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">SpringCloud入门</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-13 01:53:41" itemprop="dateCreated datePublished" datetime="2020-07-13T01:53:41+08:00">2020-07-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-10 04:40:38" itemprop="dateModified" datetime="2022-08-10T04:40:38+08:00">2022-08-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一.SpringCloud介绍<br>1.1 介绍<br>Spring Cloud是在Spring Boot的基础上构建的，用于简化分布式系统构建的工具集。该工具集为微服务架构中所涉及的配置管理、服务发现、智能路由、熔断器、控制总线等操作提供了一种简单的开发方式。也就是说Spring Cloud把非常流行的微服务的技术（组件）整合到一起，方便开发。</p>
<p>注册中心：Eureka<br>负载均衡：Ribbon<br>熔断器：Hystrix<br>服务通信：Feign<br>网关：Gateway<br>配置中心 ：config<br>消息总线：Bus</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/07/13/SpringCloud%E5%85%A5%E9%97%A8/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swzxsyh.github.io/2020/07/11/SpringBoot%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="swzxsyh">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="swzxsyh">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/07/11/SpringBoot%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">SpringBoot入门</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-07-11 01:53:05" itemprop="dateCreated datePublished" datetime="2020-07-11T01:53:05+08:00">2020-07-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-10 04:40:38" itemprop="dateModified" datetime="2022-08-10T04:40:38+08:00">2022-08-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一.SpringBoot简介<br>1.1 Spring Boot 整合了所有的框架以及中间件<br>SpringBoot不是对Spring功能的增强，而是提供一种快速使用Spring的开发方式。</p>
<p>springboot与第三方框架以及MOM（中间件 MQ、Redis）进行了集成（整合）<br>开发过程中简化开发:<br>无需编写框架相关以及框架整合配置文件了<br>jar无需管理<br>springboot开发的程序：<br>只需要“run”一下就能发布一个应用（项目启动起来）—内嵌tomcat<br>建议打jar包<br>1.2 小结：<br>快速构建项目（引入jar依赖）<br>对主流开发框架的无配置集成（开箱即用）<br>项目可独立运行，无需依赖外部的servlet容器（tomcat）<br>提供运行时的应用监控【dubbo admin】<br>极大的提高了开发效率、部署效率</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/07/11/SpringBoot%E5%85%A5%E9%97%A8/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swzxsyh.github.io/2020/06/19/Apache-Dubbo-%E5%88%9D%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="swzxsyh">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="swzxsyh">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/19/Apache-Dubbo-%E5%88%9D%E8%AF%86/" class="post-title-link" itemprop="url">Apache Dubbo 初识</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-19 01:52:09" itemprop="dateCreated datePublished" datetime="2020-06-19T01:52:09+08:00">2020-06-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-10 04:40:38" itemprop="dateModified" datetime="2022-08-10T04:40:38+08:00">2022-08-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一.应用架构的演进过程<br>目标</p>
<p>了解软件架构的演进过程</p>
<p>学习路径</p>
<p>主流的互联网技术特点<br>架构演变的过程<br>单体架构<br>垂直架构<br>分布式服务架构<br>SOA架构<br>微服务架构<br>1.1 主流的互联网技术特点<br>分布式 、高并发、集群、负载均衡、高可用。</p>
<p>分布式：一件事情拆开来做。</p>
<p>集群：一件事情所有服务器一起做。</p>
<p>负载均衡：将请求平均分配到不同的服务器中，达到均衡的目的。</p>
<p>高并发：同一时刻，处理同一件事情的处理能力（解决方案：分布式、集群、负载均衡）</p>
<p>高可用：系统都是可用的。</p>
<p>1.2. 架构演变的过程<br>1.2.1 单一应用架构（all in one）<br>当网站流量很小时，只需一个应用，将所有功能都部署在一起，以减少部署节点和成本。此时，用于简化增删改查工作量的数据访问框架(ORM)是关键。</p>
<p>架构优点：</p>
<p>架构简单，前期开发成本低、开发周期短，适合小型项目（OA、CRM、ERP 企业内部应用）。</p>
<p>架构缺点：</p>
<p>全部功能集成在一个工程中</p>
<p>业务代码耦合度高，不易维护。</p>
<p>维护成本高，不易拓展</p>
<p>并发量大，不易解决</p>
<p>技术栈受限，只能使用一种语言开发。</p>
<p>1.2.2 垂直应用架构<br>当访问量逐渐增大，单一应用增加机器带来的加速度越来越小，将应用拆成互不相干的几个应用，以提升效率。此时，用于加速前端页面开发的Web框架(MVC)是关键。</p>
<p>架构优点：</p>
<p>业务代码相对解耦</p>
<p>维护成本相对易于拓展（修改一个功能，可以直接修改一个项目，单独部署）</p>
<p>并发量大相对易于解决（搭建集群）</p>
<p>技术栈可扩展（不同的系统可以用不同的编程语言编写）。</p>
<p>架构缺点：</p>
<p>功能集中在一个项目中，不利于开发、扩展、维护。</p>
<p>代码之间存在数据、方法的冗余</p>
<p>1.2.3 分布式服务架构<br>当垂直应用越来越多，应用之间交互不可避免，将核心业务抽取出来，作为独立的服务，逐渐形成稳定的服务中心，使前端应用能更快速的响应多变的市场需求。此时，用于提高业务复用及整合的分布式服务框架(RPC)是关键。</p>
<p>架构优点：</p>
<p>业务代码完全解耦，并可实现通用</p>
<p>维护成本易于拓展（修改一个功能，可以直接修改一个项目，单独部署）</p>
<p>并发量大易于解决（搭建集群）</p>
<p>技术栈完全扩展（不同的系统可以用不同的编程语言编写）。</p>
<p>架构缺点：</p>
<p>缺少统一管理资源调度的框架</p>
<p>1.2.4 流动计算架构（SOA）<br>当服务越来越多，容量的评估，小服务资源的浪费等问题逐渐显现，此时需增加一个调度中心基于访问压力实时管理集群容量，提高集群利用率。此时，用于提高机器利用率的资源调度和治理中心(SOA)是关键。</p>
<p>架构优点<br>业务代码完全解耦，并可实现通用<br>维护成本易于拓展（修改一个功能，可以直接修改一个项目，单独部署）<br>并发量大易于解决（搭建集群）<br>技术栈完全扩展（不同的系统可以用不同的编程语言编写）。<br>框架实现了服务治理，不去担心集群的使用情况(失败会尝试其它服务….)<br>1.2.5 小结<br>单体架构</p>
<p>全部功能集中在一个项目内（All in one）。</p>
<p>垂直架构</p>
<p>按照业务进行切割，形成小的单体项目。</p>
<p>分布式</p>
<p>应用调用服务，服务挂了，有其它可用，缺少服务治理</p>
<p>SOA架构</p>
<p>服务的提供者（以服务为主 service调用dao-&gt;数据库），消费者。<br>服务提供者与消费都注册到中心，由中心统一管理分配，失败重试，负载均衡。。。有服务治理<br>可以使用dubbo作为调度的工具（RPC协议）, Zookeeper作为注册中心<br>微服务架构</p>
<p>将系统服务层完全独立出来，抽取为一个一个的微服务。 以功能为主(controller-&gt;service-dao-&gt;数据库 独立)<br>特点一：抽取的粒度更细，遵循单一原则，数据可以在服务之间完成数据传输（一般使用restful请求调用资源）。<br>特点二： 采用轻量级框架协议传输。（可以使用spring cloud）（http协议 restful json）<br>特点三： 每个服务都使用不同的数据库，完全独立和解耦 (分库分表)。<br>二.RPC（远程过程调用）<br>目标</p>
<p>了解什么是RPC</p>
<p>学习路径</p>
<p>RPC介绍</p>
<p>RPC组件</p>
<p>RPC调用</p>
<p>2.1 RPC介绍<br>​ Remote Procedure Call 远程过程调用，是分布式架构的核心，按响应方式分如下两种：</p>
<p> 同步调用：客户端调用服务方方法，等待直到服务方返回结果或者超时，再继续自己的操作。</p>
<p> 异步调用：客户端把消息发送给中间件，不再等待服务端返回，直接继续自己的操作。</p>
<p>是一种进程间的通信方式</p>
<p>它允许应用程序调用网络上的另一个应用程序中的方法</p>
<p>对于服务的消费者而言，无需了解远程调用的底层细节，是透明的</p>
<p>需要注意的是RPC并不是一个具体的技术，而是指整个网络远程调用过程。</p>
<p>RPC是一个泛化的概念，严格来说一切远程过程调用手段都属于RPC范畴。各种开发语言都有自己的RPC框架。Java中的RPC框架比较多，广泛使用的有RMI、Hessian、Dubbo、spring Cloud(restapi http)等。</p>
<p>2.2 RPC组件<br>RPC架构里包含如下4个组件:</p>
<p>客户端(Client)：服务调用者<br>客户端存根(Client Stub)：存放服务端地址信息，将客户端的请求参数打包成网络消息，再通过网络发送给服务方<br>服务端存根(Server Stub)：接受客户端发送过来的消息并解包，再调用本地服务<br>服务端(Server)：服务提供者。<br>2.3 RPC调用<br>服务调用方（client）调用以本地调用方式调用服务；<br>client stub接收到调用后负责将方法、参数等组装成能够进行网络传输的消息体在Java里就是序列化的过程<br>client stub找到服务地址，并将消息通过网络发送到服务端；<br>server stub收到消息后进行解码,在Java里就是反序列化的过程；<br>server stub根据解码结果调用本地的服务；<br>本地服务执行处理逻辑；<br>本地服务将结果返回给server stub；<br>server stub将返回结果打包成消息，Java里的序列化；<br>server stub将打包后的消息通过网络并发送至消费方；<br>client stub接收到消息，并进行解码, Java里的反序列化；<br>服务调用方（client）得到最终结果。<br>2.3.1 小结<br>RPC 远程过程调用： 一台电脑调用另一台电脑上的方法<br>RPC组件及调用过程 客户端-&gt;客户端存根(序列化(发送)与反序列化(接收),服务端信息)-&gt;服务端存根(接收-反序列，返回结果-序列化)-&gt;服务端真正的方法<br>调用方式：调用方用的是接口，服务方是真正的实现<br>三.Apache Dubbo概述<br>目标</p>
<p>了解什么是dubbo</p>
<p>学习路径</p>
<p>dubbo简介<br>dubbo架构<br>3.1. Dubbo简介<br>Apache Dubbo是一款高性能的Java RPC框架。其前身是阿里巴巴公司开源的一个高性能、轻量级的开源Java RPC框架，可以和Spring框架无缝集成。</p>
<p>Dubbo官网地址：<a target="_blank" rel="noopener" href="http://dubbo.apache.org/">http://dubbo.apache.org</a></p>
<p>Dubbo提供了三大核心能力：面向接口的远程方法调用，智能容错和负载均衡，以及服务自动注册和发现。</p>
<p>3.2. Dubbo架构</p>
<p>虚线都是异步访问，实线都是同步访问<br>蓝色:在启动时完成的功能<br>红色虚线(实线)都是程序运行过程中执行的功能</p>
<p>节点	角色名称<br>Provider	暴露服务的服务提供方 服务方<br>Consumer	调用远程服务的服务消费方 调用方<br>Registry	服务注册与发现的注册中心<br>Monitor	统计服务的调用次数和调用时间的监控中心<br>Container	服务运行容器<br>调用关系说明:</p>
<p>服务容器负责启动，加载，运行服务提供者。<br>服务提供者在启动时，向注册中心注册自己提供的服务。<br>服务消费者在启动时，向注册中心订阅自己所需的服务。<br>注册中心返回服务提供者地址列表给消费者，如果有变更，注册中心将基于长连接推送变更数据给消费者。<br>服务消费者，从提供者地址列表中，基于软负载均衡算法，选一台提供者进行调用，如果调用失败，再选另一台调用。<br>服务消费者和提供者，在内存中累计调用次数和调用时间，定时每分钟发送一次统计数据到监控中心。<br>什么是长连接</p>
<p>长连接多用于操作频繁，点对点的通讯，而且连接数不能太多情况。每个TCP连接都需要三步握手，这需要时间，如果每个操作都是短连接，再操作的话那么处理速度会降低很多，所以每个操作完后都不断开，下次处理时直接发送数据包就OK了，不用建立TCP连接。</p>
<p>3.3 小结<br>dubbo 远程调用框架 RPC</p>
<p>dubbo架构</p>
<p> 角色： 客户端与服务提供方 监控器注册中心</p>
<p> 组员：服务消费端（调用者），服务提供方（容器）, 注册中心, 监控中心(负载均衡)</p>
<p>四.Dubbo快速开发<br>目标</p>
<p>使用dubbo，完成服务消费者，调用，服务提供者方法</p>
<p>操作路径</p>
<p>环境准备<br>创建父工程（dubbo_parent) 依赖管理<br>创建公共子模块(dubbo_common) 实体类<br>创建接口子模块(dubbo_interface)<br>创建服务提供者模块(dubbo_provider) 对接口的实现<br>创建服务消费者模块(dubbo_consumer) 引用接口<br>Zookeeper中存放Dubbo服务结构(注册中心)<br>讲解</p>
<p>Dubbo作为一个RPC框架，其最核心的功能就是要实现跨网络的远程调用，服务提供者、服务消费者会使用共同的接口，故本小节先创建一个父工程，父工程下有4个子模块，一个是公共子模块，一个是接口模块，一个是服务提供者模块，一个是服务消费者模块。通过Dubbo来实现服务消费方远程调用服务提供方的方法。</p>
<p>实现的业务为：根据id查询用户对象</p>
<p>业务描述：页面发送请求：user&#x2F;findById.do?id&#x3D;1 根据id从数据库获取用户对象</p>
<p>实现步骤：</p>
<p>环境准备：创建数据库，创建t_user表<br>创建父工程，基于maven，打包方式为pom，工程名：dubbo_parent<br>创建公共子模块,创建user实体类，打包方式为jar，工程名:dubbo_common<br>创建接口子模块，在父工程的基础上，打包方式为jar，模块名：dubbo_interface<br>创建服务提供者子模块，在父工程的基础上，打包方式为war，模块名：dubbo_provider<br>创建服务消费者模子块，在父工程的基础上，打包方式为war，模块名：dubbo_consumer<br>4.1 环境准备</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database itcastdubbo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `t_user` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `age` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) </span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_user(username,age) <span class="keyword">VALUES</span>(&quot;张三&quot;,<span class="number">22</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_user(username,age) <span class="keyword">VALUES</span>(&quot;李四&quot;,<span class="number">20</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_user(username,age) <span class="keyword">VALUES</span>(&quot;王五&quot;,<span class="number">25</span>);</span><br></pre></td></tr></table></figure>


<p>4.2 创建父工程<br>父工程，不实现任何代码，主要是添加工程需要的库的依赖管理（DependencyManagement），依赖管理就是解决项目中多个模块间公共依赖的版本号、scope的控制范围。</p>
<p>本项目需要使用spring-webmvc，使用dubbo（务必2.6.2以上版本）、zookeeper及其客户端（curator-framework）、Spring、Mybatis依赖库。</p>
<p>创建结构</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">./</span><br><span class="line">├── dubbo_common</span><br><span class="line">│   ├── dubbo_common.iml</span><br><span class="line">│   ├── pom.xml</span><br><span class="line">│   └── src</span><br><span class="line">│       ├── main</span><br><span class="line">│       └── <span class="built_in">test</span></span><br><span class="line">├── dubbo_consumer</span><br><span class="line">│   ├── pom.xml</span><br><span class="line">│   └── src</span><br><span class="line">│       ├── main</span><br><span class="line">│       └── <span class="built_in">test</span></span><br><span class="line">├── dubbo_interface</span><br><span class="line">│   ├── pom.xml</span><br><span class="line">│   └── src</span><br><span class="line">│       ├── main</span><br><span class="line">│       └── <span class="built_in">test</span></span><br><span class="line">├── dubbo_parent.iml</span><br><span class="line">├── dubbo_provider</span><br><span class="line">│   ├── pom.xml</span><br><span class="line">│   └── src</span><br><span class="line">│       ├── main</span><br><span class="line">│       └── <span class="built_in">test</span></span><br><span class="line">└── pom.xml</span><br><span class="line">dubbo_parent pom.xml增加依赖</span><br></pre></td></tr></table></figure>



<p>详细信息<br>4.3 公共子模块 —— dubbo-common<br>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo_common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br></pre></td></tr></table></figure>


<p>创建User实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Integer id;</span><br><span class="line">  <span class="keyword">private</span> String username;</span><br><span class="line">  <span class="keyword">private</span> Integer age;</span><br><span class="line">  <span class="comment">//此处省略getter/setter/toString</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>4.4 接口子模块 —— dubbo_interface<br>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo_interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo_common<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>


<p>UserService</p>
<p>1<br>2<br>3<br>public interface UserService {<br>    User findById(Integer id);<br>}<br>4.5 服务提供者模块<br>此模块是服务提供者模块，需要在容器启动时，把服务注册到zookeeper,故需要引入spring-webmvc,zookeeper及客户端依赖。</p>
<p>使用war 方式，需要依赖dubbo_interface</p>
<p>结构</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">./</span><br><span class="line">├── pom.xml</span><br><span class="line">└── src</span><br><span class="line">├── main</span><br><span class="line">│   ├── java</span><br><span class="line">│   │   └── com</span><br><span class="line">│   │       └── <span class="built_in">test</span></span><br><span class="line">│   │           ├── dao</span><br><span class="line">│   │           │   └── UserDao.java</span><br><span class="line">│   │           └── service</span><br><span class="line">│   │               └── impl</span><br><span class="line">│   │                   └── UserServiceImpl.java</span><br><span class="line">│   ├── resources</span><br><span class="line">│   │   ├── com</span><br><span class="line">│   │   │   └── <span class="built_in">test</span></span><br><span class="line">│   │   │       └── dao</span><br><span class="line">│   │   │           └── UserDao.xml</span><br><span class="line">│   │   ├── jdbc.properties</span><br><span class="line">│   │   ├── spring-dao.xml</span><br><span class="line">│   │   ├── spring-provider.xml</span><br><span class="line">│   │   └── spring-service.xml</span><br><span class="line">│   └── webapp</span><br><span class="line">│       └── WEB-INF</span><br><span class="line">│           └── web.xml</span><br><span class="line">└── <span class="built_in">test</span></span><br><span class="line">└── java</span><br></pre></td></tr></table></figure>

<p>4.5.1 配置dubbo_provider依赖<br>pom.xml</p>
<p>详细信息<br>4.5.2 初始化java资源目录<br>UserDao</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">  User <span class="title function_">findById</span><span class="params">(Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>UserServiceImpl</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;<span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">findById</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line"><span class="keyword">return</span> userDao.findById(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>}<br>在resource下创建com&#x2F;test&#x2F;dao目录，创建UserDao接口的映射文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">mapper</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.test.dao.UserDao&quot;</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span> ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.test.pojo.User&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">  select * from t_user where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

4.5.3 初始化resources目录
spring-dao.xml

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  加载jdbc配置文件   --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 数据源   --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.user&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 工厂 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;typeAliasesPackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.test.pojo&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- dao扫描   --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.test.dao&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>


<p>jdbc.properties</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jdbc.driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">jdbc.url</span>=<span class="string">jdbc:mysql://localhost:3306/itcastdubbo</span></span><br><span class="line"><span class="attr">jdbc.user</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">jdbc.password</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">spring-service.xml</span></span><br></pre></td></tr></table></figure>



<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--  事务管理器  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  事务注解  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">tx:annotation-driven</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  注入dao  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;classpath:spring-dao.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>


<p>spring-provider.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://dubbo.apache.org/schema/dubbo&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  发布服务的名称  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">&quot;dubbo_provider&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  注册中心zookeeper:--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">&quot;zookeeper://127.0.0.1:2181&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- service:  注册上去服务</span></span><br><span class="line"><span class="comment">interface： 发布服务的接口</span></span><br><span class="line"><span class="comment">ref: spring容器的bean对象</span></span><br><span class="line"><span class="comment">将来通过这个interface调用服务时，就来调用spring容器中的对象的方法</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">&quot;com.test.service.UserService&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;userService&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  服务真正的执行者  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.test.service.impl.UserServiceImpl&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  注入spring-service.xml  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;classpath:spring-service.xml&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--发布dubbo协议，默认端口20880--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">&quot;dubbo&quot;</span> <span class="attr">port</span>=<span class="string">&quot;20881&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 超时时间 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dubbo:provider</span> <span class="attr">timeout</span>=<span class="string">&quot;100000&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

log4j.properties

<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### direct log messages to stdout ###</span></span><br><span class="line"></span><br><span class="line"><span class="attr">log4j.appender.stdout</span>=<span class="string">org.apache.log4j.ConsoleAppender</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.Target</span>=<span class="string">System.err</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.stdout.layout.ConversionPattern</span>=<span class="string">%d&#123;ABSOLUTE&#125; %5p %c&#123;1&#125;:%L - %m%n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### direct messages to file mylog.log ###</span></span><br><span class="line"></span><br><span class="line"><span class="attr">log4j.appender.file</span>=<span class="string">org.apache.log4j.FileAppender</span></span><br><span class="line"><span class="attr">log4j.appender.file.File</span>=<span class="string">c:\\mylog.log</span></span><br><span class="line"><span class="attr">log4j.appender.file.layout</span>=<span class="string">org.apache.log4j.PatternLayout</span></span><br><span class="line"><span class="attr">log4j.appender.file.layout.ConversionPattern</span>=<span class="string">%d&#123;ABSOLUTE&#125; %5p %c&#123;1&#125;:%L - %m%n</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">### set log levels - for more verbose logging change &#x27;info&#x27; to &#x27;debug&#x27; ###</span></span><br><span class="line"></span><br><span class="line"><span class="attr">log4j.rootLogger</span>=<span class="string">debug, stdout</span></span><br></pre></td></tr></table></figure>

<p>4.5.4 启动项目<br>只要能启动spring的容器（加载spring的配置文件）就可以启动项目，因此有2种方式</p>
<p>ClassPathXmlApplication</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProviderApplication</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;classpath:spring-provider.xml&quot;</span>);</span><br><span class="line">    System.in.read();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>监听器与springMVC</p>
<p>web.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;2.5&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 方式一: listener 启动spring容器</span></span><br><span class="line"><span class="comment">&lt;context-param&gt;</span></span><br><span class="line"><span class="comment">    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span></span><br><span class="line"><span class="comment">    &lt;param-value&gt;classpath:spring-provider.xml&lt;/param-value&gt;</span></span><br><span class="line"><span class="comment">&lt;/context-param&gt;</span></span><br><span class="line"><span class="comment">&lt;listener&gt;</span></span><br><span class="line"><span class="comment">    &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;</span></span><br><span class="line"><span class="comment">&lt;/listener&gt;</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 方式二: 启动mvc的核心控制器   --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-provider.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>4<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

4.5.5 注册中心验证
启动zookeeper，作为dubbo的注册中心

<p>登录zookeeper客户端，直接查看ls &#x2F;dubbo&#x2F;com.test.service.UserService节点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 34] <span class="built_in">ls</span> /dubbo/com.test.service.UserService</span><br><span class="line">[configurators, providers]</span><br></pre></td></tr></table></figure>


<p>如果 &#x2F;dubbo下面没有这个节点，说明没有注册上，</p>
<p>如果有，内容是空，说明已经掉线</p>
<p>正常注册并连接在线</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 35] <span class="built_in">ls</span> /dubbo/com.test.service.UserService/providers</span><br><span class="line">[dubbo%3A%2F%2F10.254.4.87%3A20880%2Fcom.test.service.UserService%3Fanyhost%3Dtrue%26application%3Ddubbo_provide%26dubbo%3D2.6.2%26generic%3Dfalse%26interface%3Dcom.test.service.UserService%26methods%3DfindById%26pid%3D33771%26revision%3D1.0-SNAPSHOT%26side%3Dprovider%26timestamp%3D1592563739288]</span><br></pre></td></tr></table></figure>


<p>注意：</p>
<p>消费者与提供者应用名称不能相同</p>
<p>如果有多个服务提供者，名称不能相同，通信端口也不能相同</p>
<p>只有服务提供者才会配置服务发布的协议，默认是dubbo协议，端口号是20880</p>
<p>可以在spring-dubbo.xml中配置协议的端口</p>
<p>4.6 服务消费者模块<br>此模块是服务消费者模块，此模块基于是Web应用，需要引入spring-webmvc，需要在容器启动时，去zookeeper注册中心订阅服务,需要引入dubbo、zookeeper及客户端依赖。</p>
<p>4.6.1 子模块dubbo_consumer导包<br>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo_consumer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo_interface<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-framework<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-recipes<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>4.6.2 初始化java资源目录<br>UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Reference(loadbalance = &quot;roundrobin&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestMapping(&quot;/findById&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> User <span class="title function_">findById</span><span class="params">(Integer id)</span>&#123;</span><br><span class="line">    <span class="comment">// 调用服务</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.findById(id);</span><br><span class="line">    <span class="comment">// 返回json数据</span></span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>}<br>4.6.3 初始化resources资源目录<br>spring-dubbo.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns:dubbo</span>=<span class="string">&quot;http://dubbo.apache.org/schema/dubbo&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://dubbo.apache.org/schema/dubbo http://dubbo.apache.org/schema/dubbo/dubbo.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  发布的名称  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">&quot;dubbo_consumer&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  注册中心  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">&quot;zookeeper://127.0.0.1:2181&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  服务订阅扫包</span></span><br><span class="line"><span class="comment">      (2.6.0 事务问题)使用了服务的那controller的包, springmvc中的controller也不需要扫包了</span></span><br><span class="line"><span class="comment">      &lt;dubbo:reference&gt;就不要了</span></span><br><span class="line"><span class="comment">      在controller的服务注入使用@Reference(dubbo)</span></span><br><span class="line"><span class="comment">  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dubbo:annotation</span> <span class="attr">package</span>=<span class="string">&quot;com.test&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  id的值必须与controller中的@autowired的属性名称要一致</span></span><br><span class="line"><span class="comment">    &lt;dubbo:reference interface=&quot;com.test.service.UserService&quot; id=&quot;userService&quot;/&gt;</span></span><br><span class="line"><span class="comment">   --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  启动时是否检查服务提供者是否存在，true: 则会检查【上线时】，没有则报错。false不检查</span></span><br><span class="line"><span class="comment">     retries: 失败后的重试次数</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dubbo:consumer</span> <span class="attr">check</span>=<span class="string">&quot;false&quot;</span> <span class="attr">timeout</span>=<span class="string">&quot;2000&quot;</span> <span class="attr">retries</span>=<span class="string">&quot;2&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>


<p>spring-mvc.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  扫controller--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.test.controller&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  注解驱动  --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--  引入dubbo配置文件--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;classpath:spring-dubbo.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>log4j.properties</p>
<p>之前的配置文件直接复制即可</p>
<p>web.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;2.5&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>4<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>4.6.5 启动服务消费者并测试<br>访问：localhost:8081&#x2F;dubbo_consumer&#x2F;user&#x2F;findById?id&#x3D;3<br>显示：{“id”:3,”username”:”C”,”age”:25}<br>注意：因为是RPC的框架，要求传递的参数和实体类要实现序列化</p>
<p>参数：Integer类型（实现序列化接口java.io.Serializable）</p>
<p>返回值：User（实现序列化接口java.io.Serializable），如果不进行序列化，抛出异常</p>
<p>4.7 Zookeeper中存放Dubbo服务结构（作为Dubbo运行的注册中心）<br>Zookeeper树型目录服务：</p>
<p>流程说明</p>
<p>服务提供者(Provider)启动时: 向 &#x2F;dubbo&#x2F;com.foo.BarService&#x2F;providers 目录下写入自己的 URL 地址</p>
<p>服务消费者(Consumer)启动时: 订阅 &#x2F;dubbo&#x2F;com.foo.BarService&#x2F;providers 目录下的提供者 URL 地址。并向 &#x2F;dubbo&#x2F;com.foo.BarService&#x2F;consumers 目录下写入自己的 URL 地址</p>
<p>监控中心(Monitor)启动时: 订阅 &#x2F;dubbo&#x2F;com.foo.BarService 目录下的所有提供者和消费者 URL 地址</p>
<p>4.8 小结<br>dubbo_parent 版本控制<br>dubbo_common 实体类<br>dubbo_interface 共用接口<br>dubbo_provider 服务提供者 dao(spring-dao.xml 整合mybatis), 事务(spring-service.xml), 注册到注册中心(spring-prodvider.xml)<br>启动方式： 3种 推荐开发中用main方法类，tomcat来启动(监听器，springmvc的方式)</p>
<p>dubbo_consumer controller接收参数调用服务接口 spring-mvc.xml, 注册到注册中心 spring-dubbo.xml web.xml dispatcherServlet tomcat来启动</p>
<p>子模块工程间的关系</p>
<p>dubbo_consumer依赖于dubbo_interface(依赖于common) war tomcat<br>dubbo_provider(service,dao)依赖于dubbo_interface(依赖于common) war tomcat<br>五.Dubbo管理控制台<br>我们在开发时，需要知道Zookeeper注册中心都注册了哪些服务，有哪些消费者来消费这些服务。我们可以通过部署一个管理中心来实现。其实管理中心就是一个web应用，部署到tomcat即可。</p>
<p>目标</p>
<p>Dubbo管理控制台的使用（即Dubbo监控中心）</p>
<p>使用路径</p>
<p>安装（dubbo-admin.war）<br>使用（dubbo-admin.war）</p>
<p>5.1. 安装<br>下载dubbo-admin.war，放入Tomcat的webapps中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ find ./apache-tomcat-8.5.54 -name <span class="string">&quot;dubbo*war*&quot;</span> -<span class="built_in">type</span> f    </span><br><span class="line">./apache-tomcat-8.5.54/webapps/dubbo-admin.war</span><br></pre></td></tr></table></figure>


<p>启动Tomcat,此war文件会自动解压</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ ./apache-tomcat-8.5.54/bin/startup.sh</span><br><span class="line">Using CATALINA_BASE:   /Users/swzxsyh/Program/apache-tomcat-8.5.54</span><br><span class="line">Using CATALINA_HOME:   /Users/swzxsyh/Program/apache-tomcat-8.5.54</span><br><span class="line">Using CATALINA_TMPDIR: /Users/swzxsyh/Program/apache-tomcat-8.5.54/temp</span><br><span class="line">Using JRE_HOME:        /Library/Java/JavaVirtualMachines/jdk1.8.0_221.jdk/Contents/Home</span><br><span class="line">Using CLASSPATH:       /Users/swzxsyh/Program/apache-tomcat-8.5.54/bin/bootstrap.jar:/Users/swzxsyh/Program/apache-tomcat-8.5.54/bin/tomcat-juli.jar</span><br><span class="line">Tomcat started.</span><br></pre></td></tr></table></figure>


<p>修改WEB-INF下的dubbo.properties文件</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 注意dubbo.registry.address对应的值需要对应当前使用的Zookeeper的ip地址和端口号</span></span><br><span class="line"></span><br><span class="line"><span class="attr">dubbo.registry.address</span>=<span class="string">zookeeper://localhost:2181</span></span><br><span class="line"><span class="attr">dubbo.admin.root.password</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">dubbo.admin.guest.password</span>=<span class="string">guest</span></span><br><span class="line"><span class="attr">重启tomcat</span></span><br></pre></td></tr></table></figure>

<p>5.2. 使用<br>访问</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">localhost:8080/dubbo-admin/</span><br></pre></td></tr></table></figure>

<p>账号密码都为admn或都为guest，上方配置文件中配置的</p>
<p>启动服务提供者工程和服务消费者工程，可以在查看到对应的信息</p>
<p>5.3 小结<br>安装（dubbo-admin.war），放置到tomcat webapp目录下，zookeeper不是本地则要修改WEB-INF下的dubbo.properties文件， 改zookeeper的ip地址。</p>
<p>使用（dubbo-admin.war）</p>
<p>访问localhost:8080&#x2F;dubbo-admin&#x2F;，输入用户名(root)和密码(root)</p>
<p>六.Dubbo相关配置说明<br>目标</p>
<p>Dubbo相关配置说明</p>
<p>路径</p>
<p>包扫描（dubbo注解配置）</p>
<p>服务接口访问协议dubbo协议</p>
<p>rmi协议</p>
<p>启动时检查</p>
<p>超时调用</p>
<p>6.1. 包扫描<br>1<br>&lt;dubbo:annotation package&#x3D;”com.test.service” &#x2F;&gt;<br>服务提供者和服务消费者前面章节实现都是基于配置文件进行服务注册与订阅，如果使用包扫描，可以使用注解方式实现，推荐使用这种方式。</p>
<p>6.1.1 服务提供者，使用注解实现<br>在spring-dubbo.xml中配置</p>
<p>1<br>&lt;dubbo:annotation package&#x3D;”com.test.service” &#x2F;&gt;<br>服务提供者和服务消费者都需要配置，表示包扫描，作用是扫描指定包(包括子包)下的类。</p>
<p>同时去掉以下配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--指定暴露的服务接口及实例--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">&quot;com.test.service.UserService&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">ref</span>=<span class="string">&quot;userSerivce&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--配置业务类实例--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userSerivce&quot;</span></span></span><br><span class="line"><span class="tag">      <span class="attr">class</span>=<span class="string">&quot;com.test.service.impl.UserServiceImpl&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>


<p>在Controller类中使用@Reference注解</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Reference(loadbalance = &quot;roundrobin&quot;)</span></span><br><span class="line"><span class="keyword">private</span> UserService userService;</span><br></pre></td></tr></table></figure>


<p>注意：其中@Reference是dubbo包下（com.alibaba.dubbo.config.annotation.Reference）的注解。表示订阅服务</p>
<p>6.1.3 重启服务测试使用<br>重启服务提供者模块 dubbo-provider</p>
<p>重启服务消费者模块 dubbo-consumer</p>
<p>在浏览器输入测试URL：localhost:8081&#x2F;dubbo_consumer&#x2F;user&#x2F;findById?id&#x3D;3</p>
<p>6.2 服务接口访问协议【提供方修改】<br>1<br>&lt;dubbo:protocol name&#x3D;”dubbo” port&#x3D;”20881”&gt;<br>一般在服务提供者一方配置，可以指定使用的协议名称和端口号。</p>
<p>其中Dubbo支持的协议有：dubbo、rmi、hessian、http、webservice、rest、redis等。</p>
<p>推荐使用的是dubbo协议，默认端口号：20880。</p>
<p>dubbo 协议采用单一长连接和 NIO 异步通讯，适合于小数据量、大并发的服务调用，以及服务消费者机器数远大于服务提供者机器数的情况。不适合传送大数据量的服务，比如传文件，传视频等，除非请求量很低。</p>
<p>也可以在同一个工程中配置多个协议，不同服务可以使用不同的协议， 在spring-provider.xml配置文件中添加：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 多协议配置 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">&quot;dubbo&quot;</span> <span class="attr">port</span>=<span class="string">&quot;20881&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">&quot;rmi&quot;</span> <span class="attr">port</span>=<span class="string">&quot;1099&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>


<p>dubbo协议：</p>
<p>连接个数：单连接<br>连接方式：长连接<br>传输协议：TCP<br>传输方式：NIO异步传输<br>序列化：Hessian二进制序列化<br>适用范围：传入传出参数数据包较小（建议小于100K），消费者比提供者个数多，单一消费者无法压满提供者，尽量不要用dubbo协议传输大文件或超大字符串。<br>适用场景：常规远程服务方法调用<br>rmi协议：</p>
<p>连接个数：多连接<br>连接方式：短连接<br>传输协议：TCP<br>传输方式：同步传输<br>序列化：Java标准二进制序列化<br>适用范围：传入传出参数数据包大小混合，消费者与提供者个数差不多，可传文件。<br>适用场景：常规远程服务方法调用，与原生RMI服务互操作<br>详情使用可通过博客文章：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/duanxz/p/3555876.html%E4%BA%86%E8%A7%A3">https://www.cnblogs.com/duanxz/p/3555876.html了解</a></p>
<p>6.3 启动时检查<br>1<br>&lt;dubbo:consumer check&#x3D;”false”&#x2F;&gt;<br>上面这个配置需要配置在服务消费者一方，如果不配置默认check值为true。Dubbo 缺省会在启动时检查依赖的服务是否可用，不可用时会抛出异常，阻止 Spring 初始化完成，以便上线时，能及早发现问题。可以通过将check值改为false来关闭检查。</p>
<p>建议在开发阶段将check值设置为false，在生产环境下改为true。</p>
<p>如果设置为true，启动服务消费者，会抛出异常，表示没有服务提供者</p>
<p>6.4. 超时调用<br>默认的情况下，dubbo调用的时间为一秒钟，如果超过一秒钟就会报错，所以我们可以设置超时时间长些，保证调用不出问题，这个时间需要根据业务来进行确定。</p>
<p>修改消费者 配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--超时时间为10秒钟--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:consumer</span> <span class="attr">timeout</span>=<span class="string">&quot;10000&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:consumer</span>&gt;</span></span><br><span class="line">修改提供者配置文件</span><br><span class="line"></span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line"><span class="comment">&lt;!--超时时间设置为10秒钟--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:provider</span> <span class="attr">timeout</span>=<span class="string">&quot;10000&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:provider</span>&gt;</span></span><br></pre></td></tr></table></figure>


<p>6.5 小结<br>包扫描（dubbo注解配置）</p>
<p>&lt;dubbo:annotation package&#x3D;”com.test”&gt;<br>服务提供方: @Service -&gt; alibaba.dubbo包<br>消费方: controller, @Autowired&#x3D;&gt; @Reference-&gt; alibaba.dubbo<br>服务接口访问协议</p>
<p>（服务提供者）</p>
<p>dubbo协议<br>rmi协议</p>
<!--配置Dubbo的协议（dubbo协议，默认端口20880-->
<p>&lt;dubbo:protocol name&#x3D;”dubbo” port&#x3D;”20881”&gt;</p>
<!--配置rmi的协议-->
<p>&lt;dubbo:protocol name&#x3D;”rmi” port&#x3D;”1099”&gt;<br>启动时检查</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">（服务消费者）</span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:consumer</span> <span class="attr">check</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:consumer</span>&gt;</span> 开发时。发布时一定为true超时调用</span><br><span class="line"></span><br><span class="line">（服务消费者）</span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:consumer</span> <span class="attr">check</span>=<span class="string">&quot;false&quot;</span> <span class="attr">timeout</span>=<span class="string">&quot;10000&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:consumer</span>&gt;</span></span><br><span class="line">（服务提供者）</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dubbo:provider</span> <span class="attr">timeout</span>=<span class="string">&quot;10000&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">dubbo:provider</span>&gt;</span></span><br></pre></td></tr></table></figure>




<p>七.负载均衡<br>目标</p>
<p>Dubbo配置负载均衡</p>
<p>学习路径</p>
<p>负载均衡介绍<br>测试负载均衡效果<br>7.1. 介绍<br>负载均衡（Load Balance）：其实就是将请求分摊到多个操作单元上进行执行，从而共同完成工作任务。</p>
<p>在集群负载均衡时，Dubbo 提供了多种均衡策略（包括随机random、轮询roundrobin、最少活跃调用数leastactive），缺省【默认】为random随机调用。</p>
<p>配置负载均衡策略，既可以在服务提供者一方配置（@Service(loadbalance &#x3D; “roundrobin”)），也可以在服务消费者一方配置（@Reference(loadbalance &#x3D; “roundrobin”)），两者取一</p>
<p>如下在服务消费者指定负载均衡策略，可在@Reference添加@Reference(loadbalance &#x3D; “roundrobin”)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line">  <span class="meta">@Reference(loadbalance = &quot;roundrobin&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> UserSerivce userService;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>7.2. 测试负载均衡效果<br>增加一个提供者，提供相同的服务;</p>
<p> 正式生产环境中，最终会把服务端部署到多台机器上，故不需要修改任何代码，只需要部署到不同机器即可测试。下面我们通过启动 ProviderApplication 类来做测试</p>
<p>修改为轮询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Reference(loadbalance = &quot;roundrobin&quot;)</span></span><br><span class="line">  <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestMapping(&quot;/findById&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> User <span class="title function_">findById</span><span class="params">(Integer id)</span>&#123;</span><br><span class="line">    <span class="comment">// 调用服务</span></span><br><span class="line">    <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.findById(id);</span><br><span class="line">    <span class="comment">// 返回json数据</span></span><br><span class="line">    <span class="keyword">return</span> user;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>先启动一个ProviderApplication</p>
<p>IDEA——Edit Configuration——Add New Configuration——Application——进行配置</p>
<p>设置可以启动多个实例</p>
<p>勾选刚刚配置的Application中的 Allow parallel run</p>
<p>修改spring-provider.xml 端口依次改为20881,20882,20883</p>
<p>1<br>2</p>
<!-- 使用Dubbo协议的服务会在初始化时建立长连接-->
<p>&lt;dubbo:protocol name&#x3D;”dubbo” port&#x3D;”20881”&#x2F;&gt;<br>启动ProviderApplication,最终有3个，分别端口为20881，20882，20883</p>
<p>其中</p>
<p>1<br>2<br>@Reference(loadbalance &#x3D; “roundrobin”) 		&#x2F;&#x2F; 表示轮询<br>@Reference(loadbalance &#x3D; “random”)       	&#x2F;&#x2F; 表示随机（默认）<br>访问测试</p>
<p>启动消费者，访问：<a target="_blank" rel="noopener" href="http://localhost:92/user/findById?id=3">http://localhost:92/user/findById?id=3</a></p>
<p>7.3 小结<br>负载均衡: 把请求均匀分配到各服务提供者上</p>
<p>loadbalance:</p>
<p>random 随机 默认<br>roundrobin 轮循<br>leastactive 最少活跃数<br>consistenhash 一致哈希<br>八.配置中心<br>目标</p>
<p>Dubbo配置中心</p>
<p>路径</p>
<p>配置中心环境介绍</p>
<p>实现配置中心</p>
<p>（1）在Zookeeper中添加数据源所需配置</p>
<p>（2）在dubbo-common中导入jar包, 在这里实现配置中心的读取与监听</p>
<p>（3）删除数据库配置文件，数据库配置从Zookeeper上读取</p>
<p>添加watch机制</p>
<p>添加监听(数据库配置信息的节点， 节点数据变化时，重新设置数据库的配置信息，刷新容器)<br>获取Spring容器对象，再刷新<br>8.1. 环境介绍<br>​ 数据发布&#x2F;订阅即所谓的配置中心：发布者将数据发布到ZooKeeper一系列节点上面，订阅者进行数据订阅，当数据有变化时，可以及时得到数据的变化通知，达到动态及时获取数据的目的。</p>
<p>现在项目中有两个提供者，配置了相同的数据源，如果此时要修改数据源，必须同时修改两个才可以。</p>
<p> 我们可以将数据源中需要的配置信息配置存储在zookeeper中，如果修改数据源配置，使用zookeeper的watch机制，同时对提供者的数据源信息更新。</p>
<p>8.2. 实现配置中心<br>操作路径</p>
<p>在zookeeper中添加数据源所需配置<br>在dubbo-common中导入jar包</p>
<p>修改数据源，读取zookeeper中数据源所需配置数据</p>
<p>在dubbo-common中创建工具类：SettingCenterUtil,继承PropertyPlaceholderConfigurer<br>编写载入zookeeper中配置文件，传递到Properties属性中<br>重写processProperties方法<br>修改spring-dao.xml<br>watch机制</p>
<p>添加监听<br>获取容器对象，刷新spring容器：SettingCenterUtil,实现ApplicationContextAware<br>8.2.1 在zookeeper中添加数据源所需配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 71] create /config <span class="string">&#x27;config&#x27;</span></span><br><span class="line">Created /config</span><br><span class="line">[zk: localhost:2181(CONNECTED) 72] create /config/jdbc.url <span class="string">&#x27;jdbc:mysql://localhost:3306/test_01&#x27;</span></span><br><span class="line">Created /config/jdbc.url</span><br><span class="line">[zk: localhost:2181(CONNECTED) 76] create /config/jdbc.user <span class="string">&#x27;root</span></span><br><span class="line"><span class="string">Created /config/jdbc.user</span></span><br><span class="line"><span class="string">[zk: localhost:2181(CONNECTED) 77] create /config/jdbc.password &#x27;</span>root<span class="string">&#x27; </span></span><br><span class="line"><span class="string">Created /config/jdbc.password     </span></span><br><span class="line"><span class="string">[zk: localhost:2181(CONNECTED) 78] create /config/jdbc.driver &#x27;</span>com.mysql.jdbc.Driver<span class="string">&#x27;</span></span><br><span class="line"><span class="string">Created /config/jdbc.driver</span></span><br><span class="line"><span class="string">[zk: localhost:2181(CONNECTED) 79] </span></span><br></pre></td></tr></table></figure>

<p>8.2.2 在dubbo-common中导入jar包<br>详细信息<br>8.2.3 修改数据源，读取zookeeper中数据<br>8.2.3.1 在dubbo-common中创建工具类：SettingCenterUtil,继承PropertyPlaceholderConfigurer</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> dubbo_common/src/main/java   </span><br><span class="line"> ~/P/i/d/d/s/m/java</span><br><span class="line">$ tree  </span><br><span class="line">.</span><br><span class="line">└── com</span><br><span class="line">    └── <span class="built_in">test</span></span><br><span class="line">        ├── pojo</span><br><span class="line">        │   └── User.java</span><br><span class="line">        └── utils</span><br><span class="line">            └── SettingCenterUtil.java</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SettingCenterUtil</span> <span class="keyword">extends</span> <span class="title class_">PropertyPlaceholderConfigurer</span> </span><br></pre></td></tr></table></figure>

<p>8.2.3.2 编写载入zookeeper中配置文件，传递到Properties属性中<br>详细信息<br>8.2.3.3 重写processProperties方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * 处理properties内容,相当于此标签</span></span><br><span class="line"><span class="comment"> * &lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;&gt;&lt;/context:property-placeholder&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> beanFactoryToProcess</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> props</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> BeansException</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">processProperties</span><span class="params">(ConfigurableListableBeanFactory beanFactoryToProcess, Properties props)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">  <span class="comment">// 载入zookeeper配置信息，即从Zookeeper中获取数据源的连接信息</span></span><br><span class="line">  loadZk(props);</span><br><span class="line">  <span class="built_in">super</span>.processProperties(beanFactoryToProcess, props);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>8.2.3.4 修改spring-dao.xml</li>
</ul>
 <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--  注释  加载jdbc配置文件   --&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--    &lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt;--&gt;</span></span><br><span class="line">   <span class="comment">&lt;!--  添加  加载配置中心对象   --&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.test.utils.SettingCenterUtil&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>8.2.4 watch机制<br>8.2.4.1 在SettingCenterUtil中添加监听</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">   * 添加对zookeeper中数据库配置的监听</span></span><br><span class="line"><span class="comment">      <span class="doctag">@param</span> props</span></span><br><span class="line"><span class="comment">          */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">addWatch</span><span class="params">(Properties props)</span>&#123;</span><br><span class="line">  <span class="comment">//connectString       连接字符串 host:port</span></span><br><span class="line">  <span class="type">String</span> <span class="variable">connectString</span> <span class="operator">=</span> <span class="string">&quot;127.0.0.1:2181&quot;</span>;</span><br><span class="line">  <span class="comment">//sessionTimeoutMs    session timeout  会话超时时间</span></span><br><span class="line">  <span class="type">int</span> <span class="variable">sessionTimeoutMs</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line">  <span class="comment">//connectionTimeoutMs connection timeout 连接超时时间</span></span><br><span class="line">  <span class="type">int</span> <span class="variable">connectionTimeoutMs</span> <span class="operator">=</span> <span class="number">1000</span>;</span><br><span class="line">  <span class="comment">//retryPolicy         retry policy to use  重试策略</span></span><br><span class="line">  <span class="comment">// baseSleepTimeMs  每次重试间隔时间</span></span><br><span class="line">  <span class="comment">// 1.创建重试策略</span></span><br><span class="line">  <span class="type">RetryPolicy</span> <span class="variable">retryPolicy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ExponentialBackoffRetry</span>(<span class="number">1000</span>,<span class="number">1</span>);</span><br><span class="line">  <span class="comment">// 2. 创建客户端</span></span><br><span class="line">  <span class="type">CuratorFramework</span> <span class="variable">client</span> <span class="operator">=</span> CuratorFrameworkFactory.newClient(connectString, sessionTimeoutMs, connectionTimeoutMs, retryPolicy);</span><br><span class="line">  <span class="comment">// 3. 启动</span></span><br><span class="line">  client.start();<span class="comment">// 启动</span></span><br><span class="line"></span><br><span class="line">  <span class="type">TreeCache</span> <span class="variable">treeCache</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeCache</span>(client, <span class="string">&quot;/config&quot;</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    treeCache.start();</span><br><span class="line">    <span class="comment">// 添加监听</span></span><br><span class="line">    treeCache.getListenable().addListener(<span class="keyword">new</span> <span class="title class_">TreeCacheListener</span>() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">childEvent</span><span class="params">(CuratorFramework client, TreeCacheEvent event)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span>(event.getType() == TreeCacheEvent.Type.NODE_UPDATED)&#123;</span><br><span class="line">          <span class="comment">// 如果是jdbc.url的值变更</span></span><br><span class="line">          <span class="keyword">if</span>(event.getData().getPath().equals(<span class="string">&quot;/config/jdbc.url&quot;</span>))&#123;</span><br><span class="line">            props.setProperty(<span class="string">&quot;jdbc.url&quot;</span>,<span class="keyword">new</span> <span class="title class_">String</span>(event.getData().getData()));</span><br><span class="line">          &#125;<span class="keyword">else</span> <span class="keyword">if</span>(event.getData().getPath().equals(<span class="string">&quot;/config/jdbc.driver&quot;</span>))&#123;</span><br><span class="line">            <span class="comment">// 如果 jdbc.driver变更</span></span><br><span class="line">            props.setProperty(<span class="string">&quot;jdbc.driver&quot;</span>,<span class="keyword">new</span> <span class="title class_">String</span>(event.getData().getData()));</span><br><span class="line">          &#125;<span class="keyword">else</span> <span class="keyword">if</span>(event.getData().getPath().equals(<span class="string">&quot;/config/jdbc.user&quot;</span>))&#123;</span><br><span class="line">            <span class="comment">// 用户名修改了</span></span><br><span class="line">            props.setProperty(<span class="string">&quot;jdbc.user&quot;</span>,<span class="keyword">new</span> <span class="title class_">String</span>(event.getData().getData()));</span><br><span class="line">          &#125;<span class="keyword">else</span> <span class="keyword">if</span>(event.getData().getPath().equals(<span class="string">&quot;/config/jdbc.password&quot;</span>))&#123;</span><br><span class="line">            <span class="comment">// 密码修改了</span></span><br><span class="line">            props.setProperty(<span class="string">&quot;jdbc.password&quot;</span>,<span class="keyword">new</span> <span class="title class_">String</span>(event.getData().getData()));</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// 刷新spring容器</span></span><br><span class="line">          applicationContext.refresh();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>注意：</p>
<p>不要关闭client，否则无法进行监控<br>修改完成后必须刷新spring容器的对象<br>8.2.4.2 获取容器对象，刷新spring容器<br>修改SettingCenterUtil实现ApplicationContextAware接口，重写setApplicationContext方法，获取applicationContext对象。</p>
<p>AbstractApplicationContext容器对象父类，提供了refresh方法，可以刷新容器中的对象，故强制转换。</p>
<p>在processProperties的方法中，添加addWatch(props);</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">processProperties</span><span class="params">(ConfigurableListableBeanFactory beanFactoryToProcess, Properties props)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">  loadZk(props);</span><br><span class="line">  addWatch(props);</span><br><span class="line">  <span class="built_in">super</span>.processProperties(beanFactoryToProcess, props);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>修改Zookeeper的配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[zk: localhost:2181(CONNECTED) 79] <span class="built_in">set</span> /config/jdbc.url <span class="string">&quot;jdbc:mysql:///test&quot;</span></span><br><span class="line">[zk: localhost:2181(CONNECTED) 80] get /config/jdbc.url</span><br><span class="line">jdbc:mysql:///test</span><br></pre></td></tr></table></figure>


<p>8.3 小结<br>配置中心环境介绍 回看zookeeper配置中心的图<br>实现配置中心<br>在Zookeeper中添加数据源所需配置<br>在dubbo-common中导入jar包<br>修改数据源,读取Zookeeper中数据,继承ProperteisPlaceHolderConfigurer.processProperties, 读取zk中的数据库配置,设置进props参数<br>watch机制<br>添加监听 TreeCache, event.type&#x3D;node_update, 注意：判断path 不要关闭客户端<br>获取容器对象且刷新</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swzxsyh.github.io/2020/06/16/Zookepper-%E5%88%9D%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="swzxsyh">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="swzxsyh">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/16/Zookepper-%E5%88%9D%E8%AF%86/" class="post-title-link" itemprop="url">Zookepper 初识</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-16 01:51:22" itemprop="dateCreated datePublished" datetime="2020-06-16T01:51:22+08:00">2020-06-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-10 05:39:40" itemprop="dateModified" datetime="2022-08-10T05:39:40+08:00">2022-08-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一. 介绍zookeeper<br>目标<br>了解Zookeeper的概念<br>了解分布式的概念<br>学习路径<br>Zookeeper概述<br>Zookeeper的发展历程<br>什么是分布式<br>Zookeeper的应用场景<br>1.1 zookeeper概述<br>Apache ZooKeeper的系统为分布式协调是构建分布式应用的高性能服务。<br>ZooKeeper 本质上是一个分布式的小文件存储系统。提供基于类似于文件系统的目录树方式的数据存储，并且可以对树中的节点进行有效管理。从而用来维护和监控你存储的数据的状态变化。通过监控这些数据状态的变化，从而可以达到基于数据的集群管理。<br>ZooKeeper 适用于存储和协同相关的关键数据，不适合用于大数据量存储。</p>
<p>1.2 zookeeper被大量使用<br>Hadoop：使用ZooKeeper 做Namenode 的高可用。<br>HBase：保证集群中只有一个master，保存hbase:meta表的位置，保存集群中的RegionServer列表。<br>Kafka：集群成员管理，controller 节点选举。<br>1.3 什么是分布式<br>1.3.1 集中式系统<br>集中式系统，集中式系统中整个项目就是一个独立的应用，整个应用也就是整个项目，所有的东西都在一个应用里面。部署到一个服务器上。<br>布署项目时，放到一个tomcat里的。也称为单体架构</p>
<p>1.3.2 分布式系统<br>多台计算机构成<br>计算机之间通过网络进行通信<br>彼此进行交互<br>共同目标<br>1.3.3 小结<br>集中式：开发项目时都是在同一个应用里，布署到同一个tomcat，只有一个tomcat即可</p>
<p>分布：分多个工程开发，布署多个tomcat里</p>
<p>1.4 zookeeper的应用场景<br>1.4.1 注册中心<br>分布式应用中，通常需要有一套完整的命名规则，既能够产生唯一的名称又便于人识别和记住，通常情况下用树形的名称结构是一个理想的选择，树形的名称结构是一个有层次的目录结构。通过调用Zookeeper提供的创建节点的API，能够很容易创建一个全局唯一的path，这个path就可以作为一个名称。<br>Dubbo中使用ZooKeeper来作为其命名服务，维护全局的服务地址列表。</p>
<p>1.4.2 配置中心<br>​ 数据发布&#x2F;订阅即所谓的配置中心：发布者将数据发布到ZooKeeper一系列节点上面，订阅者进行数据订阅，当数据有变化时，可以及时得到数据的变化通知，达到动态获取数据的目的。</p>
<p>ZooKeeper 采用的是推拉结合的方式。</p>
<p>推: 服务端会推给注册了监控节点的客户端 Wathcer 事件通知</p>
<p>拉: 客户端获得通知后，然后主动到服务端拉取最新的数据</p>
<p>1.4.3 分布式锁——非公平锁<br>分布式锁是控制分布式系统之间同步访问共享资源的一种方式。在分布式系统中，常常需要协调他们的动作。如果不同的系统或是同一个系统的不同主机之间共享了一个或一组资源，那么访问这些资源的时候，往往需要互斥来防止彼此干扰来保证一致性，在这种情况下，便需要使用到分布式锁。</p>
<p>1.4.4 分布式队列——公平锁<br>在传统的单进程编程中，我们使用队列来存储一些数据结构，用来在多线程之间共享或传递数据。分布式环境下，我们同样需要一个类似单进程队列的组件，用来实现跨进程、跨主机、跨网络的数据共享和数据传递，这就是我们的分布式队列。</p>
<p>1.4.5 负载均衡<br>负载均衡是通过负载均衡算法，用来把对某种资源的访问分摊给不同的设备，从而减轻单点的压力。</p>
<p>每台工作服务器在启动时都会去ZooKeeper的servers节点下注册临时节点，每台客户端在启动时都会去servers节点下取得所有可用的工作服务器列表，并通过一定的负载均衡算法计算得出一台工作服务器，并与之建立网络连接</p>
<p>1.4.6 小结<br>Zookeeper概述<br>Zookeeper的发展历程<br>什么是分布式 应用是布署多台服务器上(多个tomcat)<br>Zookeeper的应用场景<br>注册中心（房产中介）<br>配置中心（多台应用(服务) 修改配置文件，不需要重启）<br>分布式锁 多个应用（服务）同一时刻，只有一个服务能够执行某个操作<br>分布式队列：使得多进程、多服务间可以同步数据、传输数据、协同工作<br>负载均衡：使用多应用的调用频率比较平均<br>二.zookeeper环境搭建<br>目标</p>
<p>安装Zookeeper</p>
<p>学习路径</p>
<p>Zookeeper的发展历程<br>什么是分布式<br>Zookeeper的应用场景<br>2.1 前提<br>安装Docker</p>
<p>2.2安装zookeeper<br>2.2.1 下载</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Docker拉取镜像</span></span><br><span class="line">$ docker pull zookeeper</span><br><span class="line"><span class="comment">#查看镜像文件</span></span><br><span class="line">$ docker images  </span><br><span class="line">REPOSITORY    TAG        IMAGE ID       CREATED      SIZE</span><br><span class="line">zookeeper    latest     454af3da184c   6 days ago    252MB</span><br></pre></td></tr></table></figure>


<p>2.2.2 修改配置文件</p>
<h1 id="使用一个目录，创建zk配置文件-x2F-数据-x2F-日志目录"><a href="#使用一个目录，创建zk配置文件-x2F-数据-x2F-日志目录" class="headerlink" title="使用一个目录，创建zk配置文件&#x2F;数据&#x2F;日志目录"></a>使用一个目录，创建zk配置文件&#x2F;数据&#x2F;日志目录</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> conf  data <span class="built_in">log</span></span><br><span class="line">$ tree zk           </span><br><span class="line">zk</span><br><span class="line">├── conf</span><br><span class="line">├── data</span><br><span class="line">└── <span class="built_in">log</span></span><br></pre></td></tr></table></figure>

<h1 id="暂时启动zookeeper"><a href="#暂时启动zookeeper" class="headerlink" title="暂时启动zookeeper"></a>暂时启动zookeeper</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d --name zk --restart always zookeeper</span><br></pre></td></tr></table></figure>

<h1 id="复制配置文件"><a href="#复制配置文件" class="headerlink" title="复制配置文件"></a>复制配置文件</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ docker <span class="built_in">cp</span> -a zk:/conf/zoo.cfg ~/Program/zk/conf/zoo.cfg    </span><br><span class="line">$ <span class="built_in">cat</span> ~/Program/zk/conf/zoo.cfg    </span><br><span class="line"></span><br><span class="line">dataDir=/data</span><br><span class="line">dataLogDir=/datalog</span><br><span class="line">tickTime=2000</span><br><span class="line">initLimit=5</span><br><span class="line">syncLimit=2</span><br><span class="line">autopurge.snapRetainCount=3</span><br><span class="line">autopurge.purgeInterval=0</span><br><span class="line">maxClientCnxns=60</span><br><span class="line">standaloneEnabled=<span class="literal">true</span></span><br><span class="line">admin.enableServer=<span class="literal">true</span></span><br><span class="line">server.1=localhost:2888:3888;2181</span><br></pre></td></tr></table></figure>

<h1 id="停止并删除未配置的zookeeper容器"><a href="#停止并删除未配置的zookeeper容器" class="headerlink" title="停止并删除未配置的zookeeper容器"></a>停止并删除未配置的zookeeper容器</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker stop zk &amp;&amp; docker <span class="built_in">rm</span> zk</span><br></pre></td></tr></table></figure>

<h1 id="指定保存数据的目录：data目录"><a href="#指定保存数据的目录：data目录" class="headerlink" title="指定保存数据的目录：data目录"></a>指定保存数据的目录：data目录</h1><h1 id="如果需要日志，可以创建log文件夹，指定dataLogDir属性"><a href="#如果需要日志，可以创建log文件夹，指定dataLogDir属性" class="headerlink" title="如果需要日志，可以创建log文件夹，指定dataLogDir属性"></a>如果需要日志，可以创建log文件夹，指定dataLogDir属性</h1><p>2.2.3 启动zookeeper</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ docker run -d --name zk --restart always \  </span><br><span class="line">-p 2181:2181 -p 2888:2888 -p 3888:3888 \</span><br><span class="line">-v /Users/swzxsyh/Program/zk/conf/zoo.cfg:/conf/zoo.cfg \</span><br><span class="line">-v /Users/swzxsyh/Program/zk/data:/data \</span><br><span class="line">-v /Users/swzxsyh/Program/zk/log:/datalog \</span><br><span class="line">zookeeper</span><br><span class="line"></span><br><span class="line"><span class="comment">#zookeeper客户端端口，跟随端口，选择端口</span></span><br></pre></td></tr></table></figure>



<p>2.2.4 启动客户端测试</p>
<h1 id="下载客户端，启动"><a href="#下载客户端，启动" class="headerlink" title="下载客户端，启动"></a>下载客户端，启动</h1><p>$ .&#x2F;zkCli.sh<br>&#x2F;usr&#x2F;bin&#x2F;java<br>2020-06-16 17:13:31,750 [myid:] - INFO  [main:ClientCnxn@1653] - zookeeper.request.timeout value is 0. feature enabled&#x3D;</p>
<h1 id="省略中间输出…"><a href="#省略中间输出…" class="headerlink" title="省略中间输出…"></a>省略中间输出…</h1><h1 id="出现此行即说明连接成功"><a href="#出现此行即说明连接成功" class="headerlink" title="出现此行即说明连接成功"></a>出现此行即说明连接成功</h1><p>Welcome to ZooKeeper!<br>2020-06-16 17:13:31,757 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1112] - Opening socket connection to server localhost&#x2F;127.0.0.1:2181. Will not attempt to authenticate using SASL (unknown error)<br>JLine support is enabled<br>2020-06-16 17:13:31,834 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@959] - Socket connection established, initiating session, client: &#x2F;127.0.0.1:64028, server: localhost&#x2F;127.0.0.1:2181<br>[zk: localhost:2181(CONNECTING) 0] 2020-06-16 17:13:31,896 [myid:localhost:2181] - INFO  [main-SendThread(localhost:2181):ClientCnxn$SendThread@1394] - Session establishment complete on server localhost&#x2F;127.0.0.1:2181, sessionid &#x3D; 0x100014a6eed0000, negotiated timeout &#x3D; 30000</p>
<p>WATCHER::</p>
<p>WatchedEvent state:SyncConnected type:None path:null<br>[zk: localhost:2181(CONNECTED) 0]<br>2.2.5 小结<br>pull镜像<br>创建data&#x2F;conf&#x2F;log目录<br>复制zoo.cfg文件并加载启动<br>三.zookeeper基本操作<br>目标</p>
<p>Zookeeper的客户端命令<br>Zookeeper的java的api操作<br>学习路径</p>
<p>Zookeeper的数据结构</p>
<p>节点的分类</p>
<p>持久性<br>临时性<br>客户端命令（创建、查询、修改、删除）</p>
<p>Zookeeper的java的api介绍（创建、查询、修改、删除）</p>
<p>Zookeeper的watch机制</p>
<p>NodeCache<br>PathChildrenCache<br>TreeCache<br>3.1 zookeeper数据结构<br>ZooKeeper 的数据模型是层次模型。层次模型常见于文件系统。</p>
<p>每个目录下面可以创建文件，也可以创建子目录，最终构成了一个树型结构。通过这种树型结构的目录，可以将文件分门别类的进行存放，方便我们后期查找。</p>
<p>层次模型和key-value 模型是两种主流的数据模型。ZooKeeper 使用文件系统模型主要基于以下两点考虑<br>文件系统的树形结构便于表达数据之间的层次关系。<br>文件系统的树形结构便于为不同的应用分配独立的命名空间（namespace 路径url）<br>ZooKeeper 的层次模型称作data tree。Datatree 的每个节点叫作znode（Zookeeper node）。不同于文件系统，每个节点都可以保存数据。每个节点都有一个版本(version)。版本从0 开始计数。</p>
<p>如图所示，data tree中有两个子树，用于应用1( &#x2F;app1)和应用2（&#x2F;app2）。</p>
<p>每个客户端进程pi 创建一个znode节点 p_i 在 &#x2F;app1下， &#x2F;app1&#x2F;p_1就代表一个客户端在运行。</p>
<p>3.2 节点的分类<br>一个znode可以是持久性的，也可以是临时性的<br>持久性znode[PERSISTENT]，这个znode一旦创建不会丢失，无论是zookeeper宕机，还是client宕机。<br>临时性的znode[EPHEMERAL]，如果zookeeper宕机了，或者client在指定的timeout时间内没有连接server，都会被认为丢失。 -e<br>znode也可以是顺序性的，每一个顺序性的znode关联一个唯一的单调递增整数。这个单调递增整数是znode名字的后缀。<br>持久顺序性的znode(PERSISTENT_SEQUENTIAL):znode 处理具备持久性的znode的特点之外，znode的名称具备顺序性。 -s<br>临时顺序性的znode(EPHEMERAL_SEQUENTIAL):znode处理具备临时性的znode特点，znode的名称具备顺序性。-s<br>3.3 客户端命令<br>3.3.1 查询所有命令<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>[zk: localhost:2181(CONNECTED) 8] help<br>ZooKeeper -server host:port cmd args<br>addauth scheme auth<br>close<br>config [-c] [-w] [-s]<br>connect host:port<br>create [-s] [-e] [-c] [-t ttl] path [data] [acl]<br>delete [-v version] path<br>deleteall path<br>delquota [-n|-b] path<br>get [-s] [-w] path<br>getAcl [-s] path<br>history<br>listquota path<br>ls [-s] [-w] [-R] path<br>ls2 path [watch]<br>printwatches on|off<br>quit<br>reconfig [-s] [-v version] [[-file path] | [-members serverID&#x3D;host:port1:port2;port3[,…]<em>]] | [-add serverId&#x3D;host:port1:port2;port3[,…]]</em> [-remove serverId[,…]*]<br>redo cmdno<br>removewatches path [-c|-d|-a] [-l]<br>rmr path<br>set [-s] [-v version] path data<br>setAcl [-s] [-v version] [-R] path acl<br>setquota -n|-b val path<br>stat [-w] path<br>sync path<br>3.3.2 查询根路径下的节点<br>1<br>2<br>[zk: localhost:2181(CONNECTED) 9] ls &#x2F;zookeeper<br>[config, quota]<br>3.3.3 创建普通永久节点<br>1<br>2<br>3<br>4<br>5<br>#创建HelloZK节点，值为Hello,Zookeeper<br>[zk: localhost:2181(CONNECTED) 10] create &#x2F;HelloZK “Hello,Zookeeper”<br>Created &#x2F;HelloZK<br>[zk: localhost:2181(CONNECTED) 11] ls &#x2F;HelloZK<br>[]<br>3.3.4 创建带序号永久节点<br>1<br>2<br>[zk: localhost:2181(CONNECTED) 13] create -s &#x2F;HelloZK_SEQ “ZK With SEQUENCE”<br>Created &#x2F;HelloZK_SEQ0000000001<br>3.3.5 创建普通临时节点<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8</p>
<h1 id="e-表示普通临时节点"><a href="#e-表示普通临时节点" class="headerlink" title="-e:表示普通临时节点"></a>-e:表示普通临时节点</h1><p>[zk: localhost:2181(CONNECTED) 17] create -e &#x2F;Hello_ZK_Normal “Normal Node”<br>Created &#x2F;Hello_ZK_Normal<br>[zk: localhost:2181(CONNECTED) 19] ls &#x2F;<br>[HelloZK, HelloZK_SEQ0000000001, Hello_ZK_Normal, zookeeper]</p>
<h1 id="关闭客户端，再次打开查看-Hello-ZK-Normal-节点消失"><a href="#关闭客户端，再次打开查看-Hello-ZK-Normal-节点消失" class="headerlink" title="关闭客户端，再次打开查看 Hello_ZK_Normal 节点消失"></a>关闭客户端，再次打开查看 Hello_ZK_Normal 节点消失</h1><p>[zk: localhost:2181(CONNECTED) 1] ls &#x2F;<br>[HelloZK, HelloZK_SEQ0000000001, zookeeper]<br>3.3.6 创建带序号临时节点<br>1<br>2<br>3<br>4<br>5<br>6<br>7</p>
<h1 id="e-表示普通临时节点-1"><a href="#e-表示普通临时节点-1" class="headerlink" title="-e:表示普通临时节点"></a>-e:表示普通临时节点</h1><h1 id="s-表示带序号节点"><a href="#s-表示带序号节点" class="headerlink" title="-s:表示带序号节点"></a>-s:表示带序号节点</h1><p>[zk: localhost:2181(CONNECTED) 2] create -e -s &#x2F;Hello_ZK_SEQ_TEMP “Temp And Sequence”<br>Created &#x2F;Hello_ZK_SEQ_TEMP0000000003</p>
<h1 id="关闭客户端，再次打开查看-Hello-ZK-SEQ-TEMP-节点消失"><a href="#关闭客户端，再次打开查看-Hello-ZK-SEQ-TEMP-节点消失" class="headerlink" title="关闭客户端，再次打开查看 Hello_ZK_SEQ_TEMP 节点消失"></a>关闭客户端，再次打开查看 Hello_ZK_SEQ_TEMP 节点消失</h1><p>[zk: localhost:2181(CONNECTED) 0] ls &#x2F;<br>[HelloZK, HelloZK_SEQ0000000001, zookeeper]<br>3.3.7 查询节点数据<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>[zk: localhost:2181(CONNECTED) 7] get -s &#x2F;HelloZK<br>Hello,Zookeeper<br>cZxid &#x3D; 0x2<br>ctime &#x3D; Tue Jun 16 17:28:46 CST 2020<br>mZxid &#x3D; 0x2<br>mtime &#x3D; Tue Jun 16 17:28:46 CST 2020<br>pZxid &#x3D; 0x2<br>cversion &#x3D; 0<br>dataVersion &#x3D; 0<br>aclVersion &#x3D; 0<br>ephemeralOwner &#x3D; 0x0<br>dataLength &#x3D; 15<br>numChildren &#x3D; 0<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15</p>
<h1 id="­­­­­­­­­­­节点的状态信息，也称为stat结构体­­­­­­­­­­­­­­­­­­­"><a href="#­­­­­­­­­­­节点的状态信息，也称为stat结构体­­­­­­­­­­­­­­­­­­­" class="headerlink" title="­­­­­­­­­­­节点的状态信息，也称为stat结构体­­­­­­­­­­­­­­­­­­­"></a>­­­­­­­­­­­节点的状态信息，也称为stat结构体­­­­­­­­­­­­­­­­­­­</h1><h1 id="创建该znode的事务的zxid-ZooKeeper-Transaction-ID"><a href="#创建该znode的事务的zxid-ZooKeeper-Transaction-ID" class="headerlink" title="创建该znode的事务的zxid(ZooKeeper Transaction ID)"></a>创建该znode的事务的zxid(ZooKeeper Transaction ID)</h1><h1 id="事务ID是ZooKeeper为每次更新操作-x2F-事务操作分配一个全局唯一的id，表示zxid，值越小，表示越先执行"><a href="#事务ID是ZooKeeper为每次更新操作-x2F-事务操作分配一个全局唯一的id，表示zxid，值越小，表示越先执行" class="headerlink" title="事务ID是ZooKeeper为每次更新操作&#x2F;事务操作分配一个全局唯一的id，表示zxid，值越小，表示越先执行"></a>事务ID是ZooKeeper为每次更新操作&#x2F;事务操作分配一个全局唯一的id，表示zxid，值越小，表示越先执行</h1><p>cZxid &#x3D; 0x4454 # 0x0表示十六进制数0<br>ctime &#x3D; Thu Jan 01 08:00:00 CST 1970  # 创建时间<br>mZxid &#x3D; 0x4454 						  # 最后一次更新的zxid<br>mtime &#x3D; Thu Jan 01 08:00:00 CST 1970  # 最后一次更新的时间<br>pZxid &#x3D; 0x4454 						  # 最后更新的子节点的zxid<br>cversion &#x3D; 5 						  # 子节点的变化号，表示子节点被修改的次数<br>dataVersion &#x3D; 0 					  # 表示当前节点的数据变化号，0表示当前节点从未被修改过<br>aclVersion &#x3D; 0  					  # 访问控制列表的变化号 access control list</p>
<h1 id="如果临时节点，表示当前节点的拥有者的sessionId"><a href="#如果临时节点，表示当前节点的拥有者的sessionId" class="headerlink" title="如果临时节点，表示当前节点的拥有者的sessionId"></a>如果临时节点，表示当前节点的拥有者的sessionId</h1><p>ephemeralOwner &#x3D; 0x0				  # 如果不是临时节点，则值为0<br>dataLength &#x3D; 13 					  # 数据长度<br>numChildren &#x3D; 1 					  # 子节点的数量<br>3.3.8 修改节点数据<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>[zk: localhost:2181(CONNECTED) 9] set  &#x2F;HelloZK “Modify HelloZK”</p>
<p>WATCHER::</p>
<p>WatchedEvent state:SyncConnected type:NodeDataChanged path:&#x2F;HelloZK<br>[zk: localhost:2181(CONNECTED) 10]<br>[zk: localhost:2181(CONNECTED) 10] get -s &#x2F;HelloZK<br>Modify HelloZK<br>cZxid &#x3D; 0x2<br>ctime &#x3D; Tue Jun 16 17:28:46 CST 2020<br>mZxid &#x3D; 0xc<br>mtime &#x3D; Tue Jun 16 17:40:47 CST 2020<br>pZxid &#x3D; 0x2<br>cversion &#x3D; 0<br>dataVersion &#x3D; 1<br>aclVersion &#x3D; 0<br>ephemeralOwner &#x3D; 0x0<br>dataLength &#x3D; 14<br>numChildren &#x3D; 0<br>3.3.9 创建子节点<br>1<br>2<br>3<br>4<br>5<br>[zk: localhost:2181(CONNECTED) 36] create &#x2F;TestDelete<br>Created &#x2F;TestDelete<br>[zk: localhost:2181(CONNECTED) 37] create &#x2F;TestDelete&#x2F;RMR<br>Created &#x2F;TestDelete&#x2F;RMR<br>[zk: localhost:2181(CONNECTED) 38]<br>3.3.10 删除节点<br>1<br>2<br>3<br>[zk: localhost:2181(CONNECTED) 11] delete &#x2F;HelloZK_SEQ0000000001<br>[zk: localhost:2181(CONNECTED) 12] ls &#x2F;<br>[HelloZK, zookeeper]<br>3.3.11 递归删除节点<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8</p>
<h1 id="有子节点的使用delete会提示目录非空"><a href="#有子节点的使用delete会提示目录非空" class="headerlink" title="有子节点的使用delete会提示目录非空"></a>有子节点的使用delete会提示目录非空</h1><p>[zk: localhost:2181(CONNECTED) 39] delete &#x2F;TestDelete<br>Node not empty: &#x2F;TestDelete</p>
<h1 id="需用rmr命令删除，现已更新为deleteall"><a href="#需用rmr命令删除，现已更新为deleteall" class="headerlink" title="需用rmr命令删除，现已更新为deleteall"></a>需用rmr命令删除，现已更新为deleteall</h1><p>[zk: localhost:2181(CONNECTED) 12] rmr &#x2F;TestDelete<br>The command ‘rmr’ has been deprecated. Please use ‘deleteall’ instead.<br>[zk: localhost:2181(CONNECTED) 13] ls &#x2F;<br>[jsodjsd0000000011, sjdiosdjsoi, zookeeper]<br>3.3.12 查看节点状态<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>[zk: localhost:2181(CONNECTED) 2] stat &#x2F;zookeeper<br>cZxid &#x3D; 0x0<br>ctime &#x3D; Thu Jan 01 08:00:00 CST 1970<br>mZxid &#x3D; 0x0<br>mtime &#x3D; Thu Jan 01 08:00:00 CST 1970<br>pZxid &#x3D; 0x0<br>cversion &#x3D; -2<br>dataVersion &#x3D; 0<br>aclVersion &#x3D; 0<br>ephemeralOwner &#x3D; 0x0<br>dataLength &#x3D; 0<br>numChildren &#x3D; 2<br>3.3.13 日志的可视化<br>日志存储路径</p>
<p>1<br>~&#x2F;Program&#x2F;zk&#x2F;log&#x2F;version-2<br>日志都是以二进制文件存储的,需要使用命令行查看</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8</p>
<h1 id="Docker拉取了最新镜像，需要4个jar包了"><a href="#Docker拉取了最新镜像，需要4个jar包了" class="headerlink" title="Docker拉取了最新镜像，需要4个jar包了"></a>Docker拉取了最新镜像，需要4个jar包了</h1><p>$ ls | grep jar<br>log4j-1.2.17.jar<br>slf4j-api-1.7.25.jar<br>zookeeper-3.6.1.jar<br>zookeeper-jute-3.6.1.jar</p>
<h1 id="然后使用命令行查看"><a href="#然后使用命令行查看" class="headerlink" title="然后使用命令行查看"></a>然后使用命令行查看</h1><p>$ java -classpath :.&#x2F;log4j-1.2.17.jar:slf4j-api-1.7.25.jar:zookeeper-3.6.1.jar:zookeeper-jute-3.6.1.jar org.apache.zookeeper.server.LogFormatter log.1<br>3.3.14 小结<br>ls 查看<br>help查看所有命令<br>create 路径 数据 -s 代表有序 -e 代临时<br>get 路径 查询<br>set 路径 新的数据<br>delete 路径 单一路径，没有子节点<br>rmr 路径 递归删除<br>stat 路径 查看节点状态<br>日志，依赖4个jar包<br>3.4 zookeeper的Java Api介绍<br>3.4.1 ZooKeeper常用Java API<br>原生Java API</p>
<p>ZooKeeper 原生Java API位于org.apache.ZooKeeper包中</p>
<p>ZooKeeper-3.x.x. Jar 为官方提供的 java API</p>
<p>Apache Curator</p>
<p>Apache Curator是 Apache ZooKeeper的Java客户端库。</p>
<p>Curator.项目的目标是简化ZooKeeper客户端的使用。</p>
<p>ZkClient</p>
<p>开源的ZooKeeper客户端,zkclient-x.x.Jar也是在原生 api 基础之上进行扩展的开源 JAVA 客户端。</p>
<p>3.4.2 创建Java Maven工程，导入依赖<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br><?xml version="1.0" encoding="UTF-8"?><br><project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemalocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"><br>  <modelVersion>4.0.0</modelVersion></project></p>
<p>  <groupId>org.example</groupId><br>  <artifactId>zookeeper</artifactId><br>  <version>1.0-SNAPSHOT</version><br>  <!--zookeeper的依赖--></p>
  <dependencies>
    <dependency>
      <groupId>org.apache.zookeeper</groupId>
      <artifactId>zookeeper</artifactId>
      <version>3.4.7</version>
    </dependency>
    <!--	zookeeper CuratorFramework 是Netflix公司开发一款连接zookeeper服务的框架，通过封装的一套高级API 简化了ZooKeeper的操作，提供了比较全面的功能，除了基础的节点的操作，节点的监听，还有集群的连接以及重试。-->
    <dependency>
      <groupId>org.apache.curator</groupId>
      <artifactId>curator-framework</artifactId>
      <version>4.0.1</version>
    </dependency>
    <dependency>
      <groupId>org.apache.curator</groupId>
      <artifactId>curator-recipes</artifactId>
      <version>4.0.1</version>
    </dependency>
    <!--测试-->
    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <version>4.12</version>
    </dependency>
  </dependencies>

3.4.3 CURD节点
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
public class TestZookeeper {
  //连接地址
  String url = "127.0.0.1:2181";
  //会话超时时间
  int sessionTimeoutMs = 1000;
  //连接超时时间
  int connectionTimeoutMs = 1000;
  //重试策略
  RetryPolicy retryPolicy = null;
  //创建客户端
  CuratorFramework client = null;

<p>  String NodeName &#x3D; null;</p>
<p>  @Before<br>  public void createLinkToZK() {<br>    &#x2F;&#x2F;重试策略<br>    &#x2F;**<br>     *  RetryPolicy： 失败的重试策略的公共接口<br>     *  ExponentialBackoffRetry是 公共接口的其中一个实现类<br>     *      参数1： 初始化sleep的时间，用于计算之后的每次重试的sleep时间<br>     *      参数2：最大重试次数<br>            参数3（可以省略）：最大sleep时间，如果上述的当前sleep计算出来比这个大，那么sleep用这个时间<br>     <em>&#x2F;<br>    retryPolicy &#x3D; new ExponentialBackoffRetry(1000, 1);<br>    &#x2F;&#x2F;创建客户端<br>    &#x2F;</em>*<br>     * 参数1：连接的ip地址和端口号<br>     * 参数2：会话超时时间，单位毫秒<br>     * 参数3：连接超时时间，单位毫秒<br>     * 参数4：失败重试策略<br>     *&#x2F;<br>    client &#x3D; CuratorFrameworkFactory.newClient(url, sessionTimeoutMs, connectionTimeoutMs, retryPolicy);<br>    &#x2F;&#x2F;启动客户端<br>    client.start();<br>  }</p>
<p>  @After<br>  public void closeLike() throws Exception {<br>    if (NodeName !&#x3D; null) {<br>      requireNode(NodeName);<br>    } else if (NodeName &#x3D;&#x3D; null) {<br>      System.out.println(“No Node”);<br>    }<br>    &#x2F;&#x2F;关闭客户端<br>    client.close();<br>  }</p>
<p>  &#x2F;&#x2F;1. 创建一个空节点(a)（只能创建一层节点）<br>  @Test<br>  public void createOneLevelEmptyNode() throws Exception {<br>    NodeName &#x3D; “&#x2F;OneLevelEmptyNode”;<br>    client.create().forPath(NodeName);<br>  }</p>
<p>  &#x2F;&#x2F;2. 创建一个有内容的b节点（只能创建一层节点）<br>  @Test<br>  public void createOneLevelNodeWithMessage() throws Exception {<br>    NodeName &#x3D; “&#x2F;OneLevelNodeWithMessage”;<br>    client.create().forPath(NodeName, “OneLevelNodeWithMessage”.getBytes());<br>  }</p>
<p>  &#x2F;&#x2F;3. 创建持久节点，同时创建多层节点<br>  @Test<br>  public void createMultilevelPersistentNode() throws Exception {<br>    NodeName &#x3D; “&#x2F;Multilevel&#x2F;Persistent&#x2F;Node”;<br>    client.create().creatingParentsIfNeeded().forPath(NodeName, “MultilevelPersistentNode”.getBytes());<br>  }</p>
<p>  &#x2F;&#x2F;4. 创建带有的序号的持久节点<br>  @Test<br>  public void creatPersistentNode() throws Exception {<br>    &#x2F;&#x2F;        NodeName &#x3D; “&#x2F;Persistent&#x2F;Node”;<br>    client.create().creatingParentsIfNeeded().withMode(CreateMode.PERSISTENT_SEQUENTIAL).forPath(“&#x2F;Persistent&#x2F;Node”, “PERSISTENT_SEQUENTIAL”.getBytes());<br>  }</p>
<p>  &#x2F;&#x2F;5. 创建临时节点（客户端关闭，节点消失），设置延时5秒关闭（Thread.sleep(5000)）<br>  @Test<br>  public void creatTempNode() throws Exception {<br>    client.create().creatingParentsIfNeeded().withMode(CreateMode.EPHEMERAL).forPath(“&#x2F;Temporary&#x2F;Node”, “Temporary Node”.getBytes());<br>  }</p>
<p>  &#x2F;&#x2F;6. 创建临时带序号节点（客户端关闭，节点消失），设置延时5秒关闭（Thread.sleep(5000)）<br>  @Test<br>  public void creatTempNodeWithSequenceNode() throws Exception {<br>    client.create().creatingParentsIfNeeded().withMode(CreateMode.EPHEMERAL_SEQUENTIAL).forPath(“&#x2F;TempNode&#x2F;With&#x2F;Sequence&#x2F;Node”, “creatTempNodeWithSequence”.getBytes());<br>  }</p>
<p>  &#x2F;&#x2F;修改节点描述<br>  @Test<br>  public void updateNodeMessage() throws Exception {<br>    NodeName &#x3D; “&#x2F;OneLevelNodeWithMessage”;<br>    client.setData().forPath(NodeName, “Update Node Message”.getBytes());<br>  }</p>
<p>  &#x2F;&#x2F;节点数据查询<br>  public void requireNode(String s) throws Exception {<br>    byte[] bytes &#x3D; client.getData().forPath(String.valueOf(s));<br>    System.out.println(new String(bytes));<br>  }</p>
<p>  &#x2F;&#x2F;删除单个节点<br>  @Test<br>  public void deleteSingleNode() throws Exception {<br>    client.create().forPath(“&#x2F;testAddForDelete”);<br>    client.delete().forPath(“&#x2F;testAddForDelete”);<br>  }</p>
<p>  &#x2F;&#x2F;删除多个节点<br>  @Test<br>  public void deleteMultiNode() throws Exception {<br>    client.create().creatingParentsIfNeeded().forPath(“&#x2F;DeleteMultiNode&#x2F;deleteMultiNode”, “Create Multi NodeForDelete”.getBytes());<br>    client.delete().deletingChildrenIfNeeded().forPath(“&#x2F;DeleteMultiNode”);<br>  }</p>
<p>  &#x2F;&#x2F;强制删除<br>  @Test<br>  public void forceDelete() throws Exception {<br>    &#x2F;&#x2F;NodeName&#x3D;”&#x2F;forceDelete&#x2F;forceDelete”;<br>    client.create().creatingParentsIfNeeded().forPath(“&#x2F;forceDelete&#x2F;forceDelete”, “Create Multi NodeForDelete”.getBytes());<br>    client.delete().guaranteed().deletingChildrenIfNeeded().forPath(“&#x2F;forceDelete”);<br>  }<br>}<br>3.4.4 小结<br>Curator是Appache封装操作Zookeeper的客户端, 操作zookeer数据变得更简单</p>
<p>使用步骤：</p>
<p>创建重试策略</p>
<p>创建客户端 url:port</p>
<p>启动客户端</p>
<p>使用客户端对节点操作</p>
<p>– create forPath, creatingparent…….., withMode(持久，临时)</p>
<p>– setData 修改数据</p>
<p>– getData 查询数据</p>
<p>– delete 删除数据， deletingChildrenIfNeeded递归删除</p>
<p>关闭客户端</p>
<p>3.5 watch机制</p>
<p>3.5.1 什么是watch机制<br>​ zookeeper作为一款成熟的分布式协调框架，订阅-发布功能是很重要的一个。订阅发布功能，就是观察者模式。观察者会订阅一些感兴趣的主题，然后这些主题一旦变化了，就会自动通知到这些观察者。</p>
<p> zookeeper的订阅发布也就是watch机制，是一个轻量级的设计。因为它采用了一种推拉结合的模式。一旦服务端感知主题变了，那么只会发送一个事件类型和节点信息给关注的客户端，而不会包括具体的变更内容，所以事件本身是轻量级的，这就是所谓的“推”部分。然后，收到变更通知的客户端需要自己去拉变更的数据，这就是“拉”部分。watche机制分为添加数据和监听节点。</p>
<p> Curator在这方面做了优化，Curator引入了Cache的概念用来实现对ZooKeeper服务器端进行事件监听。Cache是Curator对事件监听的包装，其对事件的监听可以近似看做是一个本地缓存视图和远程ZooKeeper视图的对比过程。而且Curator会自动的再次监听，我们就不需要自己手动的重复监听了。</p>
<p>Curator中的cache共有三种</p>
<p>NodeCache（监听和缓存根节点变化） 只监听单一个节点(变化 添加，修改，删除)<br>PathChildrenCache（监听和缓存子节点变化） 监听这个节点下的所有子节点(变化 添加，修改，删除)<br>TreeCache（监听和缓存根节点变化和子节点变化） NodeCache+ PathChildrenCache 监听当前节点及其下的所有子节点的变化<br>3.5.2 NodeCache<br>介绍</p>
<p>NodeCache是用来监听节点的数据变化的，当监听的节点的数据发生变化的时候就会回调对应的函数。</p>
<p>增加监听</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>public class TestCuratorCache {<br>  &#x2F;&#x2F;连接地址<br>  String url &#x3D; “127.0.0.1:2181”;<br>  &#x2F;&#x2F;会话超时时间<br>  int sessionTimeoutMs &#x3D; 1000;<br>  &#x2F;&#x2F;连接超时时间<br>  int connectionTimeoutMs &#x3D; 1000;<br>  &#x2F;&#x2F;重试策略<br>  RetryPolicy retryPolicy &#x3D; null;<br>  &#x2F;&#x2F;创建客户端<br>  CuratorFramework client &#x3D; null;</p>
<p>  @Before<br>  public void createLinkToZK() {<br>    &#x2F;&#x2F;重试策略<br>    retryPolicy &#x3D; new ExponentialBackoffRetry(1000, 1);<br>    &#x2F;&#x2F;创建客户端<br>    client &#x3D; CuratorFrameworkFactory.newClient(url, sessionTimeoutMs, connectionTimeoutMs, retryPolicy);<br>    &#x2F;&#x2F;启动客户端<br>    client.start();<br>  }</p>
<p>  @After<br>  public void closeLike() throws Exception {</p>
<pre><code>//关闭客户端
client.close();
</code></pre>
<p>  }</p>
<p>  @Test<br>  public void testNodeCache() throws Exception {<br>    client.create().forPath(“&#x2F;testNodeCache”);</p>
<pre><code>/*
    *NodeCache(客户端, 被监听节点);
     */
NodeCache nodeCache = new NodeCache(client, &quot;/testNodeCache&quot;);
/*
    * true  得到数据
    * false 不能获取节点数据
    */
nodeCache.start(true);

System.out.println(new String(nodeCache.getCurrentData().getData()));

client.setData().forPath(&quot;/testNodeCache&quot;, &quot;Update Node Cache&quot;.getBytes());
nodeCache.getListenable().addListener(new NodeCacheListener() &#123;
  @Override
  public void nodeChanged() throws Exception &#123;
    String data = new String(nodeCache.getCurrentData().getData());
    Thread.sleep(1000 * 2);
    System.out.println(nodeCache.getCurrentData().getPath() + &quot;  \t\t &quot; + data);
  &#125;
&#125;);
Thread.sleep(1000 * 4);
client.delete().forPath(&quot;/testNodeCache&quot;);
</code></pre>
<p>  }<br>}<br>测试</p>
<p>3.5.3 PathChildrenCache<br>介绍</p>
<p>PathChildrenCache是用来监听指定节点 的子节点变化情况</p>
<p>增加监听</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>@Test<br>public void testPathChildrenCache() throws Exception {</p>
<p>  client.create().forPath(“&#x2F;testPathChildrenCache”);<br>  &#x2F;*<br>        * new PathChildrenCache(客户端, 节点 , 是&#x2F;否得到数据);<br>         <em>&#x2F;<br>  PathChildrenCache pathChildrenCache &#x3D; new PathChildrenCache(client, “&#x2F;testPathChildrenCache”, true);<br>  &#x2F;&#x2F;&#x2F;</em>*<br>  &#x2F;&#x2F; * NORMAL:  普通启动方式, 在启动时缓存子节点数据<br>  &#x2F;&#x2F; * POST_INITIALIZED_EVENT：在启动时缓存子节点数据，提示初始化<br>  &#x2F;&#x2F; * BUILD_INITIAL_CACHE: 在启动时什么都不会输出<br>  &#x2F;&#x2F; *  在官方解释中说是因为这种模式会在start执行执行之前先执行rebuild的方法，而rebuild的方法不会发出任何事件通知。<br>  &#x2F;&#x2F; *&#x2F;<br>  pathChildrenCache.start(PathChildrenCache.StartMode.POST_INITIALIZED_EVENT);</p>
<p>  System.out.println(pathChildrenCache.getCurrentData());</p>
<p>  client.create().forPath(“&#x2F;testPathChildrenCache&#x2F;A”);<br>  client.setData().forPath(“&#x2F;testPathChildrenCache&#x2F;A”, “Update Node Message”.getBytes());<br>  pathChildrenCache.getListenable().addListener(new PathChildrenCacheListener() {<br>    @Override<br>    public void childEvent(CuratorFramework curatorFramework, PathChildrenCacheEvent pathChildrenCacheEvent) throws Exception {<br>      if (pathChildrenCacheEvent.getType() &#x3D;&#x3D; PathChildrenCacheEvent.Type.CHILD_UPDATED) {</p>
<pre><code>    System.out.println(&quot;CHILD_UPDATED Node: &quot;+pathChildrenCacheEvent.getData().getPath());
    System.out.println(&quot;CHILD_UPDATED Node Date :&quot;+new String(pathChildrenCacheEvent.getData().getPath()));
  &#125; else if (pathChildrenCacheEvent.getType() == PathChildrenCacheEvent.Type.INITIALIZED) &#123;
    System.out.println(&quot;Initialization&quot;);
  &#125; else if (pathChildrenCacheEvent.getType() == PathChildrenCacheEvent.Type.CHILD_REMOVED) &#123;
    System.out.println(&quot;CHILD_REMOVED Node: &quot;+pathChildrenCacheEvent.getData().getPath());
    System.out.println(&quot;CHILD_REMOVED Node Date :&quot;+new String(pathChildrenCacheEvent.getData().getPath()));
  &#125; else if (pathChildrenCacheEvent.getType() == PathChildrenCacheEvent.Type.CHILD_ADDED) &#123;
    System.out.println(&quot;CHILD_ADDED Node: &quot;+pathChildrenCacheEvent.getData().getPath());
    System.out.println(&quot;CHILD_ADDED Node Date :&quot;+new String(pathChildrenCacheEvent.getData().getPath()));
  &#125; else if (pathChildrenCacheEvent.getType() == PathChildrenCacheEvent.Type.CONNECTION_SUSPENDED) &#123;
    System.out.println(&quot;CONNECTION_SUSPENDED&quot;);
  &#125; else if (pathChildrenCacheEvent.getType() == PathChildrenCacheEvent.Type.CONNECTION_RECONNECTED) &#123;
    System.out.println(&quot;CONNECTION_RECONNECTED&quot;);
  &#125; else if (pathChildrenCacheEvent.getType() == PathChildrenCacheEvent.Type.CONNECTION_LOST) &#123;
    System.out.println(&quot;CONNECTION_LOST&quot;);
  &#125;
&#125;
</code></pre>
<p>  });<br>client.delete().guaranteed().deletingChildrenIfNeeded().forPath(“&#x2F;testPathChildrenCache”);<br>}<br>3.5.4 TreeCache<br>介绍</p>
<p>TreeCache有点像上面两种Cache的结合体，NodeCache能够监听自身节点的数据变化（或者是创建该节点），PathChildrenCache能够监听自身节点下的子节点的变化，而TreeCache既能够监听自身节点的变化、也能够监听子节点的变化。</p>
<p>添加监听</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>@Test<br>public void testTreeCache() throws Exception {</p>
<p>  client.create().forPath(“&#x2F;testTreeCache”);<br>  &#x2F;&#x2F;监听当前Node Data Tree<br>  TreeCache treeCache &#x3D; new TreeCache(client, “&#x2F;testTreeCache”);<br>  treeCache.start();</p>
<p>  System.out.println(treeCache.getCurrentData(“&#x2F;testTreeCache”));</p>
<p>  treeCache.getListenable().addListener(new TreeCacheListener() {<br>    @Override<br>    public void childEvent(CuratorFramework curatorFramework, TreeCacheEvent treeCacheEvent) throws Exception {<br>      if (treeCacheEvent.getType() &#x3D;&#x3D; TreeCacheEvent.Type.NODE_ADDED) {<br>        System.out.println(“NODE_ADDED: “+treeCacheEvent.getData().getPath());</p>
<pre><code>    client.delete().deletingChildrenIfNeeded().forPath(&quot;/testTreeCache/Test&quot;);

  &#125; else if (treeCacheEvent.getType() == TreeCacheEvent.Type.NODE_REMOVED) &#123;
    System.out.println(&quot;NODE_REMOVED: &quot;+treeCacheEvent.getData().getPath());

  &#125; else if (treeCacheEvent.getType() == TreeCacheEvent.Type.NODE_UPDATED) &#123;
    System.out.println(&quot;NODE_UPDATED: &quot;+treeCacheEvent.getData().getPath());

  &#125; else if (treeCacheEvent.getType() == TreeCacheEvent.Type.INITIALIZED) &#123;
    System.out.println(&quot;INITIALIZED&quot;);
  &#125; else if (treeCacheEvent.getType() == TreeCacheEvent.Type.CONNECTION_SUSPENDED) &#123;
    System.out.println(&quot;CONNECTION_SUSPENDED&quot;);
  &#125; else if (treeCacheEvent.getType() == TreeCacheEvent.Type.CONNECTION_RECONNECTED) &#123;
    System.out.println(&quot;CONNECTION_RECONNECTED&quot;);
  &#125; else if (treeCacheEvent.getType() == TreeCacheEvent.Type.CONNECTION_LOST) &#123;
    System.out.println(&quot;CONNECTION_LOST&quot;);
  &#125;
&#125;
</code></pre>
<p>  });<br>  client.delete().guaranteed().deletingChildrenIfNeeded().forPath(“&#x2F;testTreeCache”);<br>}<br>3.5.5 小结<br>Zookeeper：分布小文件存储系统，树形层级数据结构，路径唯一</p>
<p>动物管理员，管的是服务<br>应用：注册中心、配置中心、分布式锁、分布式队列、负载均衡<br>配置zoo.cfg dataPath, 2181</p>
<p>节点类型：持久化（有序与无序 -s），临时（-e 临时， -s 有序与无序) crud</p>
<p>api: Curator 创建重试策略-&gt;客户端(url ip:port)-&gt;启动-&gt;使用client操作crud-&gt;关闭</p>
<p>Watch: 监听节点数据变化，一旦生变更（添加、修改、删除）时，服务端通知客户端（addListener)</p>
<p>NodeCache: 听监听单一节点变化</p>
<p>PathChildrenCache: 监听节点下的子节点<br>TreeCache: NodeCache+PathChildrenCache</p>
<p>四.zookeeper集群搭建<br>目标</p>
<p>搭建Zookeeper集群</p>
<p>操作路径</p>
<p>了解集群</p>
<p>集群介绍<br>集群模式<br>集群原理及架构图</p>
<p>搭建集群（使用linux）</p>
<p>集群中Leader选举机制<br>测试集群</p>
<p>4.1 了解集群<br>4.1.1 集群介绍<br>Zookeeper 集群搭建指的是 ZooKeeper 分布式模式安装。 通常由 2n+1台 servers 组成 奇数。 这是因为为了保证 Leader 选举（基于 Paxos 算法的实现） 能或得到多数的支持，所以 ZooKeeper 集群的数量一般为奇数。</p>
<p>4.1.2 集群模式<br>伪分布式集群搭建<br>完全分布式集群搭建<br>4.2 架构图</p>
<p>集群工作的核心<br>事务请求（写操作） 的唯一调度和处理者，保证集群事务处理的顺序性；<br>集群内部各个服务器的调度者。<br>对于 create， setData， delete 等有写操作的请求，则需要统一转发给leader 处理， leader 需要决定编号、执行操作，这个过程称为一个事务。</p>
<p>Leader:Zookeeper(领导者):</p>
<p>集群工作的核心<br>事务请求（写操作） 的唯一调度和处理者，保证集群事务处理的顺序性；<br>集群内部各个服务器的调度者。<br>对于 create， setData， delete 等有写操作的请求，则需要统一转发给leader 处理， leader 需要决定编号、执行操作，这个过程称为一个事务。</p>
<p>Follower（跟随者）</p>
<p>处理客户端非事务（读操作） 请求，转发事务请求给 Leader；参与集群 Leader 选举投票 2n-1台可以做集群投票。</p>
<p>Observer:观察者角色</p>
<p>针对访问量比较大的 zookeeper 集群， 还可新增观察者角色。观察 Zookeeper 集群的最新状态变化并将这些状态同步过来，其对于非事务请求可以进行独立处理，对于事务请求，则会转发给 Leader服务器进行处理。<br>不会参与任何形式的投票只提供非事务服务，通常用于在不影响集群事务处理能力的前提下提升集群的非事务处理能力。</p>
<p>4.3 搭建过程<br>4.3.1 配置zookeeper-compose.yml<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>version: ‘2’<br>services:<br>    zoo1:<br>        image: zookeeper:3.4.14<br>        restart: always<br>        container_name: zoo1<br>        ports:<br>            - “2181:2181”<br>        environment:<br>            ZOO_MY_ID: 1<br>            ZOO_SERVERS: server.1&#x3D;zoo1:2888:3888 server.2&#x3D;zoo2:2888:3888 server.3&#x3D;zoo3:2888:3888</p>
<pre><code>zoo2:
    image: zookeeper:3.4.14
    restart: always
    container_name: zoo2
    ports:
        - &quot;2182:2181&quot;
    environment:
        ZOO_MY_ID: 2
        ZOO_SERVERS: server.1=zoo1:2888:3888 server.2=zoo2:2888:3888 server.3=zoo3:2888:3888
 
zoo3:
    image: zookeeper:3.4.14
    restart: always
    container_name: zoo3
    ports:
        - &quot;2183:2181&quot;
    environment:
        ZOO_MY_ID: 3
        ZOO_SERVERS: server.1=zoo1:2888:3888 server.2=zoo2:2888:3888 server.3=zoo3:2888:3888
</code></pre>
<p>这个配置文件会告诉 Docker 分别运行三个 zookeeper 镜像, 并分别将本地的 2181, 2182, 2183 端口绑定到对应的容器的2181端口上.<br>ZOO_MY_ID 和 ZOO_SERVERS 是搭建 ZK 集群需要设置的两个环境变量, 其中 ZOO_MY_ID 表示 ZK 服务的 id, 它是1-255 之间的整数, 必须在集群中唯一. ZOO_SERVERS 是ZK 集群的主机列表.</p>
<p>4.3.2 启动zookeeper<br>1<br>2<br>3<br>4<br>5<br>$ docker-compose -f zookeeper-compose.yml up -d<br>Creating network “program_default” with the default driver<br>Creating zoo3 … done<br>Creating zoo2 … done<br>Creating zoo1 … done<br>4.3.3 查看zookeeper状态<br>1<br>2<br>3<br>4<br>5<br>$ docker ps<br>CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                                        NAMES<br>63dacd015bf9        zookeeper:3.4.14    “&#x2F;docker-entrypoint.…”   6 minutes ago       Up 6 minutes        2888&#x2F;tcp, 0.0.0.0:2181-&gt;2181&#x2F;tcp, 3888&#x2F;tcp   zoo1<br>2bfaa57664f9        zookeeper:3.4.14    “&#x2F;docker-entrypoint.…”   6 minutes ago       Up 6 minutes        2888&#x2F;tcp, 3888&#x2F;tcp, 0.0.0.0:2182-&gt;2181&#x2F;tcp   zoo2<br>4ff61abb0d2f        zookeeper:3.4.14    “&#x2F;docker-entrypoint.…”   6 minutes ago       Up 6 minutes        2888&#x2F;tcp, 3888&#x2F;tcp, 0.0.0.0:2183-&gt;2181&#x2F;tcp   zoo3<br>4.4 leader选举<br>在领导者选举的过程中，如果某台ZooKeeper获得了超过半数的选票，则此ZooKeeper就可以成为Leader了。</p>
<p>服务器1启动，给自己投票，然后发投票信息，由于其它机器还没有启动所以它收不到反馈信息，服务器1的状态一直属于Looking(选举状态)。</p>
<p>服务器2启动，给自己投票，同时与之前启动的服务器1交换结果，</p>
<p>每个Server发出一个投票由于是初始情况，1和2都会将自己作为Leader服务器来进行投票，每次投票会包含所推举的服务器的myid和ZXID，使用(myid, ZXID)来表示，此时1的投票为(1, 0)，2的投票为(2, 0)，然后各自将这个投票发给集群中其他机器。<br>接受来自各个服务器的投票集群的每个服务器收到投票后，首先判断该投票的有效性，如检查是否是本轮投票、是否来自LOOKING状态的服务器</p>
<p>处理投票。针对每一个投票，服务器都需要将别人的投票和自己的投票进行PK，PK规则如下</p>
<p>　　　　· 优先检查ZXID。ZXID比较大的服务器优先作为Leader。</p>
<p>　　　　· 如果ZXID相同，那么就比较myid。myid较大的服务器作为Leader服务器</p>
<p>由于服务器2的编号大，更新自己的投票为(2, 0)，然后重新投票，对于2而言，其无须更新自己的投票，只是再次向集群中所有机器发出上一次投票信息即可，此时集群节点状态为LOOKING。</p>
<p>统计投票。每次投票后，服务器都会统计投票信息，判断是否已经有过半机器接受到相同的投票信息</p>
<p>服务器3启动，进行统计后，判断是否已经有过半机器接受到相同的投票信息，对于1、2、3而言，已统计出集群中已经有3台机器接受了(3, 0)的投票信息，此时投票数正好大于半数，便认为已经选出了Leader，</p>
<p>改变服务器状态。一旦确定了Leader，每个服务器就会更新自己的状态，如果是Follower，那么就变更为FOLLOWING，如果是Leader，就变更为LEADING</p>
<p>所以服务器3成为领导者，服务器1,2成为从节点。</p>
<p>4.5 测试集群<br>测试使用任何一个IP都可以获取</p>
<p>测试如果有个机器宕机，（.&#x2F;zkServer.sh stop），会重新选取领导者。</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>public class TestZookeeperCluster {</p>
<pre><code>CuratorFramework client = null;

@After
public void closeLike() throws Exception &#123;
    //关闭客户端
    client.close();
&#125;

@Test
public void createNode() throws Exception &#123;
    RetryPolicy retryPolicy = new ExponentialBackoffRetry(1000, 1);
    CuratorFramework client = CuratorFrameworkFactory.newClient(&quot;127.0.0.1:2181&quot;, 3000, 3000, retryPolicy);
    client.start();
    client.create().creatingParentsIfNeeded().withMode(CreateMode.PERSISTENT).forPath(&quot;/createNode/Nodes&quot;);
&#125;

@Test
public void updateNode() throws Exception &#123;
    //创建失败策略对象
    RetryPolicy retryPolicy = new ExponentialBackoffRetry(1000, 1);
    client = CuratorFrameworkFactory.newClient(&quot;127.0.0.1:2182&quot;, 1000, 1000, retryPolicy);
    client.start();
    client.setData().forPath(&quot;/createNode/Nodes&quot;, &quot;Update Node&quot;.getBytes());
    client.close();
&#125;

@Test
public void getData() throws Exception &#123;
    RetryPolicy retryPolicy = new ExponentialBackoffRetry(1000, 1);
    client = CuratorFrameworkFactory.newClient(&quot;127.0.0.1:2183&quot;, 1000, 1000, retryPolicy);
    client.start();
    byte[] bytes = client.getData().forPath(&quot;/createNode/Nodes&quot;);
    System.out.println(new String(bytes));
    client.close();
&#125;

@Test
public void deleteNode() throws Exception &#123;
    RetryPolicy retryPolicy = new ExponentialBackoffRetry(1000, 1);
    client = CuratorFrameworkFactory.newClient(&quot;127.0.0.1:2183&quot;, 1000, 1000, retryPolicy);
    client.start();
    client.delete().deletingChildrenIfNeeded().forPath(&quot;/createNode&quot;);
    client.close();
&#125;
</code></pre>
<p>}<br>4.6 小结<br>什么是集群：把具有相同功能应用布署多个到网络中，聚集一起，实现数据的同步，一旦有应用服务挂了，集群中的其它应用服务可以顶上，保证应用的正常运作</p>
<p>Zookeeper集群架构</p>
<p>Leader领导者 可以进行读写，写操作成功后会同步到各个从和观察者</p>
<p>Follower跟从者 只能读，如果有写操作时则转给Leader领导者处理 参与选举</p>
<p>Observer观察者 只能读，有写时也会转给Leader, 不参与Leader的选举</p>
<p>集群服务器个要为奇数2n+1，防止服务器down机，可以选举出新的leader</p>
<p>Leader先举机制</p>
<p>先投自己一票，票数相同时 票数&gt;zxid&gt;myid，其它zookeeper改为大者一票。集群中半数以上的票数才能成Leader</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swzxsyh.github.io/2020/06/15/Maven-Git/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="swzxsyh">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="swzxsyh">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/15/Maven-Git/" class="post-title-link" itemprop="url">Maven & Git</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-15 01:50:37" itemprop="dateCreated datePublished" datetime="2020-06-15T01:50:37+08:00">2020-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-10 04:40:38" itemprop="dateModified" datetime="2022-08-10T04:40:38+08:00">2022-08-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一.Maven<br>1.1 Maven基础回顾<br>目标</p>
<p>回顾Maven基础课程</p>
<p>学习路径</p>
<p>Maven好处<br>安装配置Maven<br>三种仓库<br>常见命令<br>坐标的书写规范<br>如何添加坐标<br>依赖范围<br>1.1.1 回顾<br>什么是Maven</p>
<p>Maven 是专门用于构建和管理Java相关项目的工具。</p>
<p>Maven好处</p>
<p>节省磁盘空间<br>可以一键构建<br>可以跨平台<br>应用在大型项目时可以提高开发效率（jar包管理，maven的工程分解，可分模块开发）<br>安装配置 maven</p>
<p>三种仓库</p>
<p>本地仓库，远程仓库（私服）, 公司内部中央仓库</p>
<p>常见的命令</p>
<p>Compile<br>Test<br>Package（jar，war）<br>Install（安装到本地仓库）<br>Deploy（部署到远程仓库（私服））<br>Clean（target下生成的文件）<br>坐标的书写规范</p>
<p>groupId 公司或组织域名的倒序<br>artifactId 项目名或模块名<br>version 版本号<br>如何添加坐标</p>
<p>在本地仓库中搜索<br>互联网上搜，推荐网址 <a target="_blank" rel="noopener" href="http://www.mvnrepository.com/">http://www.mvnrepository.com/</a><br>依赖范围</p>
<p><scope>属性：</scope></p>
<p>依赖范围	对于编译classpath有效	对于测试classpath有效	对于运行classpath有效	例子<br>Compile(默认)	Y	Y	Y	Spring-core<br>Test	-	Y	-	Junit<br>Provided	Y	Y	-	servlet-api<br>Runtime	-	Y	Y	JDBC驱动<br>System	Y	Y	-	本地的，Maven仓库之外的类库<br>1.1.2 小结<br>Maven好处<br>安装配置Maven（熟练）<br>三种仓库（本地仓库(阿里镜像)，中央仓库（远程仓库），私服（代理仓库））<br>常见命令（clean compile test package install deploy）<br>坐标的书写规范（groupId artifactId version）<br>如何添加坐标（<a target="_blank" rel="noopener" href="http://www.mvnrepository.com/%EF%BC%89">http://www.mvnrepository.com/）</a><br>依赖范围<br>私服的配置（settings.xml配置私服 工作中大概率要配置的）<br>1.2 Maven中jar包冲突问题<br>目标</p>
<p>使用maven依赖导入jar包，出现相同名称但版本不一致的jar包</p>
<p>学习路径</p>
<p>演示jar包冲突问题：遵循第一声明者优先原则<br>解决jar包冲突问题，路径近者优先<br>解决jar包冲突问题，直接排除法<br>首先创建一个Mavenjar包工程(New Project-Maven)</p>
<p>1.2.1 第一声明优先原则<br>哪个jar包在靠上的位置，这个jar包就是先声明的，先声明的jar包下的依赖包，可以优先引入项目中。</p>
<p>在pom.xml中引入如下坐标，分别是spring中不同的版本。</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br><?xml version="1.0" encoding="UTF-8"?><br><project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemalocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"><br>  <modelVersion>4.0.0</modelVersion></project></p>
<p>  <groupId>com.test</groupId><br>  <artifactId>Maven_Advanced</artifactId><br>  <version>1.0-SNAPSHOT</version></p>
<p>  <packaging>jar</packaging></p>
  <!--导入相关依赖包-->
  <dependencies>
    <!--引入spring-context，它所以来的包都会导入进来-->
    <dependency>
      <groupId>org.springframework</groupId>
      <artifactId>spring-context</artifactId>
      <version>5.0.2.RELEASE</version>
    </dependency>

<pre><code>&lt;dependency&gt;
  &lt;groupId&gt;org.springframework&lt;/groupId&gt;
  &lt;artifactId&gt;spring-beans&lt;/artifactId&gt;
  &lt;version&gt;4.2.4.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
  </dependencies>

在控制面板的maven面板，点击查看依赖关系按钮，看到了包和包之间的依赖关系存在冲突，都使用了spring-core包，关系图如下：



<p>看看他们依赖包的导入，发现导入的包却没有问题，包使用的都是5.0.2的版本。</p>
<p>我们把上面2个包的顺序调换后就变成了低版本的依赖导入。</p>
<p>1.2.2 路径近者优先原则<br>直接依赖：项目中直接导入的jar包就是项目的直接依赖包。<br>传递依赖（间接依赖）：项目中没有直接导入的jar包，可以通过中直接依赖包传递到项目中去。<br>直接依赖比传递依赖路径近，最终进入项目的jar包会是路径近的直接依赖包。<br>修改jar包，直接引入依赖spring-core</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21</p>
<!--导入相关依赖包-->
<dependencies>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-beans</artifactId>
        <version>4.2.4.RELEASE</version>
    </dependency>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
    &lt;version&gt;5.0.2.RELEASE&lt;/version&gt;
&lt;/dependency&gt;

&lt;!--引入直接依赖--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-core&lt;/artifactId&gt;
    &lt;version&gt;4.2.8.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
</dependencies>
此时优先引入的是直接依赖的引用



<p>1.2.3 直接排除法<br>问题：整合项目需要用到5的版本，引入4的版本，会不会出现异常（类没有找到，方法没有找到）<br>当我们需要排除某个jar包的依赖时，在配置exclusions标签的时候，内部可以不写版本号。pom.xml依赖如下：</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21</p>
<!--导入相关依赖包-->
<dependencies>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-beans</artifactId>
        <version>4.2.4.RELEASE</version>
        <!--直接排除-->
        <exclusions>
            <exclusion>
                <groupId>org.springframework</groupId>
                <artifactId>spring-core</artifactId>
            </exclusion>
        </exclusions>
    </dependency>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
    &lt;version&gt;5.0.2.RELEASE&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
</dependencies>
解决方案

<p>pom.xml添加exclusions</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br><exclusions><br>  <exclusion><br>    <artifactId>spring-core</artifactId><br>    <groupId>org.springframework</groupId><br>  </exclusion><br></exclusions><br>1.2.4 小结<br>出现1个项目存在多个同种jar包的时候，需要我们进行解决maven的jar包冲突问题（异常：Class not found、Method not found等）</p>
<p>路径近者<br>节点路径相同时，使用第一声明优先（xml上下顺序有关）<br>无法通过依赖管理原则排除的，使用直接排除法<br>1.3 工程分层<br>之前项目开发：</p>
<p>工程分层后的开发：所有的service和dao的代码都在一起，1：增强程序的通用性，2：降低了代码的耦合性</p>
<p>目标</p>
<p>实现项目工程分解，掌握聚合和继承的作用</p>
<p>学习路径</p>
<p>聚合和继承<br>准备数据库环境<br>ssm_parent（父工程） pom 引入依赖<br>ssm_model（子工程） 实体类<br>ssm_dao（子工程） 数据库操作<br>ssm_service（子工程） 完业务操作<br>ssm_web（子工程） 收集请求参数，调用业务，返回结果给前端<br>测试（工程发布tomcat）<br>1.3.1 聚合（多模块）和继承<br>继承和聚合结构图：</p>
<p>特点1（继承）</p>
<p>ssm_parent父工程：存放项目的所有jar包。</p>
<p>ssm_web和ssm_service和ssm_dao有选择的继承jar包，并在工程中使用。这样可以消除jar包重复，并锁定版本</p>
<p>特点2（聚合）</p>
<p>ssm_web依赖于ssm_service，ssm_service依赖于ssm_dao，启动ssm_web，便可访问程序。</p>
<p>执行安装的时候，执行ssm_parent，就可以将所有的子工程全部进行安装。</p>
<p>理解继承和聚合总结</p>
<p>通常继承和聚合同时使用。</p>
<p>何为继承</p>
<p>继承是为了消除重复，如果将 dao、 service、 web 分开创建独立的工程则每个工程的 pom.xml 文件中的内容存在重复，比如：设置编译版本、锁定 spring 的版本的等，可以将这些重复的 配置提取出来在父工程的 pom.xml 中定义。</p>
<p>何为聚合</p>
<p>项目开发通常是分组分模块开发， 每个模块开发完成要运行整个工程需要将每个模块聚合在 一起运行，比如： dao、 service、 web 三个工程最终会打一个独立的 war 运行。</p>
<p>1.3.2 准备数据库环境<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>SET FOREIGN_KEY_CHECKS&#x3D;0;</p>
<p>CREATE DATABASE Maven;<br>use Maven;<br>DROP TABLE IF EXISTS <code>items</code>;<br>CREATE TABLE <code>items</code> (<br>                         <code>id</code> int(10) NOT NULL auto_increment,<br>                         <code>name</code> varchar(20) default NULL,<br>                         <code>price</code> float(10,0) default NULL,<br>                         <code>pic</code> varchar(40) default NULL,<br>                         <code>createTime</code> datetime default NULL,<br>                         <code>detail</code> varchar(200) default NULL,<br>                         PRIMARY KEY  (<code>id</code>)<br>) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;9 DEFAULT CHARSET&#x3D;utf8;</p>
<p>INSERT INTO <code>items</code> VALUES (‘1’, ‘Test01’, ‘1000’, null, ‘2018-03-13 09:29:30’, ‘带我走上人生巅峰’);<br>INSERT INTO <code>items</code> VALUES (‘2’, ‘Test02’, null, null, ‘2018-03-28 10:05:52’, ‘插入测试’);<br>INSERT INTO <code>items</code> VALUES (‘3’, ‘Test03’, ‘199’, null, ‘2018-03-07 10:08:04’, ‘插入测试’);<br>INSERT INTO <code>items</code> VALUES (‘7’, ‘Test04’, null, null, null, null);<br>INSERT INTO <code>items</code> VALUES (‘8’, ‘Test05’, null, null, null, null);<br>1.3.3 ssm_parent<br>创建ssm_parent的Maven Project<br>删除src文件夹<br>1.3.3.1 pom.xml<br>父工程：<packaging>pom</packaging></p>
<p>详细信息<br>小结</p>
<p><package>pom<br>管理所有的jar包（并锁定版本）<br>父工程不需要开发的代码，src的文件夹可以删除<br>1.3.4 ssm_model<br>选择ssm_parent&#x3D;&gt;New-&gt;Moudle-&gt;Maven-&gt;创建子项目ssm_model(即实体类)</package></p>
<p>1.3.4.1 pom.xml<br>查看子工程pom.xml</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br><?xml version="1.0" encoding="UTF-8"?><br><project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemalocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"><br>    <parent><br>        <artifactId>ssm_parent</artifactId><br>        <groupId>com.test</groupId><br>        <version>1.0-SNAPSHOT</version><br>    </parent><br>    <modelVersion>4.0.0</modelVersion></project></p>
<pre><code>&lt;artifactId&gt;ssm_model&lt;/artifactId&gt;
&lt;packaging&gt;jar&lt;/packaging&gt;
</code></pre>

回去查看ssm_parent的pom.xml，自动聚合类ssm_model

<p>1<br>2<br>3<br><modules><br>  <module>ssm_model</module><br></modules><br>1.3.4.2 创建Items.java<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>public class Items {<br>    private Integer id;<br>    private String name;<br>    private Float price;<br>    private String pic;<br>    private Date createTime;<br>    private String detail;<br>&#x2F;&#x2F;此处省略getter&#x2F;setter，toString<br>}<br>小结<br><package>jar<br>管理项目中所有的实体类<br>1.3.5 ssm_dao<br>操作路径<br>配置pom.xml<br>创建spring-mybatis.xml（spring整合mybatis的配置）<br>创建ItemsDao.java<br>创建ItemsDao.xml<br>1.3.5.1 pom.xml<br>详细信息<br>查看父工程pom.xml</package></p>
<p>1<br>2<br>3<br>4<br><modules><br>  <module>ssm_model</module><br>  <module>ssm_dao</module><br></modules><br>1.3.5.2 创建spring-mybatis.xml<br>操作路径</p>
<p>设置数据库连接池<br>配置SqlSessionFactoryBean<br>添加Dao层接口扫描，让Dao被spring管理<br>spring-mybatis.xml</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br><?xml version="1.0" encoding="UTF-8"?><br><beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemalocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"><br>    <!--1.数据库连接池--><br>    <bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource"><br>        <property name="driverClassName" value="com.mysql.jdbc.Driver"><br>        <property name="url" value="jdbc:mysql://localhost:3306/Maven"><br>        <property name="username" value="root"><br>        <property name="password" value="root"><br>    </property></property></property></property></bean></beans></p>
<pre><code>&lt;!--2.配置sqlSessionFactoryBean--&gt;
&lt;bean id=&quot;sqlSessionFactory&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt;
    &lt;!--配置数据源--&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
    &lt;!--别名配置--&gt;
    &lt;property name=&quot;typeAliases&quot; value=&quot;com.test.domain&quot;/&gt;
&lt;/bean&gt;

&lt;!--3.dao接口扫描--&gt;
&lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt;
    &lt;property name=&quot;basePackage&quot; value=&quot;com.test.dao&quot;/&gt;
&lt;/bean&gt;
</code></pre>

1.3.5.3 创建ItemsDao.java
1
2
3
4
5
public interface ItemsDao {
    List<Items> findAll();

<pre><code>int save(Items items);
</code></pre>
<p>}<br>1.3.5.4 创建ItemsDao.xml<br>com&#x2F;test&#x2F;dao&#x2F;ItemsDao.xml</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br><?xml version="1.0" encoding="UTF-8" ?><br><!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd"></p>
<!--
    namespace="Dao接口的全限定名"
-->
<mapper namespace="com.test.dao.ItemsDao">

  <!--保存操作-->
  <insert id="save" parametertype="com.test.domain.Items">
    INSERT  INTO items(name,price,pic,creaTetime,detail) VALUES(#{name},#{price},#{pic},#{createTime},#{detail})
  </insert>

  <!--查询所有-->
  <select id="findAll" resulttype="com.test.domain.Items">
    SELECT * FROM items
  </select>
</mapper>
1.3.5.5 dao测试
1
2
3
4
5
6
7
8
9
10
@Test
public  void testFindAll() {
  ClassPathXmlApplicationContext classPathXmlApplicationContext = new ClassPathXmlApplicationContext("classpath:spring-mybatis.xml");
  ItemsDao itemsDao = classPathXmlApplicationContext.getBean(ItemsDao.class);
  List<Items> all = itemsDao.findAll();

<p>  for (Items items : all) {<br>    System.out.println(items);<br>  }<br>}<br>小结<br><package>jar<br>引入依赖 ssm_model 、mybatis的依赖…<br>spring-mybatis.xml（spring的配置文件）（spring整合mybatis的框架）<br>数据源<br>工厂<br>包扫描(dao)<br>接口ItemsDao.java<br>创建映射文件ItemsDao.xml (映射文件路径与包名相同, resources目录下的)<br>1.3.6 ssm_service<br>操作路径<br>pom.xml<br>创建spring-service.xml（spring的声明式事务处理）<br>创建ItemsService接口<br>创建ItemsServiceImpl实现类<br>1.3.6.1 pom.xml<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br><?xml version="1.0" encoding="UTF-8"?><br><project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemalocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"><br>    <parent><br>        <artifactId>ssm_parent</artifactId><br>        <groupId>com.test</groupId><br>        <version>1.0-SNAPSHOT</version><br>    </parent><br>    <modelVersion>4.0.0</modelVersion></project></package></p>
<pre><code>&lt;artifactId&gt;ssm_service&lt;/artifactId&gt;


&lt;!--jar包--&gt;
&lt;packaging&gt;jar&lt;/packaging&gt;

&lt;!--依赖--&gt;
&lt;dependencies&gt;
    &lt;!--依赖dao--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.test&lt;/groupId&gt;
        &lt;artifactId&gt;ssm_dao&lt;/artifactId&gt;
        &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
    &lt;/dependency&gt;

    &lt;!-- spring --&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.aspectj&lt;/groupId&gt;
        &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-aop&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
    &lt;/dependency&gt;

    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-tx&lt;/artifactId&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
</code></pre>

1.3.6.2 创建spring-service.xml
操作路径
创建一个事务管理器
配置事务的通知，及传播特性，对切入点方法的细化
AOP声明式事务配置（配置切入点，通知关联切入点）
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tx="http://www.springframework.org/schema/tx" xmlns:aop="http://www.springframework.org/schema/aop" xmlns:context="http://www.springframework.org/schema/context" xsi:schemalocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/tx
       http://www.springframework.org/schema/tx/spring-tx.xsd
       http://www.springframework.org/schema/aop
       http://www.springframework.org/schema/aop/spring-aop.xsd
       http://www.springframework.org/schema/context
       http://www.springframework.org/schema/context/spring-context.xsd">
    <!--1.创建一个事务管理器-->
    <bean id="txtManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
        <!--指定数据源-->
        <property name="dataSource" ref="dataSource">
    </property></bean>

<pre><code>&lt;!--2.方式一：声明式事务配置--&gt;
&lt;tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;txtManager&quot;&gt;
    &lt;!--配置传播特性属性--&gt;
    &lt;tx:attributes&gt;
        &lt;!--
            对应方法参与事务并且在事务下执行，事务隔离剂别使用默认隔离级别,发生异常需要事务回滚
        --&gt;
      &lt;tx:method name=&quot;add*&quot; isolation=&quot;DEFAULT&quot; propagation=&quot;REQUIRED&quot; rollback-for=&quot;java.lang.Exception&quot; /&gt;
      &lt;tx:method name=&quot;insert*&quot; isolation=&quot;DEFAULT&quot; propagation=&quot;REQUIRED&quot; rollback-for=&quot;java.lang.Exception&quot; /&gt;
      &lt;tx:method name=&quot;save*&quot; isolation=&quot;DEFAULT&quot; propagation=&quot;REQUIRED&quot; rollback-for=&quot;java.lang.Exception&quot; /&gt;
      &lt;tx:method name=&quot;delete*&quot; isolation=&quot;DEFAULT&quot; propagation=&quot;REQUIRED&quot; rollback-for=&quot;java.lang.Exception&quot; /&gt;
      &lt;tx:method name=&quot;update*&quot; isolation=&quot;DEFAULT&quot; propagation=&quot;REQUIRED&quot; rollback-for=&quot;java.lang.Exception&quot; /&gt;
      &lt;tx:method name=&quot;edit*&quot; isolation=&quot;DEFAULT&quot; propagation=&quot;REQUIRED&quot; rollback-for=&quot;java.lang.Exception&quot; /&gt;
        &lt;!--
            只读操作
        --&gt;
        &lt;tx:method name=&quot;*&quot; read-only=&quot;true&quot; /&gt;
    &lt;/tx:attributes&gt;
&lt;/tx:advice&gt;
 &lt;!--AOP声明式事务配置（配置切入点，通知关联切入点）--&gt;
&lt;aop:config&gt;
    &lt;!--切点指点--&gt;
    &lt;aop:pointcut id=&quot;tranpointcut&quot; expression=&quot;execution(* com.test.service.*.*(..))&quot; /&gt;
    &lt;!--配置通知--&gt;
    &lt;aop:advisor advice-ref=&quot;txAdvice&quot; pointcut-ref=&quot;tranpointcut&quot; /&gt;
&lt;/aop:config&gt;
&lt;!--方式二：注解方式事务配置--&gt;
&lt;!--&lt;tx:annotation-driven transaction-manager=&quot;txtManager&quot;/&gt;--&gt;
&lt;!--3.扫描service--&gt;
&lt;context:component-scan base-package=&quot;com.test.service&quot;/&gt;
&lt;!--4.引入spring-mybatis.xml--&gt;
&lt;import resource=&quot;spring-mybatis.xml&quot; /&gt;
</code></pre>
</beans>
1.3.6.3 创建ItemsService接口
1
2
3
4
5
public interface ItemsService {
    List<Items> findAll();

<pre><code>void save(Items items);
</code></pre>
<p>}<br>1.3.6.4 创建ItemsServiceImpl<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>@Service<br>public class ItemsServiceImpl implements ItemsService {<br>    @Autowired<br>    private ItemsDao itemsDao;</p>
<pre><code>@Override
public List&lt;Items&gt; findAll() &#123;
    return itemsDao.findAll();
&#125;

@Override
public void save(Items items) &#123;
    itemsDao.save(items);
&#125;
</code></pre>
<p>}<br>1.3.6.5 service测试<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>public class ServiceTest {<br>  @Test<br>  public void testService(){<br>    ClassPathXmlApplicationContext classPathXmlApplicationContext &#x3D; new ClassPathXmlApplicationContext(“classpath:spring-service.xml”);<br>    ItemsService bean &#x3D; classPathXmlApplicationContext.getBean(ItemsService.class);<br>    List<Items> all &#x3D; bean.findAll();</Items></p>
<pre><code>for (Items items : all) &#123;
  System.out.println(items);
&#125;
</code></pre>
<p>  }<br>}<br>小结<br><package>jar<br>引入依赖 ssm_dao 、spring相关的依赖<br>spring-service.xml（声明式事务处理）<br>扫描业务层<br>事务管理器<br>通知-&gt;切的方法<br>aop:config<br>要切的包 表达式<br>把advice与pointcut整合起来<br>注解式事务<br>接口ItemsService.java<br>实现类ItemsServiceImpl.java<br>1.3.7 ssm_web<br>操作路径<br>pom.xml<br>创建web.xml<br>创建springmvc.xml<br>创建ItemsController.java<br>创建页面items.jsp<br>1.3.7.1 pom.xml<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>59<br>60<br>61<br>62<br>63<br>64<br>65<br>66<br>67<br>68<br>69<br>70<br>71<br>72<br>73<br>74<br>75<br>76<br>77<br>78<br><?xml version="1.0" encoding="UTF-8"?><br><project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemalocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"><br>  <parent><br>    <artifactId>ssm_parent</artifactId><br>    <groupId>com.test</groupId><br>    <version>1.0-SNAPSHOT</version><br>  </parent><br>  <modelVersion>4.0.0</modelVersion></project></package></p>
<p>  <artifactId>ssm_web</artifactId></p>
  <!--war包-->
<p>  <packaging>war</packaging></p>
  <!--依赖引入-->
  <dependencies>
    <!--依赖service-->
    <dependency>
      <groupId>com.test</groupId>
      <artifactId>ssm_service</artifactId>
      <version>1.0-SNAPSHOT</version>
    </dependency>

<pre><code>&lt;!--导入springmvc--&gt;
&lt;dependency&gt;
  &lt;groupId&gt;org.springframework&lt;/groupId&gt;
  &lt;artifactId&gt;spring-web&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
  &lt;groupId&gt;org.springframework&lt;/groupId&gt;
  &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;
&lt;/dependency&gt;

&lt;!--servletAPI --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;javax.servlet&lt;/groupId&gt;
  &lt;artifactId&gt;servlet-api&lt;/artifactId&gt;
  &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;

&lt;dependency&gt;
  &lt;groupId&gt;javax.servlet.jsp&lt;/groupId&gt;
  &lt;artifactId&gt;jsp-api&lt;/artifactId&gt;
  &lt;scope&gt;provided&lt;/scope&gt;
&lt;/dependency&gt;

&lt;!--jstl表达式 --&gt;
&lt;dependency&gt;
  &lt;groupId&gt;jstl&lt;/groupId&gt;
  &lt;artifactId&gt;jstl&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre>
  </dependencies>


  <build>
    <!--插件-->
    <plugins>
      <!--tomcat插件-->
      <plugin>
        <groupId>org.apache.tomcat.maven</groupId>
        <artifactId>tomcat7-maven-plugin</artifactId>
        <!--插件使用的相关配置-->
        <configuration>
          <!--端口号-->
          <port>18081</port>
          <!--写当前项目的名字(虚拟路径),如果写/，那么每次访问项目就不需要加项目名字了-->
          <path></path>/
          <!--解决get请求乱码-->
          <uriEncoding>UTF-8</uriEncoding>
        </configuration>
      </plugin>
    </plugins>
  </build>

1.3.7.2 创建web.xml
操作路径

<p>配置编码过滤器</p>
<p>springmvc前端核心控制器</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>.<br>├── pom.xml<br>├── src<br>│   ├── main<br>│   │   ├── java<br>│   │   ├── resources<br>│   │   └── webapp<br>│   │       └── WEB-INF<br>│   │           └── web.xml<br>│   └── test<br>│       └── java<br>└── ssm_web.iml<br>web.xml</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br><?xml version="1.0" encoding="UTF-8"?><br><web-app xmlns="http://xmlns.jcp.org/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemalocation="http://xmlns.jcp.org/xml/ns/javaee http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd" version="3.1"><br>    <!--1.配置编码过滤器--><br>    <filter><br>        <filter-name>encodingFilter</filter-name><br>        <filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class><br>        <!--编码设置--><br>        <init-param><br>            <param-name>encoding</param-name><br>            <param-value>UTF-8</param-value><br>        </init-param><br>    </filter><br>    <filter-mapping><br>        <filter-name>encodingFilter</filter-name><br>        <url-pattern>&#x2F;*</url-pattern><br>    </filter-mapping></web-app></p>
<pre><code>&lt;!--2.springmvc核心控制器--&gt;
&lt;servlet&gt;
    &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;
    &lt;init-param&gt;
        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
        &lt;param-value&gt;classpath:spring-mvc.xml&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;!--启动优先级--&gt;
    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
&lt;/servlet&gt;
&lt;!--3.指定映射拦截--&gt;
&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;dispatcherServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
</code></pre>

1.3.7.3 创建springmvc.xml
操作路径

<p>包扫描<br>视图解析器<br>springmvc注解驱动，自动配置mvc的处理器适配器和处理映射器<br>静态资源不过滤<br>mport导入spring.xml<br>springmvc.xml</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br><?xml version="1.0" encoding="UTF-8"?><br><beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context" xmlns:mvc="http://www.springframework.org/schema/mvc" xsi:schemalocation="http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc.xsd"><br>    <!--1：包扫描--><br>    &lt;context:component-scan base-package&#x3D;”com.test.controller”&#x2F;&gt;<br>    <!--2：视图解析器--><br>    <bean class="org.springframework.web.servlet.view.InternalResourceViewResolver"><br>        <property name="prefix" value="/WEB-INF/pages/"><br>        <property name="suffix" value=".jsp"><br>    </property></property></bean><br>    <!--3：springmvc注解驱动，自动配置mvc的处理器适配器和处理映射器--><br>    <a href="mvc:annotation-driven/">mvc:annotation-driven/</a><br>    <!--4：静态资源不过滤--><br>    <a href="mvc:default-servlet-handler/">mvc:default-servlet-handler/</a><br>    <!--5：导入spring.xml--><br>    <import resource="spring-service.xml"><br></import></beans><br>1.3.7.4 创建ItemsController<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24</p>
<p>@Controller<br>@RequestMapping(“&#x2F;list”)<br>public class ItemsController {</p>
<pre><code>@Autowired
private ItemsService itemsService;

@GetMapping(&quot;/findAll&quot;)
public String findAll(Model model)&#123;
    List&lt;Items&gt; list = itemsService.findAll();
    for (Items items : list) &#123;
        System.out.println(items);
    &#125;
    model.addAttribute(&quot;list&quot;,list);
    return &quot;list&quot;;
&#125;

@PostMapping(&quot;/save&quot;)
public String  save(Items items)&#123;
    itemsService.save(items);
    return &quot;redirect:/list/findAll&quot;;
&#125;
</code></pre>
<p>}<br>1.3.7.5 创建页面items.jsp<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>&lt;%@ taglib prefix&#x3D;”c” uri&#x3D;”<a target="_blank" rel="noopener" href="http://java.sun.com/jsp/jstl/core&quot;">http://java.sun.com/jsp/jstl/core&quot;</a> %&gt;<br>&lt;%@ page contentType&#x3D;”text&#x2F;html;charset&#x3D;UTF-8” language&#x3D;”java” %&gt;</p>
<html>
<head>
    <title>Title</title>
</head>
<body>
<table>
    <form action="${pageContext.request.contextPath}/list/save" method="post">
        <table>
            <tr>
                <td>名称</td>
                <td><input type="text" name="name"></td>
            </tr>
            <tr>
                <td>价格</td>
                <td><input type="text" name="price"></td>
            </tr>
            <tr>
                <td>创建日期</td>
                <td><input type="text" name="createTime"></td>
            </tr>
            <tr>
                <td>详情</td>
                <td><input type="text" name="detail"></td>
            </tr>
            <tr>
                <td colspan="2">
                    <input type="submit" value="提交">
                </td>
            </tr>
        </table>
    </form>
</table>
<hr>


<table border="1">
    <tr>
        <td>ID</td>
        <td>name</td>
        <td>price</td>
        <td>createTime</td>
        <td>detail</td>
    </tr>
    <tr>
        <c:forEach items="${list}" var="item">
        <td>${item.id}</td>
        <td>${item.name}</td>
        <td>${item.price}</td>
        <td>${item.pic}</td>
        <td>${item.createTime}</td>
        <td>${item.detail}</td>
    </c:forEach></tr>
    
</table>
</body>
</html>
1.3.7.6 小结
<package>war
引入依赖 ssm_service 、 springmvc 、 servlet_api等
springmvc.xml（springmvc的相关配置）
web.xml（springmvc的核心控制器、post乱码过滤器）
类ItemsController.java
测试页面items.jsp
1.3.8 测试
操作路径
测试打包package、安装install（演示maven聚合）
发布到外部tomcat
使用maven的tomcat插件发布
1.3.8.1 方式一：tomcat插件发布（配置父工程）
parent是有聚合的功能，不需要将ssm_parent，ssm_model，ssm_dao，ssm_service安装到本地仓库。

<p>1.3.8.2 方式二：tomcat插件发布（配置web工程）<br>需要将ssm_parent，ssm_model，ssm_dao，ssm_service安装到本地仓库。</p>
<p>1.3.8.3 方式三：发布到外部tomcat<br>当使用外部tomcat进行开发的时候，不需要将ssm_parent，ssm_model，ssm_dao，ssm_service安装到本地仓库。</p>
<p>1.3.8.4 小结<br>1：拆分与聚合和继承</p>
<p>​ 拆分：解耦，代码最大程度的重复使用，维护方便</p>
<p>​ 聚合：靠父工程来聚合，单一工程是没法完成工作。</p>
<p>​ 继承：父工程引入依赖，子工程就不需要再引了</p>
<p>2: Maven的jar包冲突解决</p>
<p>路径近者优先<br>路径相同，第一声明优先<br>路径相同，使用强制排除exclusions<br>3：准备数据库环境</p>
<p>ssm_parent（父工程）聚合，引入依赖管理</p>
<p>ssm_model（子工程） 实体类</p>
<p>ssm_dao（子工程） mybatis, dataSource, sqlSessionFactorybean, MapperScannerConfigurer</p>
<p>注：映射文件的路径必须与包名路径一样</p>
<p>ssm_service（子工程）</p>
<p>扫service包，事务管理器，通知、切面。</p>
<p>ssm_web（子工程）</p>
<p>SpringMVC.xml 扫controller, 视图解析器，注解驱动，静态资源过滤<br>web.xml 编码过滤器，前端核心控制器(load-on-startup)<br>8：测试（工程发布tomcat）</p>
<p>推荐使用本地tomcat<br>1.4 补充<br>Maven项目，如果正在下载一个jar，但是突然断网，此时，就会产生一个m2e-lastUpdated.，别指望下次上网就会自动下载，必须手动删除该文件，然后再进行下载。</p>
<p>二.Git<br>学习目标：</p>
<p>能够概述git基本概念<br>能够概述git工作流程<br>能够使用git基本命令<br>能够使用idea操作git<br>2.1 Git版本控制系统目标<br>速度<br>简单的设计<br>对非线性开发模式的强力支持（允许上千个并行开发的分支）<br>完全分布式<br>有能力高效管理类似 Linux 内核一样的超大规模项目（速度和数据量）<br>2.2 Git与svn对比<br>SVN是集中式版本控制系统，版本库是集中放在中央服务器的</p>
<p>集中管理方式在一定程度上看到其他开发人员在干什么，而管理员也可以很轻松掌握每个人的开发权限。</p>
<p>但是相较于其优点而言，集中式版本控制工具缺点很明显：</p>
<p>服务器单点故障<br>容错性差<br>Git是分布式版本控制系统，那么它就没有中央服务器的</p>
<p>小结</p>
<p>git: 是一个代码(文档)版本的管理工具</p>
<p>svn：集中式版本控制工具（服务器完成对文件的版本控制）（一个仓库）</p>
<p>git：分布式版本控制工具（客户端、服务器都可以完成对文件的版本控制）（两个仓库，本地仓库、远程仓库）</p>
<p>2.3 git工作流程<br>一般工作流程如下：</p>
<p>从远程仓库中克隆 Git 资源作为本地仓库。</p>
<p>从本地仓库中checkout代码然后进行代码修改</p>
<p>在提交前先将代码提交到暂存区。</p>
<p>提交执行commit命令。提交到本地仓库。本地仓库中保存修改的各个历史版本。</p>
<p>在修改完成后，需要和团队成员共享代码时，可以将本地仓库的代码push到远程仓库。</p>
<p>小结</p>
<p>本地仓库——存入工程代码zip<br>工作区—— idea工作目录(代码明文)<br>暂存区<br>​ 命令：</p>
<p>远程仓库：(代码与他人共享的地方)</p>
<p>add（添加到暂存区）；</p>
<p>commit（提交到本地仓库）</p>
<p>clone（远程仓库的代码克隆到本地仓库 所有的版本）；</p>
<p>pull（将代码从远程仓库拉取到本地开发 只拉取某一版本的代码, 会尝试合并(远程与本地)）；</p>
<p>push（将代码从本地仓库推送到远程仓库）</p>
<p>clone与pull的区别</p>
<p>​ clone：第一次连接远程仓库 所有的版本 初始化</p>
<p>​ pull：第一次用clone命令，如果已经连接是哪个，其他都用pull命令拉取 只拉取某一版本的代码 会尝试合并(远程与本地)</p>
<p>2.4 使用git管理文件版本<br>目标</p>
<p>使用git在本地仓库完成版本控制，及相关命令的是使用</p>
<p>学习路径</p>
<p>创建版本库<br>添加&#x2F;修改&#x2F;删除文件&#x2F;删除文件并保留副本<br>将java工程提交到版本库<br>忽略文件（提交版本库时，可忽略某些文件）<br>2.4.1 创建版本库<br>什么是版本库呢？版本库又名仓库，英文名repository，你可以简单理解成一个目录，这个目录里面的所有文件都可以被Git管理起来，每个文件的新增、修改、删除，Git都能跟踪，以便任何时刻都可以追踪历史，或者在将来某个时刻可以“还原”。由于git是分布式版本管理工具，所以git在不需要联网的情况下也具有完整的版本管理能力。</p>
<p>创建本地仓库执行命令</p>
<p>1<br>$ git init<br>查看</p>
<p>1<br>2<br>$ ls -a | grep git<br> .git<br>创建服务器仓库</p>
<p>1<br>$ git –bare init<br>小结</p>
<p>git init 有工作空间，可以编码，一般用于客户端</p>
<p>git –bare init没有有工作空间，不可以编码，一般用于服务端</p>
<p>概念：</p>
<p>版本库</p>
<p>“.git”目录就是版本库，将来文件都需要保存到版本库中。</p>
<p>工作目录（工作区）</p>
<p>包含“.git”目录的目录，也就是.git目录的上一级目录就是工作目录。只有工作目录中的文件或者是文件夹才能保存到版本库中。</p>
<p>2.4.2 添加文件<br>2.4.2.1 添加文件过程<br>在git init的目录下创建一个文件</p>
<p>1<br>$ touch readme.txt<br>使用git add 命令即加入缓存区</p>
<p>1<br>$ git add readme.txt<br>使用git commit 添加注释并提交</p>
<p>1<br>$ git commit -m “Comment Message”<br>2.4.2.2 工作区和暂存区<br>Git和其他版本控制系统如SVN的一个不同之处就是有暂存区的概念。</p>
<p>什么是工作区（Working Directory）？</p>
<p>​ 工作区就是你在电脑里能看到的目录，比如我的reporstory&#x2F;repo1文件夹就是一个工作区。</p>
<p>什么是版本库？</p>
<p>​ 在这个工作区目录中的“.git”隐藏文件夹是版本库。</p>
<p>​ Git的版本库里存了很多东西，其中最重要的就是称为stage（或者叫index）的暂存区，还有Git为我们自动创建的第一个分支master，以及指向master的一个指针叫HEAD。</p>
<p>可以简单理解为，需要提交的文件修改通通放到暂存区，然后，一次性提交暂存区的所有修改。</p>
<p>2.4.2.3 修改文件<br>2.4.2.3.1 提交修改<br>修改文件</p>
<p>显示修改文件</p>
<p>1<br>$ git status<br>显示修改内容</p>
<p>1<br>$ git diff readme.txt<br>使用git add 命令即加入缓存区</p>
<p>1<br>$ git add readme.txt<br>使用git commit 添加注释并提交</p>
<p>1<br>$ git commit -m “New Comment Message”<br>2.4.2.3.2 查看修改历史<br>查看修改历史</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>$ git log | less | grep -v “swzxsyh”<br>commit 360abaca1a57aa9a9652c57fc3b06cf8a2c16742<br>Date:   Tue Jan 29 17:01:39 2019 +0800</p>
<p>Learning Part of C Language</p>
<p>commit 9b1e91b72926493818ccbafd1447c2ae3fe8af55<br>Date:   Tue Jan 29 16:57:04 2019 +0800</p>
<p>Cisco Packet Tracer ReadME<br>恢复版本</p>
<p>1<br>$ git checkout – <file><br>2.4.2.3.3 差异比较<br>1<br>$ git diff 新版本号 旧版本号<br>2.4.2.3.4 还原修改<br>1<br>$ git reset HEAD <file>…<br>注意：此操作会撤销所有未提交的修改，所以当使用还原操作是需要慎重</file></file></p>
<p>2.4.2.4 删除文件<br>需要删除无用的文件时可以使用git提供的删除功能直接将文件从版本库中删除。</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>$ rm readme.txt</p>
<p>$ git rm readme.txt</p>
<p>$ git commit -m “rm readme.txt”</p>
<p>$ git push resp<br>2.4.2.5 删除文件并保留副本<br>1<br>2<br>3<br>4<br>#对于一个文件：<br>git rm –cached mylogfile.log<br>#对于一个目录：<br>git rm –cached -r mydirectory<br>2.4.2.6 案例：将java工程-提交到版本库<br>创建HelloProjet项目，将工程添加到暂存区。</p>
<p>1<br>$ git add HelloProjet&#x2F;<br>忽略文件或文件夹</p>
<p>并不是所有文件都需要保存到版本库中的例如“out”目录及目录下的文件就可以忽略。</p>
<p>需要创建.gitignore文件，并添加ignore内容</p>
<p>1<br>$ echo “out.idea” &gt;&gt; .gitignore<br>提交代码</p>
<p>1<br>$ git commit -m “HelloProjet”<br>2.4.2.7 忽略文件（.gitignore）语法规范<br>空行或是以 # 开头的行即注释行将被忽略。</p>
<p>可以在前面添加正斜杠 &#x2F; 来避免递归,下面的例子中可以很明白的看出来与下一条的区别。</p>
<p>可以在后面添加正斜杠 &#x2F; 来忽略文件夹，例如 build&#x2F; 即忽略build文件夹。</p>
<p>可以使用 ! 来否定忽略，即比如在前面用了 *.apk ，然后使用 !a.apk ，则这个a.apk不会被忽略。</p>
<p>*用来匹配零个或多个字符，如 *.[oa] 忽略所有以”.o”或”.a”结尾， *~ 忽略所有以 ~ 结尾的文件（这种文件通常被许多编辑器标记为临时文件）； [] 用来匹配括号内的任一字符，如 [abc] ，也可以在括号内加连接符，如 [0-9] 匹配0至9的数； ? 用来匹配单个字符。</p>
<p>看了这么多，还是应该来个例子：</p>
<p>gitignore文件</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12</p>
<h1 id="忽略-a-文件"><a href="#忽略-a-文件" class="headerlink" title="忽略 .a 文件"></a>忽略 .a 文件</h1><p>*.a</p>
<h1 id="不忽略-lib-a-尽管已经在前面忽略了-a-文件"><a href="#不忽略-lib-a-尽管已经在前面忽略了-a-文件" class="headerlink" title="不忽略 lib.a, 尽管已经在前面忽略了 .a 文件"></a>不忽略 lib.a, 尽管已经在前面忽略了 .a 文件</h1><p>!lib.a</p>
<h1 id="仅在当前目录下忽略-TODO-文件，-但不包括子目录下的-subdir-x2F-TODO"><a href="#仅在当前目录下忽略-TODO-文件，-但不包括子目录下的-subdir-x2F-TODO" class="headerlink" title="仅在当前目录下忽略 TODO 文件， 但不包括子目录下的 subdir&#x2F;TODO"></a>仅在当前目录下忽略 TODO 文件， 但不包括子目录下的 subdir&#x2F;TODO</h1><p>&#x2F;TODO</p>
<h1 id="忽略-build-x2F-文件夹下的所有文件"><a href="#忽略-build-x2F-文件夹下的所有文件" class="headerlink" title="忽略 build&#x2F; 文件夹下的所有文件"></a>忽略 build&#x2F; 文件夹下的所有文件</h1><p>build&#x2F;</p>
<h1 id="忽略-doc-x2F-notes-txt-不包括-doc-x2F-server-x2F-arch-txt"><a href="#忽略-doc-x2F-notes-txt-不包括-doc-x2F-server-x2F-arch-txt" class="headerlink" title="忽略 doc&#x2F;notes.txt, 不包括 doc&#x2F;server&#x2F;arch.txt"></a>忽略 doc&#x2F;notes.txt, 不包括 doc&#x2F;server&#x2F;arch.txt</h1><p>doc&#x2F;*.txt</p>
<h1 id="忽略所有的-pdf-文件，包括在-doc-x2F-directory-下的"><a href="#忽略所有的-pdf-文件，包括在-doc-x2F-directory-下的" class="headerlink" title="忽略所有的 .pdf 文件，包括在 doc&#x2F; directory 下的"></a>忽略所有的 .pdf 文件，包括在 doc&#x2F; directory 下的</h1><p>doc&#x2F;**&#x2F;*.pdf<br>2.4.2.8 小结<br>创建版本库</p>
<p>git init：初始化仓库(包含工作目录) –bare[创建的是纯仓库]</p>
<p>添加文件</p>
<p>git add：把文件添加进暂存区</p>
<p>git commit提交文件至本地仓库 添加提交日志</p>
<p>修改文件</p>
<p>删除文件</p>
<p>删除文件并保留副本</p>
<p>忽略文件（提交版本库时，可忽略某些文件。提交工程源码与jar和pom.xml，其它不提交）</p>
<p>将java工程提交到版本库【重点-不要提交忽略文件】</p>
<p>2.5 远程仓库<br>目标</p>
<p>使用git在远程仓库完成版本控制，及相关命令的使用，远程仓库可实现项目组人员之间的文件版本控制</p>
<p>学习路径</p>
<p>添加到远程仓库</p>
<p>（1）在github上创建仓库</p>
<p>（2）什么是ssh协议</p>
<p>（3）使用ssh协议同步到远程仓库</p>
<p>（4）使用https协议同步到远程仓库</p>
<p>从远程仓库上克隆</p>
<p>从远程仓库取代码</p>
<p>解决多人协作中版本冲突问题</p>
<p>搭建私有Git服务器（linux环境）</p>
<p>2.5.1 添加远程仓库<br>此时在本地已有一个Git仓库，想让其他人来协作开发，此时可以把本地仓库同步到远程仓库，同时还增加了本地仓库的一个备份。</p>
<p>2.5.1.1 在github上创建仓库<br>官网：<a target="_blank" rel="noopener" href="https://github.com/">https://github.com/</a></p>
<p>注册账号-&gt;登录-&gt;新建仓库-&gt;Start a project-&gt;-&gt;点击“create repository”按钮仓库即可</p>
<p>Github支持两种同步方式“https”和“ssh”。</p>
<p>使用https很简单基本不需要配置就可以使用，但是每次提交代码和下载代码时都需要输入用户名和密码</p>
<p>2.5.1.1.2 ssh协议版本<br>SSH 为 Secure Shell的缩写，利用 SSH 协议可以有效防止远程管理过程中的信息泄露问题。</p>
<p>使用ssh方式就需要客户端先生成一个密钥对，即一个公钥一个私钥。然后还需要把公钥放到githib的服务器上。</p>
<p>Client</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>[root@localhost ~]# ssh-keygen -t rsa       &lt;&#x3D;&#x3D; 建立密钥对，-t代表类型，有RSA和DSA两种<br>Generating public&#x2F;private rsa key pair.<br>Enter file in which to save the key (&#x2F;root&#x2F;.ssh&#x2F;id_rsa): #密钥文件默认存放位置，按Enter即可<br>Created directory ‘&#x2F;root&#x2F;.ssh’.<br>Enter passphrase (empty for no passphrase):  #输入密钥锁码<br>Enter same passphrase again:<br>Your identification has been saved in &#x2F;root&#x2F;.ssh&#x2F;id_rsa.    #生成的私钥<br>Your public key has been saved in &#x2F;root&#x2F;.ssh&#x2F;id_rsa.pub.    #生成的公钥<br>The key fingerprint is:<br>SHA256:<br>ssh密钥配置</p>
<p>密钥生成后需要在github上配置密钥本地才可以顺利访问。</p>
<p>在key部分将id_rsa.pub文件内容添加进去，然后点击“Add SSH key”按钮完成配置。</p>
<p>使用ssh协议同步到远程仓库</p>
<p>1<br>2<br>$ git remote add origin <a href="mailto:&#103;&#105;&#116;&#x40;&#103;&#x69;&#116;&#x68;&#x75;&#98;&#46;&#x63;&#x6f;&#x6d;">&#103;&#105;&#116;&#x40;&#103;&#x69;&#116;&#x68;&#x75;&#98;&#46;&#x63;&#x6f;&#x6d;</a>:itcast888&#x2F;mytest.git<br>$ git push -u origin master<br>origin就是一个名字，它是在你clone一个托管在Github上代码库时，git为你默认创建的指向这个远程代码库的标签， origin指向的是repository，master只是这个repository中默认创建的第一个分支。</p>
<p>2.5.2 从远程仓库克隆<br>克隆远程仓库也就是从远程把仓库复制一份到本地，克隆后会创建一个新的本地仓库。选择一个任意部署仓库的目录，然后克隆远程仓库。</p>
<p>1<br>$ git clone <a href="mailto:git@github.com:sublun/mytest.git">git@github.com:sublun/mytest.git</a><br>2.5.3 从远程仓库取代码<br>1<br>2<br>3</p>
<ol>
<li><p>git fetch：相当于是从远程获取最新版本到本地，不会自动merge（合并代码）</p>
</li>
<li><p>git pull：相当于是从远程获取最新版本并merge到本地，上述命令其实相当于git fetch 和 git merge<br>在实际使用中，git fetch更安全一些，但是不常用！</p>
</li>
</ol>
<p>因为在merge前，我们可以查看更新情况，然后再决定是否合并。</p>
<p>git pull更常用，因为即得代码又可以自动合并</p>
<p>2.5.4 解决版本冲突<br>原因</p>
<p>同时获取同一份代码，用户A先提交，用户B再提交，即出现版本冲突</p>
<p>解决</p>
<p>先拉取（pull）远程仓库的代码到本地。</p>
<p>编辑冲突</p>
<p>合并成一个新的文件</p>
<p>再次推送</p>
<p>避免冲突</p>
<p>优先提交代码<br>提交后通知全组成员pull<br>2.6 分支管理<br>目标</p>
<p>在本地仓库中使用分支，可在一个项目中使用多条路径，完成版本控制。</p>
<p>学习路径</p>
<p>分支的概念</p>
<p>分支管理</p>
<p>（1）创建分支（2）合并分支（3）解决冲突（4）删除分支</p>
<p>2.6.1 分支的概念<br>在我们每次的提交，Git都把它们串成一条时间线，这条时间线就是一个分支。截止到目前，只有一条时间线，在Git里，这个分支叫主分支，即master分支。HEAD指针严格来说不是指向提交，而是指向master，master才是指向提交的，所以，HEAD指向的就是当前分支。</p>
<p>只要有本地仓库就有master分支。</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>$ git checkout<br>A	“Algorithm&#x2F;\347\256\227\346\263\225\345\233\276\350\247\243&#x2F;.idea&#x2F;$CACHE_FILE$”<br>M	C++ project&#x2F;.vscode&#x2F;launch.json<br>M	C++ project&#x2F;.vscode&#x2F;tasks.json<br>M	Java&#x2F;MyFirstApp.class<br>Your branch is up to date with ‘origin&#x2F;master’.<br>Master是条线，Git用master指向最新的提交，再用HEAD指向master，就能确定当前分支</p>
<p>每次提交，master分支都会向前移动一步，这样，随着你不断提交，master分支的线也越来越长。</p>
<p>1<br>2<br>3<br>              Head<br>                ↓<br>A–&gt;B–&gt;C–&gt;D–&gt;E(Master)<br>创建新的分支，如dev，Git新建了一个指针叫dev，指向master相同的提交，再把HEAD指向dev，此时，对工作区的修改和提交就针对dev分支，提交后，dev指针往前移动一步，而master指针不变</p>
<p>1<br>2<br>$ git checkout -b dev<br>Switched to a new branch “dev”<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>              Master<br>                ↓<br>A–&gt;B–&gt;C–&gt;D–&gt;E<br>                 ↘<br>                  dev<br>                   ↑<br>                  Head<br>dev上的工作完成了，就可以把dev合并到master上，删除dev分支，变回一条线</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>#在切换分支之前，保持好一个干净的状态<br>$ git add xx&#x2F;*<br>$ git commit -m “XXX”<br>#切换回 master 分支<br>$ git checkout master<br>Switched to branch ‘master’<br>#假设提交，且无冲突，合并分支<br>$ git merge dev<br>#使用带 -d 选项的 git branch 命令来删除分支<br>$ git branch -d dev<br>2.7 IntelliJ IDEA中使用git<br>目标</p>
<p>在idea使用git完成版本控制</p>
<p>git操作本地仓库（自己进行版本控制）</p>
<p>git操作远程仓库（多人进行版本控制）</p>
<p>学习路径</p>
<p>配置Git<br>创建工程集成Git<br>推送代码到远程仓库<br>从远程仓库克隆<br>从远程仓库拉取<br>使用分支<br>2.7.1 在Idea中配置git<br>安装好IntelliJ IDEA后，如果Git安装在默认路径下，那么idea会自动找到git的位置，如果更改了Git的安装位置则需要手动配置下Git的路径。</p>
<p>选择File→Settings打开设置窗口，找到Version Control下的git选项<br>选择git的安装目录后可以点击“Test”按钮测试是否正确配置。<br>使用idea操作github远程服务器的时候，在idea中配置用户名和密码，这样使用https协议访问github的时候，不需要输入用户名和密码了。<br>2.7.2 创建工程集成GIT<br>2.7.2.1创建maven工程<br>创建Maven工程打包方式为jar包，创建User类</p>
<p>创建本地仓库</p>
<p>在菜单中选择“vcs”→Import into Version Control→Create Git Repository</p>
<p>此时样式改变，查看本地工程目录，有绿色箭头。说明创建了本地仓库。</p>
<p>2.7.2.2添加暂存区<br>项目右键——&gt;Git—&gt;Add</p>
<p>2.7.2.3 提交本地仓库<br>项目右键——&gt;Git—&gt;Commit Directory</p>
<p>2.7.3 远程仓库操作<br>2.7.3.1 推送到远程仓库<br>在github上创建一个远程仓库 HelloGithub 然后将本地仓库推送到远程。</p>
<p>注意：这里使用https的协议连接</p>
<p>在工程上点击右键，选择git→Repository→Remotes，添加URL</p>
<p>在工程上点击右键，选择git→Repository→Push</p>
<p>2.7.3.2 从远程仓库克隆<br>方式一</p>
<p>选择VCS—&gt;Checkout from Version Control—&gt;GitHub</p>
<p>方式二</p>
<p>在idea的欢迎页上有“Checkout from version control”下拉框，选择git(推荐使用https形式的url)</p>
<p>2.7.3.3 修改文件push到远程仓库<br>修改User</p>
<p>先commit到本地</p>
<p>Git–&gt;Commit Directory</p>
<p>再push到远程</p>
<p>Git–&gt;Repository–&gt;Push</p>
<p>2.7.3.4 从远程仓库拉取<br>Git–&gt;Repository–&gt;Pull</p>
<p>2.7.4 在Idea中使用分支<br>选择VCS—&gt;Git—&gt;Branches</p>
<p>点击“New Branch”，新建一个分支</p>
<p>分支操作</p>
<p>Checkout：为切换分支<br>Merge：为合并分支<br>Delete：删除分支<br>小结<br>在idea中配置git<br>将工程添加至git（操作本地仓库，将工程推送到远程仓库）<br>从远程仓库克隆（远程仓库）<br>从服务端拉取代码（远程仓库）<br>在idea中使用分支</p>
</package></Items></Items></Items>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swzxsyh.github.io/2020/06/13/SpringMVC%E7%9A%84%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86-%E6%8B%A6%E6%88%AA%E5%99%A8-SSM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="swzxsyh">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="swzxsyh">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/13/SpringMVC%E7%9A%84%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86-%E6%8B%A6%E6%88%AA%E5%99%A8-SSM/" class="post-title-link" itemprop="url">SpringMVC的统一异常处理 & 拦截器 & SSM</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-13 01:49:59" itemprop="dateCreated datePublished" datetime="2020-06-13T01:49:59+08:00">2020-06-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-10 04:40:38" itemprop="dateModified" datetime="2022-08-10T04:40:38+08:00">2022-08-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一.SpringMVC 实现文件上传<br>1.1 目标<br>掌握文件上传的要求</p>
<p>1.2 学习路径<br>文件上传概述<br>文件上传要求<br>常见的文件上传jar包和框架<br>1.3 讲解<br>1.3.1 文件上传概述<br>就是把客户端(浏览器)的文件保存一份到服务器(参考各类云盘)</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/06/13/SpringMVC%E7%9A%84%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86-%E6%8B%A6%E6%88%AA%E5%99%A8-SSM/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swzxsyh.github.io/2020/06/12/SpringMVC-%E5%85%A5%E9%97%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="swzxsyh">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="swzxsyh">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/12/SpringMVC-%E5%85%A5%E9%97%A8/" class="post-title-link" itemprop="url">SpringMVC 入门</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-12 01:45:52" itemprop="dateCreated datePublished" datetime="2020-06-12T01:45:52+08:00">2020-06-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-10 04:40:38" itemprop="dateModified" datetime="2022-08-10T04:40:38+08:00">2022-08-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一.SpringMVC介绍<br>知识点-SpringMVC概述<br>1.1 目标<br>介绍SpringMVC框架</p>
<p>1.2 路径<br>三层架构(SpringMVC在三层架构的位置)</p>
<p>什么是SpringMVC</p>
<p>SpringMVC 的优点</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/06/12/SpringMVC-%E5%85%A5%E9%97%A8/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swzxsyh.github.io/2020/06/04/SpringMVC%E6%8E%A5%E6%94%B6%E8%AF%B7%E6%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="swzxsyh">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="swzxsyh">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/04/SpringMVC%E6%8E%A5%E6%94%B6%E8%AF%B7%E6%B1%82/" class="post-title-link" itemprop="url">SpringMVC接收请求</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-04 01:44:49" itemprop="dateCreated datePublished" datetime="2020-06-04T01:44:49+08:00">2020-06-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-10 04:40:38" itemprop="dateModified" datetime="2022-08-10T04:40:38+08:00">2022-08-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一.SpringMVC的请求<br>搭建环境</p>
<p>建立新Moudle，配置pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--依赖管理--&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span> </span><br><span class="line">  <span class="comment">&lt;!--springMVC核心--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--servlet--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">  <span class="comment">&lt;!--jsp--&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jsp-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span>  </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Web.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">version</span>=<span class="string">&quot;2.5&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 前端控制器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>


<p>spring-mvc.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">                           http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!--开启注解组件扫描--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.test.web&quot;</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--开启mvc注解支持--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 视图解析器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/pages/&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>


<p>1.1 请求参数<br>客户端请求参数的格式是: name&#x3D;value&amp;name&#x3D;value</p>
<p>服务器要获取请求的参数，有时还需要进行数据的封装，SpringMVC可以接收如下类型的参数:</p>
<p>简单类型(基本类型\基本类型的包装类型\字符串)</p>
<p>index.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;index&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">  &lt;body&gt;</span><br><span class="line"></span><br><span class="line">    &lt;h2&gt;SpringMVC知识学习&lt;/h2&gt;</span><br><span class="line"></span><br><span class="line">    &lt;a href=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/user/simpleParam?username=jack&amp;age=18&quot;</span>&gt;</span><br><span class="line">      simpleParam</span><br><span class="line">    &lt;/a&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>


<p>UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/user&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@RequestMapping(&quot;/simpleParam&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">simpleParam</span><span class="params">(String username,Integer age)</span>&#123;</span><br><span class="line">    System.out.println(username);</span><br><span class="line">    System.out.println(age);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>注意:前端页面的name属性名必须与方法中的形参名称一致，类型自定义</p>
<p>对象类型</p>
<p>User</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> String username;</span><br><span class="line">  <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>index.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/user/pojoParam&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">  User: &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">  Age: &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;age&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Object_Type&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/pojoParam&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">pojoParam</span><span class="params">(User user)</span>&#123;</span><br><span class="line">  System.out.println(user);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>注意:表单元素的name属性必须与user实体的属性名一致</p>
<p>数组类型</p>
<p>应用场景:批量删除</p>
<p>index.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/user/arrayParam&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;checkbox&quot;</span> name=<span class="string">&quot;ids&quot;</span> value=<span class="string">&quot;1&quot;</span>&gt;User A&lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;checkbox&quot;</span> name=<span class="string">&quot;ids&quot;</span> value=<span class="string">&quot;2&quot;</span>&gt;User B&lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;checkbox&quot;</span> name=<span class="string">&quot;ids&quot;</span> value=<span class="string">&quot;3&quot;</span>&gt;User C&lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;checkbox&quot;</span> name=<span class="string">&quot;ids&quot;</span> value=<span class="string">&quot;4&quot;</span>&gt;User D&lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Array Param&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>

<p>UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/arrayParam&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">arrayParam</span><span class="params">(Integer[] ids)</span>&#123;</span><br><span class="line">  System.out.println(Arrays.toString(ids));</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>注意:复选框的name属性名必须与数组的变量名一致</p>
<p>集合(复杂)类型</p>
<p>如果提交的是一个集合的数据，springMVC的方法形参是无法接收的，必须要通过实体类进行包装才行</p>
<p>QueryVo</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QueryVo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Simple Type</span></span><br><span class="line">    <span class="keyword">private</span> String keyword;</span><br><span class="line">    <span class="comment">//Object Type</span></span><br><span class="line">    <span class="keyword">private</span> User user;</span><br><span class="line">    <span class="comment">//List Type</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Object&gt; list;</span><br><span class="line">    <span class="comment">//Map Type</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; map;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>index.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/user/queryVoParam&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">  Search: &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;keyword&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">  User: &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;user.username&quot;</span> placeholder=<span class="string">&quot;User Name&quot;</span>&gt;&lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;user.age&quot;</span> placeholder=<span class="string">&quot;Age&quot;</span>&gt;&lt;br&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  List Array:</span><br><span class="line">  &lt;%--</span><br><span class="line">  list[<span class="number">0</span>] == 第一个元素</span><br><span class="line">  list[<span class="number">1</span>] == 第二个元素</span><br><span class="line">  --%&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;list[0]&quot;</span> placeholder=<span class="string">&quot;First Element&quot;</span>&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;list[1]&quot;</span> placeholder=<span class="string">&quot;Second Element&quot;</span>&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;list[2]&quot;</span> placeholder=<span class="string">&quot;Third Element&quot;</span>&gt;&lt;br&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  Map Array:</span><br><span class="line">  &lt;%--</span><br><span class="line">  map.put(<span class="string">&quot;key1&quot;</span>,value);</span><br><span class="line">  map.put(<span class="string">&quot;key2&quot;</span>,value);</span><br><span class="line">  --%&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;map[key1]&quot;</span> placeholder=<span class="string">&quot;Key1 Value&quot;</span>&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;map[key2]&quot;</span> placeholder=<span class="string">&quot;Key2 Value&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Complex Type&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>



<p>UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/queryVoParam&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">queryVoParam</span><span class="params">(QueryVo queryVo)</span>&#123;</span><br><span class="line">    System.out.println(queryVo);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>1.2 中文乱码过滤器<br>如果是get请求，tomcat8以上版本的服务器统一了UTF-8编码，所以我们不会出现乱码</p>
<p>如果是post请求，由于servlet规范当中post默认解码方式为ISO-8859-1，所以出现了中文乱码问题</p>
<p>spring框架提供了post请求中文过滤器</p>
<p>web.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--中文乱码过滤器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>


<p>1.3 自定义类型转换器<br>自定义类型转换器</p>
<p>此处应用场景:日期格式</p>
<p>yyyy-MM-dd 框架无法识别，报400错误，springMVC已支持自定义类型转换器的扩展</p>
<p>spring-mvc.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--开启mvc注解支持--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> <span class="attr">conversion-service</span>=<span class="string">&quot;conversionService&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 扩展自定义类型转换器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;conversionService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.ConversionServiceFactoryBean&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;converters&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.test.web.convert.DateConverter&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>


<p>index.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/user/dateParam&quot;</span> method=<span class="string">&quot;post&quot;</span>&gt;</span><br><span class="line">    Birthday: &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;birthday&quot;</span>&gt;(日期格式:yyyy-MM-dd)&lt;br&gt;</span><br><span class="line">    &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;Date Submit&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>



<p>UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接收日期类型</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/dateParam&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">dateParam</span><span class="params">(Date birthday)</span>&#123;</span><br><span class="line">  <span class="type">SimpleDateFormat</span> <span class="variable">simpleDateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">  System.out.println(simpleDateFormat.format(birthday));</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>注解方案</p>
<p>删除web.xml添加的配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--开启注解组件扫描--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.test.web&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--开启mvc注解支持--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 扩展自定义类型转换器 --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    &lt;bean id=&quot;conversionService&quot; class=&quot;org.springframework.context.support.ConversionServiceFactoryBean&quot;&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;property name=&quot;converters&quot;&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;set&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--                &lt;bean class=&quot;com.test.web.convert.DateConverter&quot;&gt;&lt;/bean&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--            &lt;/set&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--        &lt;/property&gt;--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;/bean&gt;--&gt;</span></span><br></pre></td></tr></table></figure>


<p>UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接收日期类型</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/dateParam&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">dateParam</span><span class="params">(<span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span> Date birthday)</span>&#123;</span><br><span class="line">  <span class="type">SimpleDateFormat</span> <span class="variable">simpleDateFormat</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleDateFormat</span>(<span class="string">&quot;yyyy-MM-dd&quot;</span>);</span><br><span class="line">  System.out.println(simpleDateFormat.format(birthday));</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>1.4 相关注解<br>@RequestParam</p>
<p>应用场景:分页查询</p>
<p>index.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/user/findByPage?pageNum=1&amp;size=10&quot;</span>&gt;</span><br><span class="line">    Page Query</span><br><span class="line">&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//分页查询</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">@RequestParam 注解 常用属性</span></span><br><span class="line"><span class="comment">name/value:帮我们解决请求参数名和方法的变量名不一致问题</span></span><br><span class="line"><span class="comment">required: 默认值为true，要求前端必须提交参数和值</span></span><br><span class="line"><span class="comment">defaultValue:指定参数的默认值</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/findByPage&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">findByPage</span><span class="params">(<span class="meta">@RequestParam(name = &quot;pageNum&quot;,defaultValue = &quot;1&quot;)</span> Integer currentPage,<span class="meta">@RequestParam(name = &quot;size&quot;,defaultValue = &quot;10&quot;)</span>Integer pageSize)</span>&#123;</span><br><span class="line">    System.out.println(currentPage);</span><br><span class="line">    System.out.println(pageSize);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>@RequestHeader</p>
<p>获取请求头，相当于:request.getHeader();</p>
<p>index.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/user/requestHeader&quot;</span>&gt;Request Header&lt;/a&gt;</span><br></pre></td></tr></table></figure>


<p>UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/requestHeader&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">requestHeader</span><span class="params">(<span class="meta">@RequestHeader(&quot;User-Agent&quot;)</span> String userAgent,<span class="meta">@RequestHeader(&quot;Cookie&quot;)</span> String cookie)</span>&#123;</span><br><span class="line">  System.out.println(userAgent);</span><br><span class="line">  System.out.println(cookie);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>@CookieValue</p>
<p>专门获取指定cookie名称的值</p>
<p>index.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/user/cookieValue&quot;</span>&gt;Cookie Value&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/cookieValue&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String <span class="title function_">cookieValue</span><span class="params">(<span class="meta">@CookieValue(&quot;JSESSIONID&quot;)</span> String jsessionid)</span>&#123;</span><br><span class="line">  System.out.println(<span class="string">&quot;JSESSIONID: &quot;</span>+jsessionid);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>1.5 获取Servlet相关API<br>index.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;a href=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/user/servletAPI&quot;</span>&gt; servletAPI&lt;/a&gt;</span><br></pre></td></tr></table></figure>

<p>UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// servletAPI</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/servletAPI&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">servletAPI</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, HttpSession httpSession)</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">  <span class="type">String</span> <span class="variable">username</span> <span class="operator">=</span> httpServletRequest.getParameter(<span class="string">&quot;username&quot;</span>);</span><br><span class="line">  System.out.println(username);</span><br><span class="line">  httpServletRequest.getRequestDispatcher(<span class="string">&quot;/WEB-INF/pages/success.jsp&quot;</span>).forward(httpServletRequest,httpServletResponse);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>二.文件上传<br>需求分析</p>
<p>需求分析<br>一.文件上传三要素<br>Avatar: <input type="file" name="picFile"><br>⬇<br>二.SpringMVC集成文件上传组件<br>MultipartResolver多组件上传解析器<br>⬇<br>底层依赖file-upload环境<br>⬇<br>UserController<br>public String upload(String username, MultipartFile picFile)<br>2.1 文件上传三要素<br>表单的提交方式 method&#x3D;”POST”<br>表单的enctype属性是多部分表单形式 enctype&#x3D;“multipart&#x2F;form-data”<br>表单项(元素)type&#x3D;”file”</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">  Name: &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">  Avatar: &lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;picFile&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>



<p>2.2 文件上传原理</p>
<p>2.3 springMVC实现文件上传<br>index.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">&quot;$&#123;pageContext.request.contextPath&#125;/user/upload&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">  Name: &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;username&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">  Avatar: &lt;input type=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;picFile&quot;</span>&gt;&lt;br&gt;</span><br><span class="line">  &lt;input type=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;File Upload&quot;</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>



<p>添加依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--文件上传--&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-fileupload<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span> </span><br></pre></td></tr></table></figure>


<p>修改spring-mvc.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">文件上传组件扩展</span></span><br><span class="line"><span class="comment">id=&quot;multipartResolver&quot; 此id必须是这个名称</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;multipartResolver&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    限定文件的大小</span></span><br><span class="line"><span class="comment">    单位是字节(B)</span></span><br><span class="line"><span class="comment">    限制大约在5MB左右</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxUploadSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;512000&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>UserController</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文件上传</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/upload&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">upload</span><span class="params">(String username, MultipartFile picFile)</span>&#123;</span><br><span class="line">  System.out.println(<span class="string">&quot;Basic&quot;</span>+username);</span><br><span class="line">  System.out.println(<span class="string">&quot;File&quot;</span>+picFile);</span><br><span class="line">  System.out.println(<span class="string">&quot;File Name&quot;</span>+picFile.getOriginalFilename());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    picFile.transferTo(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/Users/swzxsyh/Downloads/&quot;</span>+picFile.getOriginalFilename()));</span><br><span class="line">  &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>三 静态资源访问的开启<br>问题</p>
<p>webapp路径下创建img文件夹，添加1.png图片，但是访问404</p>
<p>1<br><a href="${pageContext.request.contextPath}/img/1.png">Static Resources</a><br>解释</p>
<p>在SpringMVC的前端控制器DispatcherServlet的url-pattern配置的是 &#x2F;(缺省),代表除了jsp请求不拦截, 其他的所有请求都会拦截，包括一些静态文件(html、css、js)等, 而拦截住之后,它又找不到对应的处理器方法来处理, 因此报错.</p>
<p>3.1 方式一<br>手动配置springMVC框架的静态资源映射</p>
<p><a target="_blank" rel="noopener" href="http://localhost:8080/%E9%A1%B9%E7%9B%AE%E5%90%8D/img">http://localhost:8080/项目名/img</a><br>⬇<br>配置&lt;mvc:resources mapping&#x3D;”&#x2F;img&#x2F;**” location&#x3D;”&#x2F;img&#x2F;“&#x2F;&gt;<br>⬇<br>查找到src&#x2F;main&#x2F;webapp&#x2F;img&#x2F;1.png<br>spring-mvc.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    静态资源手动映射</span></span><br><span class="line"><span class="comment">    mapping=&quot;/img/**&quot; 浏览器发送请求</span></span><br><span class="line"><span class="comment">    location=&quot;/img/&quot; 静态资源的路径</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">mapping</span>=<span class="string">&quot;/img/**&quot;</span> <span class="attr">location</span>=<span class="string">&quot;/img/&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>问题</p>
<p>不同静态资源目录，都需要映射一次，重复代码过多</p>
<p>3.2 方式二<br>spring-mvc.xml添加如下配置即可</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--配置tomcat默认的静态资源处理--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br></pre></td></tr></table></figure>



<p>3.3 方式三<br>方式二可优化处</p>
<p>web.xml中url-pattern相当于覆盖tomcat本身规则，可以创建自身规则进行拦截</p>
<p>注释spring-mvc.xml内容</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--    </span></span><br><span class="line"><span class="comment">  静态资源手动映射</span></span><br><span class="line"><span class="comment">    mapping=&quot;/img/**&quot; 浏览器发送请求</span></span><br><span class="line"><span class="comment">    location=&quot;/img/&quot; 静态资源的路径</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line"><span class="comment">&lt;!--    &lt;mvc:resources mapping=&quot;/img/**&quot; location=&quot;/img/&quot;/&gt;--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置tomcat默认的静态资源处理--&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    &lt;mvc:default-servlet-handler/&gt;--&gt;</span></span><br></pre></td></tr></table></figure>


<p>配置web.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 前端控制器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">    自定义一个不会与默认的tomcat冲突的拦截规则</span></span><br><span class="line"><span class="comment">    配置：*.do  *.action 之后</span></span><br><span class="line"><span class="comment">    什么情况下才会被sprignMVC框架所拦截</span></span><br><span class="line"><span class="comment">    浏览器访问的资源需要加上：/user/quick.do</span></span><br><span class="line"><span class="comment">    所以静态  1.png  a.html 这些就不会被springMVC框架拦截，就不会出现404问题</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>*.do<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>



      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swzxsyh.github.io/2020/06/03/Spring-%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="swzxsyh">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="swzxsyh">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/03/Spring-%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1/" class="post-title-link" itemprop="url">Spring 声明式事务</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-03 01:44:21" itemprop="dateCreated datePublished" datetime="2020-06-03T01:44:21+08:00">2020-06-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-10 04:40:38" itemprop="dateModified" datetime="2022-08-10T04:40:38+08:00">2022-08-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一.Spring的事务<br>Spring的事务控制可以分为编程式事务控制和声明式事务控制。</p>
<p>编程式事务</p>
<p>就是将业务代码和事务代码放在一起书写,它的耦合性太高,开发中不使用</p>
<p>声明式事务</p>
<p>其实就是将事务代码和业务代码隔离开发, 然后通过一段配置让他们组装运行, 最后达到事务控制的目的.</p>
<p>声明式事务就是通过AOP原理实现的.</p>
<p>1.1 Spring声明式事务<br>在 Spring 配置文件中声明式的处理事务来代替代码式的处理事务。底层采用AOP思想来实现的</p>
<p>1.1.1 思想<br>目标对象:AccountServiceImpl<br>通知对象:DataSourceTransactionManager<br>配置切面:xml、注解<br>1.1.2 环境搭建<br>创建java模块</p>
<p>导入jar包</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51</p>
<!--依赖管理-->
<dependencies>
    <!--mysql驱动-->
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <version>5.1.47</version>
    </dependency>
    <!--druid连接池-->
    <dependency>
        <groupId>com.alibaba</groupId>
        <artifactId>druid</artifactId>
        <version>1.1.15</version>
    </dependency>
    <!--spring-jdbc-->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-jdbc</artifactId>
        <version>5.1.5.RELEASE</version>
    </dependency>
    <!--spring核心-->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-context</artifactId>
        <version>5.1.5.RELEASE</version>
    </dependency>
    <!--junit-->
    <dependency>
        <groupId>junit</groupId>
        <artifactId>junit</artifactId>
        <version>4.12</version>
    </dependency>
    <!--spring整合junit-->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-test</artifactId>
        <version>5.1.5.RELEASE</version>
    </dependency>
    <!--spring的orm-->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-orm</artifactId>
        <version>5.1.5.RELEASE</version>
    </dependency>
    <!--aspectj-->
    <dependency>
        <groupId>org.aspectj</groupId>
        <artifactId>aspectjweaver</artifactId>
        <version>1.9.5</version>
    </dependency>
</dependencies>
编写AccountDao

<p>1<br>2<br>3<br>4<br>5<br>public interface AccountDao {<br>    void outUser(String outUser, Double money);</p>
<pre><code>void inUser(String inUser, Double money);
</code></pre>
<p>}<br>编写AccountDaoImpl</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>public class AccountDaoImpl implements AccountDao {</p>
<pre><code>private JdbcTemplate jdbcTemplate;

public void setJdbcTemplate(JdbcTemplate jdbcTemplate) &#123;
    this.jdbcTemplate = jdbcTemplate;
&#125;

@Override
public void outUser(String outUser, Double money) &#123;
    String sql = &quot;UPDATE account SET money = money - ? WHERE name  = ?&quot;;
    jdbcTemplate.update(sql, money, outUser);

&#125;

@Override
public void inUser(String inUser, Double money) &#123;
    String sql = &quot;UPDATE account SET money = money + ? WHERE name  = ?&quot;;
    jdbcTemplate.update(sql, money, inUser);
&#125;
</code></pre>
<p>}<br>编写AccountService</p>
<p>1<br>2<br>3<br>public interface AccountService {<br>    void transfer(String outUser,String inUser,Double money);<br>}<br>编写AccountServiceImpl</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>public class AccountServiceImpl implements AccountService {</p>
<pre><code>private AccountDao accountDao;

public void setAccountDao(AccountDao accountDao) &#123;
    this.accountDao = accountDao;
&#125;

@Override
public void transfer(String outUser, String inUser, Double money) &#123;
    accountDao.outUser(outUser,money);
    accountDao.inUser(inUser,money);
&#125;
</code></pre>
<p>}<br>编写spring的配置文件</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br><?xml version="1.0" encoding="UTF-8"?><br><beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop" xmlns:context="http://www.springframework.org/schema/context" xsi:schemalocation=" http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd"></beans></p>
<pre><code>&lt;!--加载第三方配置文件--&gt;
&lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt;

&lt;!--druid交给ioc--&gt;
&lt;bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;&gt;
    &lt;property name=&quot;driverClassName&quot; value=&quot;$&#123;jdbc.driver&#125;&quot;/&gt;
    &lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot;/&gt;
    &lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot;/&gt;
    &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot;/&gt;
&lt;/bean&gt;

&lt;!--jdbcTemplate交给ioc--&gt;
&lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;
    &lt;constructor-arg name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
&lt;/bean&gt;

&lt;!--dao交给ioc--&gt;
&lt;bean id=&quot;accountDao&quot; class=&quot;com.test.dao.impl.AccountDaoImpl&quot;&gt;
    &lt;property name=&quot;jdbcTemplate&quot; ref=&quot;jdbcTemplate&quot;/&gt;
&lt;/bean&gt;

&lt;!--将service交给ioc--&gt;
&lt;bean id=&quot;accountService&quot; class=&quot;com.test.service.impl.AccountServiceImpl&quot;&gt;
    &lt;property name=&quot;accountDao&quot; ref=&quot;accountDao&quot;/&gt;
&lt;/bean&gt;

&lt;!--事务管理器交给ioc--&gt;
&lt;bean id=&quot;transactionManager&quot;  class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
&lt;/bean&gt;
</code></pre>

测试

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>@RunWith(SpringRunner.class)<br>@ContextConfiguration(“classpath:applicationContext.xml”)<br>public class AccountServiceTest {</p>
<pre><code>@Autowired
private AccountService accountService;

@Test
public void test() throws Exception&#123;
    accountService.transfer(&quot;tom&quot;,&quot;jerry&quot;,100d);
&#125;
</code></pre>
<p>}<br>1.1.3 XML配置<br>配置xml事务aop</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>59<br>60<br>61<br><?xml version="1.0" encoding="UTF-8"?><br><beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop" xmlns:tx="http://www.springframework.org/schema/tx" xmlns:context="http://www.springframework.org/schema/context" xsi:schemalocation=" http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd"></beans></p>
<pre><code>&lt;!--加载第三方配置文件--&gt;
&lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt;

&lt;!--druid交给ioc--&gt;
&lt;bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;&gt;
    &lt;property name=&quot;driverClassName&quot; value=&quot;$&#123;jdbc.driver&#125;&quot;/&gt;
    &lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot;/&gt;
    &lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot;/&gt;
    &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot;/&gt;
&lt;/bean&gt;

&lt;!--jdbcTemplate交给ioc--&gt;
&lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;
    &lt;constructor-arg name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
&lt;/bean&gt;

&lt;!--dao交给ioc--&gt;
&lt;bean id=&quot;accountDao&quot; class=&quot;com.test.dao.impl.AccountDaoImpl&quot;&gt;
    &lt;property name=&quot;jdbcTemplate&quot; ref=&quot;jdbcTemplate&quot;/&gt;
&lt;/bean&gt;

&lt;!--将service交给ioc--&gt;
&lt;bean id=&quot;accountService&quot; class=&quot;com.test.service.impl.AccountServiceImpl&quot;&gt;
    &lt;property name=&quot;accountDao&quot; ref=&quot;accountDao&quot;/&gt;
&lt;/bean&gt;

&lt;!--事务管理器交给ioc--&gt;
&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
&lt;/bean&gt;

&lt;!--将事务管理器升级为事务通知类--&gt;
</code></pre>
<p>  &lt;tx:advice id&#x3D;”txAdvice” transaction-manager&#x3D;”transactionManager”&gt;<br>    <a href="tx:attributes">tx:attributes</a><br>      &lt;tx:method name&#x3D;”*” &#x2F;&gt;<br>    <br>  </p>
  <!--aop配置-->
<p>  <a href="aop:config">aop:config</a><br>    <!-- 仅spring的事务切面配置使用此标签
            通知+切点=切面
        --><br>    &lt;aop:advisor advice-ref&#x3D;”txAdvice” pointcut&#x3D;”execution(* com.test.service..*.*(..))”&#x2F;&gt;<br>  <br><br>测试</p>
<p>事务通知类细节补充</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>59<br>60<br>61<br>62<br>63<br>64<br>65<br>66<br>67<br>68<br>69<br>70<br>71<br>72<br>73<br>74<br>75<br><?xml version="1.0" encoding="UTF-8"?><br><beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop" xmlns:tx="http://www.springframework.org/schema/tx" xmlns:context="http://www.springframework.org/schema/context" xsi:schemalocation=" http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd"></beans></p>
<pre><code>&lt;!--加载第三方配置文件--&gt;
&lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt;

&lt;!--druid交给ioc--&gt;
&lt;bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;&gt;
    &lt;property name=&quot;driverClassName&quot; value=&quot;$&#123;jdbc.driver&#125;&quot;/&gt;
    &lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot;/&gt;
    &lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot;/&gt;
    &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot;/&gt;
&lt;/bean&gt;

&lt;!--jdbcTemplate交给ioc--&gt;
&lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;
    &lt;constructor-arg name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
&lt;/bean&gt;

&lt;!--dao交给ioc--&gt;
&lt;bean id=&quot;accountDao&quot; class=&quot;com.test.dao.impl.AccountDaoImpl&quot;&gt;
    &lt;property name=&quot;jdbcTemplate&quot; ref=&quot;jdbcTemplate&quot;/&gt;
&lt;/bean&gt;

&lt;!--将service交给ioc--&gt;
&lt;bean id=&quot;accountService&quot; class=&quot;com.test.service.impl.AccountServiceImpl&quot;&gt;
    &lt;property name=&quot;accountDao&quot; ref=&quot;accountDao&quot;/&gt;
&lt;/bean&gt;

&lt;!--事务管理器交给ioc--&gt;
&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
&lt;/bean&gt;

&lt;!--将事务管理器升级为事务通知类--&gt;
</code></pre>
<p>  &lt;tx:advice id&#x3D;”txAdvice” transaction-manager&#x3D;”transactionManager”&gt;<br>    <a href="tx:attributes">tx:attributes</a><br>      &lt;tx:method name&#x3D;”save*” isolation&#x3D;”DEFAULT” propagation&#x3D;”REQUIRED” read-only&#x3D;”false” timeout&#x3D;”-1”&#x2F;&gt;<br>      &lt;tx:method name&#x3D;”update*” isolation&#x3D;”DEFAULT” propagation&#x3D;”REQUIRED” read-only&#x3D;”false” timeout&#x3D;”-1”&#x2F;&gt;<br>      &lt;tx:method name&#x3D;”delete*” isolation&#x3D;”DEFAULT” propagation&#x3D;”REQUIRED” read-only&#x3D;”false” timeout&#x3D;”-1”&#x2F;&gt;<br>      &lt;tx:method name&#x3D;”find*” propagation&#x3D;”SUPPORTS” read-only&#x3D;”false”&#x2F;&gt;<br>      &lt;tx:method name&#x3D;”*” isolation&#x3D;”DEFAULT” propagation&#x3D;”REQUIRED” read-only&#x3D;”false” timeout&#x3D;”-1”&#x2F;&gt;<br>    <br>  </p>
<pre><code>&lt;!--
定义事务管理器信息 DefaultTransactionDefinition
可以控制指定的方法，设置事务隔离级别、传播行为、是否只读、是否超时
name=&quot;transfer&quot; 需要控制事务的方法名
isolation=&quot;DEFAULT&quot; 设置当前方法的事务隔离界别，mysql默认级别:repeatable_read
propagation=&quot;REQUIRED&quot; 设置当前方法的事务传播行为 ，REQUIRED:当前方法 必须有一个事务(单独使用开启，别人调用加入对方事务)
read-only=&quot;false&quot; 当前方式为非只读(增删改用的)
timeout=&quot;-1&quot; 事务超时时间，-1:永不超时
--&gt;
</code></pre>
  <!--aop配置-->
<p>  <a href="aop:config">aop:config</a><br>    <!-- 仅spring的事务切面配置使用此标签
            通知+切点=切面
        --><br>    &lt;aop:advisor advice-ref&#x3D;”txAdvice” pointcut&#x3D;”execution(* com.test.service..*.*(..))”&#x2F;&gt;<br>  <br><br>1.1.4 ANNO配置<br>复制java模块</p>
<p>删除事务的xml配置&amp;&amp;开启tx的注解支持</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br><?xml version="1.0" encoding="UTF-8"?><br><beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop" xmlns:tx="http://www.springframework.org/schema/tx" xmlns:context="http://www.springframework.org/schema/context" xsi:schemalocation=" http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/tx
        http://www.springframework.org/schema/tx/spring-tx.xsd"></beans></p>
<pre><code>&lt;!--加载第三方配置文件--&gt;
&lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt;

&lt;!--druid交给ioc--&gt;
&lt;bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;&gt;
    &lt;property name=&quot;driverClassName&quot; value=&quot;$&#123;jdbc.driver&#125;&quot;/&gt;
    &lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot;/&gt;
    &lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot;/&gt;
    &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot;/&gt;
&lt;/bean&gt;

&lt;!--jdbcTemplate交给ioc--&gt;
&lt;bean id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;
    &lt;constructor-arg name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
&lt;/bean&gt;

&lt;!--dao交给ioc--&gt;
&lt;bean id=&quot;accountDao&quot; class=&quot;com.test.dao.impl.AccountDaoImpl&quot;&gt;
    &lt;property name=&quot;jdbcTemplate&quot; ref=&quot;jdbcTemplate&quot;/&gt;
&lt;/bean&gt;

&lt;!--将service交给ioc--&gt;
&lt;bean id=&quot;accountService&quot; class=&quot;com.test.service.impl.AccountServiceImpl&quot;&gt;
    &lt;property name=&quot;accountDao&quot; ref=&quot;accountDao&quot;/&gt;
&lt;/bean&gt;

&lt;!--事务管理器交给ioc--&gt;
&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
&lt;/bean&gt;

&lt;!-- 开启tx事务注解支持 --&gt;
&lt;tx:annotation-driven/&gt;
</code></pre>

在目标对象的上，使用事务注解

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>public class AccountServiceImpl implements AccountService {</p>
<pre><code>private AccountDao accountDao;

public void setAccountDao(AccountDao accountDao) &#123;
    this.accountDao = accountDao;
&#125;

@Override
@Transactional    //此方法被事务控制
public void transfer(String outUser, String inUser, Double money) &#123;
    accountDao.outUser(outUser,money);
</code></pre>
<p>&#x2F;&#x2F;        int i &#x3D; 1&#x2F;0;<br>        accountDao.inUser(inUser,money);<br>    }<br>}<br>测试</p>
<p>注解事务细节补充(使用就近原则)</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>@Transactional &#x2F;&#x2F;当前类所有方法被事务控制<br>public class AccountServiceImpl implements AccountService {</p>
<pre><code>private AccountDao accountDao;

public void setAccountDao(AccountDao accountDao) &#123;
    this.accountDao = accountDao;
&#125;

@Override
//此方法被事务控制，配置单独参数,方法控制就近原则
@Transactional(isolation = Isolation.DEFAULT,propagation = Propagation.REQUIRED,readOnly = false,timeout = -1)
public void transfer(String outUser, String inUser, Double money) &#123;
    accountDao.outUser(outUser,money);
</code></pre>
<p>&#x2F;&#x2F;        int i &#x3D; 1&#x2F;0;<br>        accountDao.inUser(inUser,money);<br>    }<br>}<br>二.Spring集成Web环境<br>2.1 Web环境搭建<br>创建Maven模块，JBLJavatoweb变更为web模块，添加Tomcat支持，配置pom.xml</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27</p>
<!--依赖管理-->
<dependencies>
  <!--spring-jdbc-->
  <dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-jdbc</artifactId>
    <version>5.1.5.RELEASE</version>
  </dependency>
  <!--spring核心-->
  <dependency>
    <groupId>org.springframework</groupId>
    <artifactId>spring-context</artifactId>
    <version>5.1.5.RELEASE</version>
  </dependency>
  <dependency>
    <groupId>javax.servlet</groupId>
    <artifactId>javax.servlet-api</artifactId>
    <version>3.1.0</version>
    <scope>provided</scope>
  </dependency>
  <dependency>
    <groupId>javax.servlet.jsp</groupId>
    <artifactId>jsp-api</artifactId>
    <version>2.2</version>
    <scope>provided</scope>
  </dependency>
</dependencies>
UserDao

<p>1<br>2<br>3<br>4<br>public interface UserDao {</p>
<pre><code>public void save();
</code></pre>
<p>}<br>UserDaoImpl</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>@Repository<br>public class UserDaoImpl implements UserDao {</p>
<pre><code>@Override
public void save() &#123;
    System.out.println(&quot;Saved!&quot;);
&#125;
</code></pre>
<p>}<br>UserServic</p>
<p>1<br>2<br>3<br>4<br>public interface UserService {</p>
<pre><code>public void save();
</code></pre>
<p>}<br>UserServiceImpl</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>@Service<br>public class UserServiceImpl implements UserService {</p>
<pre><code>@Autowired
private UserDao userDao;

@Override
public void save() &#123;
    userDao.save();
&#125;
</code></pre>
<p>}<br>UserServlet</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>@WebServlet(“&#x2F;UserServlet”)<br>public class UserServlet extends HttpServlet {</p>
<pre><code>@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;
    this.doPost(req,resp);
&#125;

@Override
protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;
    // 获取spring容器的上下文对象
    ClassPathXmlApplicationContext app = new ClassPathXmlApplicationContext(&quot;applicationContext.xml&quot;);
    // 调用service，实现保存功能
    UserService userService = app.getBean(UserService.class);
    userService.save();
&#125;
</code></pre>
<p>}<br>applicationContext</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br><?xml version="1.0" encoding="UTF-8"?><br><beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context" xmlns:p="http://www.springframework.org/schema/p" xsi:schemalocation="
           http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
           http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd"></beans></p>
<pre><code>&lt;!--开启注解组件扫描--&gt;
&lt;context:component-scan base-package=&quot;com.test&quot;/&gt;
</code></pre>

测试

<p><a target="_blank" rel="noopener" href="http://localhost:8080/%E9%A1%B9%E7%9B%AE%E5%90%8D/UserServlet">http://localhost:8080/项目名/UserServlet</a></p>
<p>问题</p>
<p>在servlet中的方法，直接创建spring容器，每一次都要创建，浪费内容空间和性能</p>
<p>2.2 自定义监听器和工具类<br>在web阶段学的servletContextListener监听器，在项目启动时执行，就可以创建 ClassPathXmlApplicationContext ，可以将这个spring的app对象，设置到ServletContext域，所有servlet都可以从这个域中，获取此对象</p>
<p>自定义监听器</p>
<p>web.xml</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br><?xml version="1.0" encoding="UTF-8"?><br><web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://java.sun.com/xml/ns/javaee" xsi:schemalocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" version="2.5"></web-app></p>
<pre><code>&lt;context-param&gt;
    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
    &lt;param-value&gt;applicationContext.xml&lt;/param-value&gt;
&lt;/context-param&gt;

&lt;listener&gt;
    &lt;listener-class&gt;com.test.web.listener.MyContextLoaderListener&lt;/listener-class&gt;
&lt;/listener&gt;
</code></pre>

MyContextLoaderListener

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>public class MyContextLoaderListener implements ServletContextListener {</p>
<pre><code>ClassPathXmlApplicationContext app = null;

// 在web项目启动时，创建spring环境
@Override
public void contextInitialized(ServletContextEvent sce) &#123;
    // 获取servletContext域对象
    ServletContext servletContext = sce.getServletContext();
    // 读取全局配置参数
    String contextConfigLocation = servletContext.getInitParameter(&quot;contextConfigLocation&quot;);
    // 创建spring环境
    app = new ClassPathXmlApplicationContext(contextConfigLocation);
    // 设置到域中
    servletContext.setAttribute(&quot;app&quot;, app);
    System.out.println(&quot;Spring Environment Init&quot;);
&#125;

// 在web项目卸载时，关闭spring环境
@Override
public void contextDestroyed(ServletContextEvent sce) &#123;
    app.close();
    System.out.println(&quot;Spring Environment Destroyed&quot;);
&#125;
</code></pre>
<p>}<br>获取spring容器工具类</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>&#x2F;&#x2F; 专门从web最大的域中获取spring环境<br>public class MyWebApplicationContextUtils {</p>
<p>  public static ApplicationContext getWebApplicationContext(ServletContext servletContext){<br>    return (ApplicationContext) servletContext.getAttribute(“app”);<br>  }<br>}<br>修改UserServlet</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>@WebServlet(“&#x2F;UserServlet”)<br>public class UserServlet extends HttpServlet {</p>
<pre><code>@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;
    this.doPost(req,resp);
&#125;

@Override
protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;
    // 获取spring容器的上下文对象
</code></pre>
<p>&#x2F;&#x2F;        ClassPathXmlApplicationContext app &#x3D; new ClassPathXmlApplicationContext(“applicationContext.xml”);<br>        &#x2F;&#x2F; 调用service，实现保存功能</p>
<pre><code>    ApplicationContext app = MyWebApplicationContextUtils.getWebApplicationContext(req.getServletContext());

    UserService userService = app.getBean(UserService.class);
    userService.save();
&#125;
</code></pre>
<p>}<br>2.3 Spring提供工具类<br>导入spring-web坐标</p>
<p>1<br>2<br>3<br>4<br>5<br>6</p>
<!--spring整合web容器-->
<dependency>
  <groupId>org.springframework</groupId>
  <artifactId>spring-web</artifactId>
  <version>5.1.5.RELEASE</version>
</dependency>
设置spring提供的监听器

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br><?xml version="1.0" encoding="UTF-8"?><br><web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://java.sun.com/xml/ns/javaee" xsi:schemalocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" version="2.5"></web-app></p>
<pre><code>&lt;!--全局配置参数--&gt;
&lt;context-param&gt;
    &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
    &lt;param-value&gt;classpath:applicationContext.xml&lt;/param-value&gt;
&lt;/context-param&gt;

&lt;listener&gt;
    &lt;listener-class&gt;org.springframework.web.context.ContextLoaderListener&lt;/listener-class&gt;
&lt;/listener&gt;
</code></pre>

修改UserServlet

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>@WebServlet(“&#x2F;UserServlet”)<br>public class UserServlet extends HttpServlet {</p>
<pre><code>@Override
protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;
    this.doPost(req,resp);
&#125;

@Override
protected void doPost(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;
    ApplicationContext app = WebApplicationContextUtils.getWebApplicationContext(req.getServletContext());

    UserService userService = app.getBean(UserService.class);
    userService.save();
&#125;
</code></pre>
<p>}<br>三.Spring的MVC简介<br>3.1 回顾MVC模式<br>MVC</p>
<p>Model</p>
<p>模型 JavaBean(1.处理业务逻辑 2.封装数据)</p>
<p>View</p>
<p>视图 Jsp&#x2F;html(展示数据)</p>
<p>Controller</p>
<p>控制器 Servlet(1.接收请求 2.调用模型 3.转发视图)</p>
<p>三层架构</p>
<p>web层</p>
<p>用户与java交互</p>
<p>service层</p>
<p>处理业务逻辑</p>
<p>dao层</p>
<p>Java与数据库交互</p>
<p>用户		Web层		Service层(JavaBean)		Dao层(JavaBean)<br>用户	➡请求	SpringMVC:简化servlet	↔	处理业务逻辑<br>Spring:IOC,AOP	↔	封装数据<br>Mybatis,DbUtils,JdbcTemplate<br>用户		⬇				<br>用户	⬅响应	视图(jsp)				<br>3.2 SpringMVC介绍<br>SpringMVC 是一种基于 Java 的实现 MVC 设计模式的轻量级 Web 框架，它可以通过一套注解，让一个 简单的Java类成为控制器，而无须实现任何接口。</p>
<p>SpringMVC框架本质上就是一个servlet，封装了共有的行为(请求、响应)，简化代码</p>
<p>User	➡请求<br>⬅响应	Tomcat				<br>⬇			↗	特有行为JavaBean<br>Web.xml<br>配置Servlet<br>指定Servlet的类信息<br>指定Servlet的url地址	➡	SpringMVC框架<br>Servlet<br>共有行为		<br>↘	特有行为JavaBean<br>四.SpringMVC快速入门<br>需求</p>
<p>访问一个URL, 可以在控制台打印一句话, 然后跳转到一个新的页面</p>
<p>需求分析</p>
<p>User	➡请求<br>⬅响应	Tomcat<br>一.导入SpringMVC坐标		三.编写Controller和jsp页面<br>四.将Controller交给IOC容器建立URL和方法映射		<br>⬇			↗	特有行为JavaBean<br>Web.xml<br>二.配置前端控制器DispatcherServlet<br>配置Servlet<br>指定Servlet的类信息<br>指定Servlet的url地址	➡	SpringMVC框架<br>Servlet<br>共有行为		<br>五.编写Spring-mvc.xml<br>1.开启注解组件扫描<br>2.开启MVC注解支持	↘	特有行为JavaBean<br>代码实现</p>
<p>创建web模块，并导入坐标</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br><?xml version="1.0" encoding="UTF-8"?></p>
<p><project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemalocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"><br>    <modelVersion>4.0.0</modelVersion><br>    <groupId>org.example</groupId><br>    <artifactId>Spring_online_Day05_04_WEB_MVC</artifactId><br>    <version>1.0-SNAPSHOT</version><br>    <packaging>war</packaging><br>    <!--依赖管理--><br>    <dependencies><br>        <!--springMVC--><br>        <dependency><br>            <groupId>org.springframework</groupId><br>            <artifactId>spring-webmvc</artifactId><br>            <version>5.1.5.RELEASE</version><br>        </dependency><br>        <!--servlet--><br>        <dependency><br>            <groupId>javax.servlet</groupId><br>            <artifactId>servlet-api</artifactId><br>            <version>2.5</version><br>            <scope>provided</scope><br>        </dependency><br>        <!--jsp--><br>        <dependency><br>            <groupId>javax.servlet</groupId><br>            <artifactId>jsp-api</artifactId><br>            <version>2.0</version><br>            <scope>provided</scope><br>        </dependency><br>    </dependencies><br></project><br>配置前端控制器(servlet)</p>
<p>web.xml</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br><?xml version="1.0" encoding="UTF-8"?><br><web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://java.sun.com/xml/ns/javaee" xsi:schemalocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" version="2.5"></web-app></p>
<pre><code>&lt;!--前端控制器--&gt;
&lt;servlet&gt;
    &lt;servlet-name&gt;DispatcherServlet&lt;/servlet-name&gt;
    &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;

    &lt;!--加载指定配置文件--&gt;
    &lt;init-param&gt;
        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;
        &lt;param-value&gt;classpath:spring-mvc.xml&lt;/param-value&gt;
    &lt;/init-param&gt;
    &lt;!--指定servlet在tomcat启动时创建--&gt;
    &lt;load-on-startup&gt;4&lt;/load-on-startup&gt;
&lt;/servlet&gt;

&lt;!--拦截url规则:/(默认)--&gt;
&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;DispatcherServlet&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;
</code></pre>

编写controller和jsp

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>&#x2F;&#x2F;一个模块对应一个控制器(类)<br>public class UserController {</p>
<pre><code>//// 一个请求对应一个方法
public String quickStart()&#123;
    System.out.println(&quot;Quick Start&quot;);
    // 转发给一个视图（在该路径创建该JSP即可）
    return &quot;/WEB-INF/pages/success.jsp&quot;;
&#125;
</code></pre>
<p>}<br>配置controller</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>&#x2F;&#x2F;一个模块对应一个控制器(类)<br>@Controller<br>public class UserController {</p>
<pre><code>//// 一个请求对应一个方法
@RequestMapping(path = &quot;/quickStart&quot;)
public String quickStart()&#123;
    System.out.println(&quot;Quick Start&quot;);
    // 转发给一个视图
    return &quot;/WEB-INF/pages/success.jsp&quot;;
&#125;
</code></pre>
<p>}<br>编写spring-mvc.xml</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br><beans xmlns="http://www.springframework.org/schema/beans" xmlns:mvc="http://www.springframework.org/schema/mvc" xmlns:context="http://www.springframework.org/schema/context" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemalocation="http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/mvc
       http://www.springframework.org/schema/mvc/spring-mvc.xsd
       http://www.springframework.org/schema/context
       http://www.springframework.org/schema/context/spring-context.xsd"></beans></p>
<pre><code>&lt;!--开启注解组件扫描--&gt;
&lt;context:component-scan base-package=&quot;com.test.web&quot;/&gt;
&lt;!--开启mvc注解支持--&gt;
&lt;mvc:annotation-driven/&gt;
</code></pre>

部署并测试

<p><a target="_blank" rel="noopener" href="http://localhost:8080/%E9%A1%B9%E7%9B%AE%E5%90%8D/quickStart">http://localhost:8080/项目名/quickStart</a></p>
<p>简易流程</p>
<p>五.SpringMVC组件概述<br>5.1 执行流程</p>
<p>5.2 三大组件<br>处理器映射器:HandlerMapping<br>将请求url 和 处理器的方法 建立映射关系</p>
<p>处理器适配器</p>
<p>HandlerAdapter 从多个处理器当中，适配其中一个，调用目标执行</p>
<p>视图解析器</p>
<p>ViewResolver 将逻辑视图解析为物理视图</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27</p>
<h1 id="Default-implementation-classes-for-DispatcherServlet’s-strategy-interfaces"><a href="#Default-implementation-classes-for-DispatcherServlet’s-strategy-interfaces" class="headerlink" title="Default implementation classes for DispatcherServlet’s strategy interfaces."></a>Default implementation classes for DispatcherServlet’s strategy interfaces.</h1><h1 id="Used-as-fallback-when-no-matching-beans-are-found-in-the-DispatcherServlet-context"><a href="#Used-as-fallback-when-no-matching-beans-are-found-in-the-DispatcherServlet-context" class="headerlink" title="Used as fallback when no matching beans are found in the DispatcherServlet context."></a>Used as fallback when no matching beans are found in the DispatcherServlet context.</h1><h1 id="Not-meant-to-be-customized-by-application-developers"><a href="#Not-meant-to-be-customized-by-application-developers" class="headerlink" title="Not meant to be customized by application developers."></a>Not meant to be customized by application developers.</h1><p>org.springframework.web.servlet.LocaleResolver&#x3D;org.springframework.web.servlet.i18n.AcceptHeaderLocaleResolver</p>
<p>org.springframework.web.servlet.ThemeResolver&#x3D;org.springframework.web.servlet.theme.FixedThemeResolver</p>
<p>#处理器映射器<br>org.springframework.web.servlet.HandlerMapping&#x3D;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping,<br>    org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping</p>
<p>#处理器适配器<br>org.springframework.web.servlet.HandlerAdapter&#x3D;org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter,<br>    org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter,<br>    org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter</p>
<p>org.springframework.web.servlet.HandlerExceptionResolver&#x3D;org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver,<br>    org.springframework.web.servlet.mvc.annotation.ResponseStatusExceptionResolver,<br>    org.springframework.web.servlet.mvc.support.DefaultHandlerExceptionResolver</p>
<p>org.springframework.web.servlet.RequestToViewNameTranslator&#x3D;org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator</p>
<p>#视图解析器<br>org.springframework.web.servlet.ViewResolver&#x3D;org.springframework.web.servlet.view.InternalResourceViewResolver</p>
<p>org.springframework.web.servlet.FlashMapManager&#x3D;org.springframework.web.servlet.support.SessionFlashMapManager<br>5.3 常用注解<br>@Controller</p>
<p>SpringMVC基于Spring容器，所以在进行SpringMVC操作时，需要将Controller存储到Spring容器中， 故使用此注解</p>
<p>@RequestMapping</p>
<p>用于建立请求 URL 和处理请求方法之间的对应关系</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>&#x2F;&#x2F;一个模块对应一个控制器(类)<br>@Controller<br>@RequestMapping(“&#x2F;user”)<br>public class UserController {</p>
<pre><code>/*
     @RequestMapping
        功能:将请求的url 和 方法 建立映射关系
    位置:
        类上:建立一级url访问路径
        方法上:建立二级的url访问路径，与一级路径组成一个完整url路径
    例:
                /user/quickStart
    常用属性:
        value/path:声明url访问路径
        method:限定请求方式，默认支持所有，共有7种(get、post、put、delete)
        params:限定请求参数
</code></pre>
<p>*&#x2F;</p>
<pre><code>@RequestMapping(value = &quot;/quickStart&quot;, method = &#123;RequestMethod.POST, RequestMethod.GET&#125;, params = &#123;&quot;username&quot;, &quot;password&quot;&#125;)
public String quickStart() &#123;
    System.out.println(&quot;Quick Start&quot;);
    // 转发给一个视图
    return &quot;success&quot;;
&#125;
</code></pre>
<p>}<br>总结</p>
<h1 id="spring05"><a href="#spring05" class="headerlink" title="spring05"></a>spring05</h1><h2 id="一-Spring的事务"><a href="#一-Spring的事务" class="headerlink" title="一 Spring的事务"></a>一 Spring的事务</h2><h3 id="声明式事务控制"><a href="#声明式事务控制" class="headerlink" title="声明式事务控制"></a>声明式事务控制</h3><ul>
<li>xml配置</li>
</ul>
<p>​ - 平台事务管理器配置</p>
<p>​ -</p>
<p>​</p>
<p>​ - 事务通知的配置</p>
<p>​ - &lt;tx:advice id&#x3D;”myAdvice” transaction-manager&#x3D;”transactionManager”&gt;</p>
<p>​<br>​ tx:attributes</p>
<p>​ &lt;tx:method name&#x3D;”*”&#x2F;&gt;</p>
<p>​</p>
<p>​ - 事务aop织入的配置</p>
<p>​ - aop:config</p>
<p>​ &lt;aop:advisor advice-ref&#x3D;”myAdvice”</p>
<p>​ pointcut&#x3D;”execution(* com.test.service.impl..(..))”&gt;</p>
<p>​</p>
<ul>
<li>常用注解配置</li>
</ul>
<p>​ - 平台事务管理器配置</p>
<p>​ -</p>
<p>​</p>
<p>​ - 开启注解支持</p>
<p>​ - tx:annotation-driven&#x2F;</p>
<p>​ - 在目标对象上使用事务注解</p>
<p>​ - @Transactional</p>
<h2 id="二-Spring集成web环境"><a href="#二-Spring集成web环境" class="headerlink" title="二 Spring集成web环境"></a>二 Spring集成web环境</h2><h3 id="导入Spring集成web的坐标"><a href="#导入Spring集成web的坐标" class="headerlink" title="导入Spring集成web的坐标"></a>导入Spring集成web的坐标</h3><p>​ org.springframework</p>
<p>​ spring-web</p>
<p>​ 5.1.5.RELEASE</p>
<h3 id="配置ContextLoaderListener监听器"><a href="#配置ContextLoaderListener监听器" class="headerlink" title="配置ContextLoaderListener监听器"></a>配置ContextLoaderListener监听器</h3><p>​ contextConfigLocation</p>
<p>​ classpath:applicationContext.xml</p>
<p>​</p>
<p>​ org.springframework.web.context.ContextLoaderListener</p>
<h3 id="通过工具获得应用上下文对象"><a href="#通过工具获得应用上下文对象" class="headerlink" title="通过工具获得应用上下文对象"></a>通过工具获得应用上下文对象</h3><p>ApplicationContext app &#x3D;</p>
<p>​ WebApplicationContextUtils.getWebApplicationContext(servletContext);</p>
<p>​ Object obj &#x3D; app.getBean(“id”);</p>
<h2 id="三-SpringMVC简介"><a href="#三-SpringMVC简介" class="headerlink" title="三 SpringMVC简介"></a>三 SpringMVC简介</h2><h3 id="MVC模式"><a href="#MVC模式" class="headerlink" title="MVC模式"></a>MVC模式</h3><ul>
<li><p>M（model）模型：处理业务逻辑，封装实体</p>
</li>
<li><p>V（view） 视图：展示内容</p>
</li>
<li><p>C（controller）控制器：负责调度分发（1.接收请求、2.调用模型、3.转发到视图）</p>
</li>
</ul>
<h3 id="springMVC"><a href="#springMVC" class="headerlink" title="springMVC"></a>springMVC</h3><ul>
<li><p>springMVC是基于java实现MVC设计模式的轻量级web框架。封装了servlet共有的特性，使开发者关注业务本身。</p>
</li>
<li><p>本质上就是一个servlet</p>
</li>
</ul>
<p>​ - 我们只需要写控制器（controller）</p>
<h2 id="四-SpringMVC快速入门"><a href="#四-SpringMVC快速入门" class="headerlink" title="四 SpringMVC快速入门"></a>四 SpringMVC快速入门</h2><h3 id="1-创建web项目，导入SpringMVC相关坐标"><a href="#1-创建web项目，导入SpringMVC相关坐标" class="headerlink" title="1. 创建web项目，导入SpringMVC相关坐标"></a>1. 创建web项目，导入SpringMVC相关坐标</h3><h3 id="2-配置SpringMVC前端控制器-DispathcerServlet"><a href="#2-配置SpringMVC前端控制器-DispathcerServlet" class="headerlink" title="2. 配置SpringMVC前端控制器 DispathcerServlet"></a>2. 配置SpringMVC前端控制器 DispathcerServlet</h3><h3 id="3-编写Controller类和视图页面"><a href="#3-编写Controller类和视图页面" class="headerlink" title="3. 编写Controller类和视图页面"></a>3. 编写Controller类和视图页面</h3><h3 id="4-使用注解配置Controller类中业务方法的映射地址"><a href="#4-使用注解配置Controller类中业务方法的映射地址" class="headerlink" title="4. 使用注解配置Controller类中业务方法的映射地址"></a>4. 使用注解配置Controller类中业务方法的映射地址</h3><h3 id="5-配置SpringMVC核心文件-spring-mvc-xml"><a href="#5-配置SpringMVC核心文件-spring-mvc-xml" class="headerlink" title="5. 配置SpringMVC核心文件 spring-mvc.xml"></a>5. 配置SpringMVC核心文件 spring-mvc.xml</h3><h3 id="6-部署并测试"><a href="#6-部署并测试" class="headerlink" title="6.部署并测试"></a>6.部署并测试</h3><h2 id="五-SpringMVC组件概述"><a href="#五-SpringMVC组件概述" class="headerlink" title="五 SpringMVC组件概述"></a>五 SpringMVC组件概述</h2><h3 id="SpringMVC的执行流程"><a href="#SpringMVC的执行流程" class="headerlink" title="SpringMVC的执行流程"></a>SpringMVC的执行流程</h3><h3 id="三大组件"><a href="#三大组件" class="headerlink" title="三大组件"></a>三大组件</h3><ul>
<li><p>HandlerMapping</p>
</li>
<li><p>HandlerAdapter</p>
</li>
<li><p>ViewResolver</p>
</li>
</ul>
<p>​ - 重写视图解析器，指定前后缀</p>
<h3 id="注解解析"><a href="#注解解析" class="headerlink" title="注解解析"></a>注解解析</h3><ul>
<li>@Controller</li>
</ul>
<p>​ - 将对象交给ioc容器</p>
<ul>
<li>@requestMapping</li>
</ul>
<p>​ - 将url与方法建立映射关系</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swzxsyh.github.io/2020/06/01/Spring-XML-Annotation-JDBCTemplate-Transaction/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="swzxsyh">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="swzxsyh">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/06/01/Spring-XML-Annotation-JDBCTemplate-Transaction/" class="post-title-link" itemprop="url">Spring XML & Annotation,JDBCTemplate & Transaction</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-01 01:43:52" itemprop="dateCreated datePublished" datetime="2020-06-01T01:43:52+08:00">2020-06-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-10 04:40:38" itemprop="dateModified" datetime="2022-08-10T04:40:38+08:00">2022-08-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一.基于XML的AOP开发<br>1.1 XML配置详解<br>1.1.1 切点表达式<br>1<br>execution([修饰符] 返回值类型 包名.类名.方法名(参数列表))<br>访问修饰符可以省略</p>
<p>返回值类型、包名、类名、方法名可以使用星号 * 代替，代表任意</p>
<p>包名与类名之间一个点 . 代表当前包下的类，两个点 .. 表示当前包及其子包下的类</p>
<p>参数列表可以使用两个点 .. 表示任意个数，任意类型的参数列表</p>
<p>版本	<br>版本一	控制目标对象中，返回值类型void且public修饰的所有方法<br>execution(public void com.test.service.impl.AccountServiceImpl.<em>(..))<br>版本二	控制目标对象中，任意修饰符任意返回值的所有方法<br>execution(</em> com.test.service.impl.AccountServiceImpl.<em>(..))<br>版本三	版本三：控制service层所有对象的方法<br>execution(</em> com.test.service…(..))<br>切点表达式抽取</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br><?xml version="1.0" encoding="UTF-8"?><br><beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context" xmlns:aop="http://www.springframework.org/schema/aop" xmlns:p="http://www.springframework.org/schema/p" xsi:schemalocation="
           http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
           http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd"></beans></p>
  <!--开启注解组件扫描-->
<p>  &lt;context:component-scan base-package&#x3D;”com.test”&#x2F;&gt;</p>
<p>  <bean id="myAdvice" class="com.test.advice.MyAdvice"></bean><br>  <!--aop配置--><br>  <a href="aop:config">aop:config</a><br>    <!--切面--><br>    &lt;aop:aspect ref&#x3D;”myAdvice”&gt;<br>      <!--抽取切点表达式--><br>      &lt;aop:pointcut id&#x3D;”myPointcut” expression&#x3D;”execution(* com.test.service..*.*(..))”&#x2F;&gt;<br>      <!--织入过程...
            method="通知方法" 通知方法
            pointcut="切点表达式"
            execution([修饰符] 返回值类型  包名.类名.方法名(参数列表))
            --><br>      &lt;aop:before method&#x3D;”before” pointcut-ref&#x3D;”myPointcut”&gt;<br>    <br>  <br><br>1.2.2 通知类型<br>通知的配置语法</p>
<p>1<br>&lt;aop:通知类型 method&#x3D;”通知类中方法名” pointcut&#x3D;”切点表达式”&gt;&lt;&#x2F;aop:通知类型&gt;<br>四大通知</p>
<p>名称	标签	说明<br>前置通知	<a href="aop:before">aop:before</a>	在切入点方法之前执行<br>后置通知	<a href="aop:afterReturning">aop:afterReturning</a>	在切入点方法正常运行之后执行<br>异常通知	<a href="aop:afterThrowing">aop:afterThrowing</a>	在切点方法发生异常的时候执行<br>最终通知	<a href="aop:after">aop:after</a>	无论切入点方法执行时是否有异常，都会执行<br>Myadvice</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>@Component<br>public class MyAdvice {</p>
<pre><code>// 前置增强
public void before() &#123;
    System.out.println(&quot;Advance Notice&quot;);
&#125;

// 后置增强
public void afterReturning()&#123;
    System.out.println(&quot;Post Notification&quot;);
&#125;

// 异常增强
public void afterThrowing()&#123;
    System.out.println(&quot;Exception Notification&quot;);
&#125;

// 最终增强
public void after()&#123;
    System.out.println(&quot;Final Notice&quot;);
&#125;
</code></pre>
<p>}<br>applicationContext.xml</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21</p>
<!--开启注解组件扫描-->
<p>&lt;context:component-scan base-package&#x3D;”com.test”&#x2F;&gt;</p>
<p><bean id="myAdvice" class="com.test.advice.MyAdvice"></bean></p>
<!--aop配置-->
<p><a href="aop:config">aop:config</a><br>  <!--切面--><br>  &lt;aop:aspect ref&#x3D;”myAdvice”&gt;<br>    <!--抽取切点表达式--><br>    &lt;aop:pointcut id&#x3D;”myPointcut” expression&#x3D;”execution(* com.test.service..*.*(..))”&#x2F;&gt;<br>    <!--织入过程...
            method="通知方法" 通知方法
            pointcut="切点表达式"
            execution([修饰符] 返回值类型  包名.类名.方法名(参数列表))
            --><br>    &lt;aop:before method&#x3D;”before” pointcut-ref&#x3D;”myPointcut”&#x2F;&gt;<br>    &lt;aop:after-returning method&#x3D;”afterReturning” pointcut-ref&#x3D;”myPointcut”&#x2F;&gt;<br>    &lt;aop:after-throwing method&#x3D;”afterThrowing” pointcut-ref&#x3D;”myPointcut”&#x2F;&gt;<br>    &lt;aop:after method&#x3D;”after” pointcut-ref&#x3D;”myPointcut”&#x2F;&gt;<br>  <br><br>注意：四大通知一般单独使用，因为xml配置顺序可能会打乱我们执行计划，建议使用环绕通知</p>
<p>环绕通知(强无敌)</p>
<p>名称	标签	说明<br>环绕通知	<a href="aop:around">aop:around</a>	可以灵活实现四大通知的所有效果<br>环绕通知的代码编写，更贴近于动态代理的底层代码</p>
<p>注意：测试环绕通知，需要注释掉四大通知</p>
<p>Myadvice</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>&#x2F;&#x2F; 环绕通知<br>&#x2F;&#x2F; Proceeding（运行）JoinPoint（连接点）  &#x3D; 切点<br>public void around(ProceedingJoinPoint proceedingJoinPoint) {<br>    try {<br>        System.out.println(“Advance notice”);<br>        &#x2F;&#x2F; 执行切点(调用目标对象原有的方法)<br>        proceedingJoinPoint.proceed();</p>
<pre><code>    System.out.println(&quot;Post Notification&quot;);
&#125; catch (Throwable throwable) &#123;
    throwable.printStackTrace();
    System.out.println(&quot;Exception Notification&quot;);
&#125; finally &#123;
    System.out.println(&quot;Final Notice&quot;);
&#125;
</code></pre>
<p>}<br>1<br>&lt;aop:around method&#x3D;”around” pointcut-ref&#x3D;”myPointcut”&gt;<br>1.2 知识小结<br>aop织入的配置<br>1<br>2<br>3<br>4<br>5<br><a href="aop:config">aop:config</a><br>    &lt;aop:aspect ref&#x3D;“通知类”&gt;<br>        &lt;aop:before method&#x3D;“通知方法名称” pointcut&#x3D;“切点表达式”&gt;&lt;&#x2F;aop:before&gt;<br>    <br><br>通知的类型</p>
<p>前置通知、后置通知、异常通知、最终通知</p>
<p>环绕通知</p>
<p>切点表达式</p>
<p>1<br>execution([修饰符] 返回值类型 包名.类名.方法名(参数列表))<br>二.基于注解的AOP开发<br>2.1 快速入门<br>复制上面的xml工程</p>
<p>目标对象</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>@Service<br>public class AccountServiceImpl implements AccountService {<br>    @Override<br>    public void transfer() {<br>        System.out.println(“Transfer”);<br>    }</p>
<pre><code>@Override
public void save() &#123;
    System.out.println(&quot;Save&quot;);
&#125;
</code></pre>
<p>}<br>通知对象</p>
<p>1<br>2<br>3<br>&#x2F;&#x2F;通知类(增强)<br>@Component<br>public class MyAdvice {<br>开启Spring的AOP注解支持</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br><?xml version="1.0" encoding="UTF-8"?><br><beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context" xmlns:aop="http://www.springframework.org/schema/aop" xmlns:p="http://www.springframework.org/schema/p" xsi:schemalocation="
           http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
           http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd"></beans></p>
<pre><code>&lt;!--开启注解组件扫描--&gt;
&lt;context:component-scan base-package=&quot;com.test&quot;/&gt;

&lt;!-- 开启Spring的AOP注解支持 --&gt;
&lt;aop:aspectj-autoproxy/&gt;
</code></pre>

将通知升级为切面(通知+切点= 切面)

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>&#x2F;&#x2F;通知类(增强)<br>@Component<br>&#x2F;&#x2F;升级为切面<br>@Aspect<br>public class MyAdvice {</p>
<pre><code>@Pointcut(&quot;execution(* com.test.service..*.*(..))&quot;)
public void myPointcut()&#123;&#125;

// 前置增强
@Before(&quot;MyAdvice.myPointcut()&quot;)
public void before() &#123;
    System.out.println(&quot;Advance notice&quot;);
&#125;

// 后置增强
@AfterReturning(&quot;MyAdvice.myPointcut()&quot;)
public void afterReturning() &#123;
    System.out.println(&quot;Post Notification&quot;);
&#125;

// 异常增强
@AfterThrowing(&quot;MyAdvice.myPointcut()&quot;)
public void afterThrowing() &#123;
    System.out.println(&quot;Exception Notification&quot;);
&#125;

// 最终增强
@After(&quot;MyAdvice.myPointcut()&quot;)
public void after() &#123;
    System.out.println(&quot;Final Notice&quot;);
&#125;
</code></pre>
<p>}<br>测试</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>@RunWith(SpringRunner.class)<br>@ContextConfiguration(“classpath:applicationContext.xml”)<br>public class AccountTest {</p>
<pre><code>// 配置了aop之后，这就是代理对象
@Autowired
private AccountService accountService;

@Test
public void testAOP() throws Exception&#123;
    accountService.transfer();
&#125;
</code></pre>
<p>}<br>2.2 注解配置详解<br>2.2.1 切点表达式<br>1<br>execution([修饰符] 返回值类型 包名.类名.方法名(参数列表))<br>访问修饰符可以省略<br>返回值类型、包名、类名、方法名可以使用星号 * 代替，代表任意<br>包名与类名之间一个点 . 代表当前包下的类，两个点 .. 表示当前包及其子包下的类<br>参数列表可以使用两个点 .. 表示任意个数，任意类型的参数列表<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>&#x2F;&#x2F;切面类中抽取表达式<br>@Pointcut(“execution(* com.test.service..<em>.</em>(..))”)<br>public void myPointcut(){}</p>
<p>&#x2F;&#x2F;上面代码替代了XML文件中的<br>&lt;aop:pointcut id&#x3D;”myPointcut” expression&#x3D;”execution(* com.test.service..*.*(..))”&#x2F;&gt;</p>
<hr>
<p>  &#x2F;&#x2F;直接调用<br>  @Before(“MyAdvice.myPointcut()”)<br>2.2.2 通知类型<br>四大通知</p>
<p>名称	标签	说明<br>前置通知	@Before	在切入点方法之前执行<br>后置通知	@AfterReturning	在切入点方法正常运行之后执行<br>异常通知	@AfterThrowing	在切点方法发生异常的时候执行<br>最终通知	@After	无论切入点方法执行时是否有异常，都会执行<br>注意:使用注解时，四大通知同时开启的顺序：@Before – &gt; @After –&gt; @AfterReturning(异常则@AfterThrowing)</p>
<p>​ 与XML版本相同，大于等于2个通知时，建议使用环绕通知</p>
<p>环绕通知(强无敌)</p>
<p>名称	标签	说明<br>环绕通知	@Around	可以灵活实现四大通知的所有效果<br>注意：测试时，注释掉四大通知的注解</p>
<p>当切点同时符合切点规则和环绕规则时，顺序：</p>
<p>@Around – &gt;@Before – &gt; @After –&gt; @Around 执行proceedingJoinPoint.proceed()后的动作–&gt; @AfterReturning(异常则@AfterThrowing)</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>&#x2F;&#x2F;通知类(增强)<br>@Component<br>&#x2F;&#x2F;升级为切面<br>@Aspect<br>public class MyAdvice {</p>
<pre><code>@Pointcut(&quot;execution(* com.test.service..*.*(..))&quot;)
public void myPointcut()&#123;&#125;

// 环绕通知
// Proceeding（运行）JoinPoint（连接点）  = 切点
@Around(&quot;MyAdvice.myPointcut()&quot;)
public void around(ProceedingJoinPoint proceedingJoinPoint) &#123;
    try &#123;
        System.out.println(&quot;Advance notice&quot;);
        // 执行切点(调用目标对象原有的方法)
        proceedingJoinPoint.proceed();

        System.out.println(&quot;Post Notification&quot;);
    &#125; catch (Throwable throwable) &#123;
        throwable.printStackTrace();
        System.out.println(&quot;Exception Notification&quot;);
    &#125; finally &#123;
        System.out.println(&quot;Final Notice&quot;);
    &#125;
&#125;
</code></pre>
<p>}<br>2.3 纯注解配置<br>删除Spring的配置文件</p>
<p>写出Spring配置类SpringConfig</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>@Configuration<br>@ComponentScan(“com.test”)<br>@EnableAspectJAutoProxy&#x2F;&#x2F;<a href="aop:aspectj-autoproxy">aop:aspectj-autoproxy</a><br>public class SpringConfig {</p>
<p>}<br>修改测试代码</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>@RunWith(SpringRunner.class)<br>@ContextConfiguration(classes &#x3D; SpringConfig.class)<br>public class AccountTest {</p>
<pre><code>// 配置了aop之后，这就是代理对象
@Autowired
private AccountService accountService;

@Test
public void testAOP() throws Exception&#123;
    accountService.transfer();
&#125;
</code></pre>
<p>}<br>2.4 知识小结<br>使用注解	作用<br>使用@Aspect注解	标注切面类<br>使用@Before等注解	标注通知方法<br>使用@Pointcut注解	抽取切点表达式<br>配置aop自动代理	<a href="aop:aspectj-autoproxy/">aop:aspectj-autoproxy/</a> 或 @EnableAspectJAutoProxy<br>三.AOP优化转账案例<br>需求</p>
<p>依然使用前面的转账案例，将两个代理工厂对象直接删除！改为spring的aop思想来实现</p>
<p>3.1 XML实现<br>新建Java模块，配置依赖</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>59<br>60<br>61<br>62<br>63<br>64<br>65<br>66<br>67<br>68<br>69<br>70<br>71<br>72<br>73<br><?xml version="1.0" encoding="UTF-8"?><br><project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemalocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"><br>    <modelVersion>4.0.0</modelVersion></project></p>
<pre><code>&lt;groupId&gt;com.test&lt;/groupId&gt;
&lt;artifactId&gt;Spring_online_Day04_04_transfer_XML&lt;/artifactId&gt;
&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

&lt;!--依赖管理--&gt;

&lt;dependencies&gt;
    &lt;!--mysql--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;mysql&lt;/groupId&gt;
        &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
        &lt;version&gt;5.1.47&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!--druid--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
        &lt;artifactId&gt;druid&lt;/artifactId&gt;
        &lt;version&gt;1.1.15&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!--dbUtils--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;commons-dbutils&lt;/groupId&gt;
        &lt;artifactId&gt;commons-dbutils&lt;/artifactId&gt;
        &lt;version&gt;1.6&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!--spring核心--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-context&lt;/artifactId&gt;
        &lt;version&gt;5.1.5.RELEASE&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!--aspectj--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.aspectj&lt;/groupId&gt;
        &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;
        &lt;version&gt;1.9.5&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!--junit--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;junit&lt;/groupId&gt;
        &lt;artifactId&gt;junit&lt;/artifactId&gt;
        &lt;version&gt;4.12&lt;/version&gt;
    &lt;/dependency&gt;
    &lt;!--spring整合junit--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;org.springframework&lt;/groupId&gt;
        &lt;artifactId&gt;spring-test&lt;/artifactId&gt;
        &lt;version&gt;5.1.5.RELEASE&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;

&lt;build&gt;
    &lt;plugins&gt;
        &lt;!-- 设置编译版本为1.8 --&gt;
        &lt;plugin&gt;
            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
            &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;
            &lt;version&gt;3.1&lt;/version&gt;
            &lt;configuration&gt;
                &lt;source&gt;1.8&lt;/source&gt;
                &lt;target&gt;1.8&lt;/target&gt;
                &lt;encoding&gt;UTF-8&lt;/encoding&gt;
            &lt;/configuration&gt;
        &lt;/plugin&gt;
    &lt;/plugins&gt;
&lt;/build&gt;
</code></pre>

Domain,Dao层对象

<p>1<br>2<br>3<br>4<br>5<br>6<br>public class Account {<br>    private Integer id;<br>    private String name;<br>    private Double money;</p>
<p>&#x2F;&#x2F;此处省略getter&#x2F;setter&#x2F;toString<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>public interface AccountDao {</p>
<pre><code>//转出
void outUser(String outUser, Double money);

//转入
void inUser(String inUser, Double money);

List&lt;Account&gt; findAll();

//转出
void outUser(Connection connection,String outUser, Double money);

//转入
void inUser(Connection connection,String inUser, Double money);
</code></pre>
<p>}<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>59<br>60<br>61<br>62<br>63<br>64<br>65<br>66<br>67<br>68<br>69<br>70<br>71<br>72<br>73<br>@Repository<br>public class AccountDaoImpl implements AccountDao {</p>
<pre><code>@Autowired
private QueryRunner queryRunner;

@Autowired
private ConnectionUtils connectionUtils;

@Override
public void outUser(String outUser, Double money) &#123;

    try &#123;
        // 1.编写sql
        String sql = &quot;UPDATE account SET money=money-? WHERE name = ?&quot;;
        // 获取当前线程内的 conn
        Connection threadConnection = connectionUtils.getThreadConnection();
        // 2.执行sql
        queryRunner.update(threadConnection,sql, money, outUser);
    &#125; catch (SQLException throwables) &#123;
        throwables.printStackTrace();
    &#125;

&#125;

@Override
public void inUser(String inUser, Double money) &#123;

    try &#123;
        String sql = &quot;UPDATE account SET money=money+? WHERE name = ?&quot;;
        Connection threadConnection = connectionUtils.getThreadConnection();
        queryRunner.update(threadConnection,sql, money, inUser);
    &#125; catch (SQLException throwables) &#123;
        throwables.printStackTrace();
    &#125;
&#125;

@Override
public List&lt;Account&gt; findAll() &#123;

    List&lt;Account&gt; list = null;

    try &#123;
        String sql = &quot;SELECT * FROM account&quot;;
        list=queryRunner.query(sql,new BeanListHandler&lt;&gt;(Account.class));
    &#125; catch (SQLException throwables) &#123;
        throwables.printStackTrace();
    &#125;

    return list;
&#125;

@Override
public void outUser(Connection connection, String outUser, Double money) &#123;

    try &#123;
        String sql = &quot;UPDATE account SET money=money-? WHERE name = ?&quot;;
        queryRunner.update(connection,sql, money, outUser);
    &#125; catch (SQLException throwables) &#123;
        throwables.printStackTrace();
    &#125;
&#125;

@Override
public void inUser(Connection connection, String inUser, Double money) &#123;
    try &#123;
        String sql = &quot;UPDATE account SET money=money+? WHERE name = ?&quot;;
        queryRunner.update(connection,sql, money, inUser);
    &#125; catch (SQLException throwables) &#123;
        throwables.printStackTrace();
    &#125;
&#125;
</code></pre>
<p>}<br>目标对象</p>
<p>1<br>2<br>3<br>4<br>public interface AccountService {<br>    &#x2F;&#x2F;转账<br>    void transfer(String outUser,String inUser,Double money);<br>}<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>@Service<br>public class AccountServiceImpl implements AccountService {</p>
<pre><code>// 依赖AccountDao
@Autowired
private AccountDao accountDao;

@Override
public void transfer(String outUser, String inUser, Double money) &#123;
    accountDao.outUser(outUser,money);
    accountDao.inUser(inUser,money);
&#125;
</code></pre>
<p>}</p>
<p>通知对象</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>59<br>60<br>61<br>62<br>@Component<br>public class TransactionManager {</p>
<pre><code>@Autowired
private ConnectionUtils connectionUtils;

// 1.开启事务
public void beginTransaction()&#123;
    try &#123;
        connectionUtils.getThreadConnection().setAutoCommit(false);
    &#125; catch (SQLException throwables) &#123;
        throwables.printStackTrace();
    &#125;
&#125;

// 2.提交事务
public void commit()&#123;
    try &#123;
        connectionUtils.getThreadConnection().commit();
    &#125; catch (SQLException throwables) &#123;
        throwables.printStackTrace();
    &#125;
&#125;

// 3.回滚事务
public void rollback()&#123;
    try &#123;
        connectionUtils.getThreadConnection().rollback();
    &#125; catch (SQLException throwables) &#123;
        throwables.printStackTrace();
    &#125;
&#125;

// 4.释放资源
public void release()&#123;

    try &#123;
        // 恢复自动提交
        connectionUtils.getThreadConnection().setAutoCommit(true);
        // 归还到连接池
        connectionUtils.getThreadConnection().close();
        // 从当前线程删除conn对象
        connectionUtils.removeThreadConnection();
    &#125; catch (SQLException throwables) &#123;
        throwables.printStackTrace();
    &#125;
&#125;

//环绕通知
public void aroundTx(ProceedingJoinPoint proceedingJoinPoint)&#123;
    try &#123;
        beginTransaction();
        proceedingJoinPoint.proceed();
        commit();
    &#125; catch (Throwable throwable) &#123;
        throwable.printStackTrace();
        rollback();
    &#125; finally &#123;
        release();
    &#125;
&#125;
</code></pre>
<p>}<br>配置xml的切面</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br><?xml version="1.0" encoding="UTF-8"?><br><beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:context="http://www.springframework.org/schema/context" xmlns:aop="http://www.springframework.org/schema/aop" xmlns:p="http://www.springframework.org/schema/p" xsi:schemalocation="
       http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/context
       http://www.springframework.org/schema/context/spring-context.xsd
       http://www.springframework.org/schema/aop
       http://www.springframework.org/schema/aop/spring-aop.xsd"></beans></p>
  <!-- 开启注解组件扫描 -->
<p>  &lt;context:component-scan base-package&#x3D;”com.test”&#x2F;&gt;</p>
  <!-- 加载第三方配置文件 -->
<p>  &lt;context:property-placeholder location&#x3D;”classpath:jdbc.properties”&#x2F;&gt;</p>
  <!--druid连接交给ioc容器,第三方类目前仅能用bean标签-->
  <bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource">
    <property name="driverClassName" value="${jdbc.driver}">
    <property name="url" value="${jdbc.url}">
    <property name="username" value="${jdbc.username}">
    <property name="password" value="${jdbc.password}">
  </property></property></property></property></bean>

  <!--queryRunner交给ioc容器,第三方类目前仅能用bean标签-->
  <bean id="queryRunner" class="org.apache.commons.dbutils.QueryRunner">
    <constructor-arg name="ds" ref="dataSource">
  </constructor-arg></bean>

<p>  <a href="aop:config">aop:config</a><br>    &lt;aop:aspect ref&#x3D;”transactionManager”&gt;<br>      &lt;aop:pointcut id&#x3D;”myPointcut” expression&#x3D;”execution(* com.test.service..*.*(..))”&#x2F;&gt;<br>      &lt;aop:around method&#x3D;”aroundTx” pointcut-ref&#x3D;”myPointcut”&gt;<br>    <br>  <br></p>
<p>测试</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>@RunWith(SpringRunner.class)<br>@ContextConfiguration(“classpath:applicationContext.xml”)<br>public class AccountTest {<br>    @Autowired<br>    private AccountService accountService;</p>
<pre><code>@Test
public void testTransferXML() throws Exception&#123;
    accountService.transfer(&quot;jerry&quot;,&quot;tom&quot;,100.0);
&#125;
</code></pre>
<p>}</p>
<p>3.2 注解实现<br>复制java模块</p>
<p>目标对象</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>@Service<br>public class AccountServiceImpl implements AccountService {</p>
<pre><code>// 依赖AccountDao
@Autowired
private AccountDao accountDao;

@Override
public void transfer(String outUser, String inUser, Double money) &#123;
    accountDao.outUser(outUser,money);
    accountDao.inUser(inUser,money);
&#125;
</code></pre>
<p>}<br>通知对象</p>
<p>1<br>2<br>@Component<br>public class TransactionManager<br>开启AOP注解支持</p>
<p>SpringConfig</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>@Configuration<br>@ComponentScan(“com.test”)<br>@PropertySource(“classpath:jdbc.properties”)<br>@EnableAspectJAutoProxy<br>@Import({DataSourceConfig.class})<br>public class SpringConfig<br>将通知升级为切面</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>@Component<br>@Aspect<br>public class TransactionManager {</p>
<p>  @Autowired<br>  private ConnectionUtils connectionUtils;</p>
<pre><code>  ......
......
......

@Pointcut(&quot;execution(* com.test.service..*.*(..))&quot;)
public void myPointcut()&#123;&#125;
</code></pre>
<p>  &#x2F;&#x2F;环绕通知<br>  @Around(“TransactionManager.myPointcut()”)<br>  public void aroundTx(ProceedingJoinPoint proceedingJoinPoint){<br>    try {<br>      beginTransaction();<br>      proceedingJoinPoint.proceed();<br>      commit();<br>    } catch (Throwable throwable) {<br>      throwable.printStackTrace();<br>      rollback();<br>    } finally {<br>      release();<br>    }<br>  }<br>}<br>测试</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>@RunWith(SpringRunner.class)<br>&#x2F;&#x2F;@ContextConfiguration(“classpath:applicationContext.xml”)<br>@ContextConfiguration(classes &#x3D; SpringConfig.class)<br>public class AccountTest {<br>    @Autowired<br>    private AccountService accountService;</p>
<pre><code>@Test
public void testTransferANNO() throws Exception&#123;
    accountService.transfer(&quot;jerry&quot;,&quot;tom&quot;,100d);
&#125;
</code></pre>
<p>}<br>四.Spring的JdbcTemplate<br>4.1 JdbcTemplate是什么<br>JdbcTemplate是Spring的一款用于简化Dao代码的工具包，它底层封装了JDBC技术。</p>
<p>核心对象</p>
<p>1<br>JdbcTemplate jdbcTemplate &#x3D; new JdbcTemplate(DataSource dataSource);<br>核心方法</p>
<p>方法	作用<br>int update();	执行增、删、改语句<br>List<T> query();	查询多个<br>T queryForObject();	查询一个<br>RowMapper&lt;&gt;();	ORM映射接口<br>new BeanPropertyRowMapper&lt;&gt;();	实现ORM映射封装子类<br>例</T></p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>public class JdbcTemplateTest {<br>  @Test<br>  public void testFindAll() throws Exception {<br>    &#x2F;&#x2F; 创建核心对象<br>    JdbcTemplate jdbcTemplate &#x3D; new JdbcTemplate(JdbcUtils.getDataSource());<br>    &#x2F;&#x2F; 编写sql<br>    String sql &#x3D; “select * from account”;<br>    &#x2F;&#x2F; 执行sql<br>    List<Account> list &#x3D; jdbcTemplate.query(sql, new BeanPropertyRowMapper&lt;&gt; (Account.class));<br>  }<br>}<br>4.2 快速入门<br>创建maven的java模块</Account></p>
<p>导入依赖坐标</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39</p>
<!--依赖管理-->
<dependencies>
    <!--mysql驱动-->
    <dependency>
        <groupId>mysql</groupId>
        <artifactId>mysql-connector-java</artifactId>
        <version>5.1.47</version>
    </dependency>
    <!--druid连接池-->
    <dependency>
        <groupId>com.alibaba</groupId>
        <artifactId>druid</artifactId>
        <version>1.1.15</version>
    </dependency>
    <!--spring-jdbc-->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-jdbc</artifactId>
        <version>5.1.5.RELEASE</version>
    </dependency>
    <!--spring核心-->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-context</artifactId>
        <version>5.1.5.RELEASE</version>
    </dependency>
    <!--junit-->
    <dependency>
        <groupId>junit</groupId>
        <artifactId>junit</artifactId>
        <version>4.12</version>
    </dependency>
    <!--spring整合junit-->
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-test</artifactId>
        <version>5.1.5.RELEASE</version>
    </dependency>
</dependencies>
复制JDBC连接池工具类和配置文件

<p>1<br>public class JdbcUtils<br>编写新增代码</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>public class JdbcTemplateTest {<br>    &#x2F;&#x2F; 新增<br>    @Test<br>    public void testJdbcTemplate() throws Exception{</p>
<pre><code>    // 1.创建JdbcTemplate核心对象
    JdbcTemplate jdbcTemplate = new JdbcTemplate(JdbcUtils.getDataSource());

    // 2.编写sql
    String sql = &quot;INSERT INTO account(name,money) VALUES (?,?)&quot;;

    // 3.执行sql
    int i = jdbcTemplate.update(sql, &quot;testJdbcTemplate&quot;, 1000d);
&#125;
</code></pre>
<p>}<br>查询</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>@RunWith(SpringRunner.class)<br>@ContextConfiguration(“classpath:applicationContext.xml”)<br>public class JdbcTemplateTest {</p>
<pre><code>@Autowired
private AccountService accountService;

// 新增
@Test
public void testJdbcTemplate() throws Exception&#123;

    // 1.创建JdbcTemplate核心对象
    JdbcTemplate jdbcTemplate = new JdbcTemplate(JdbcUtils.getDataSource());

    // 2.编写sql
    String sql = &quot;INSERT INTO account(name,money) VALUES (?,?)&quot;;

    // 3.执行sql
    int i = jdbcTemplate.update(sql, &quot;testJdbcTemplate&quot;, 1000d);
&#125;
</code></pre>
<p>  }<br>4.3 Spring整合JdbcTemplate<br>编写AccountDao</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>public interface AccountDao {</p>
<pre><code>List&lt;Account&gt; findAll();


void save(Account account);
void update(Account account);
void delete(Integer id);
Account findById(Integer id);
</code></pre>
<p>}<br>编写AccountDaoImpl</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41</p>
<p>@Repository<br>public class AccountDaoImpl implements AccountDao {</p>
<pre><code>@Autowired
private JdbcTemplate jdbcTemplate;


@Override
public void save(Account account) &#123;
    String sql = &quot;INSERT INTO account (name, money) VALUES(?,?)&quot;;
    jdbcTemplate.update(sql,account.getName(),account.getMoney());

&#125;

@Override
public void update(Account account) &#123;
    String sql = &quot;UPDATE account SET name = ?,money = ? WHERE id=?&quot;;
    jdbcTemplate.update(sql, account.getName(),account.getMoney(),account.getId());

&#125;

@Override
public void delete(Integer id) &#123;
    String sql = &quot;DELETE FROM account WHERE id = ?&quot;;
    jdbcTemplate.update(sql, id);

&#125;

@Override
public Account findById(Integer id) &#123;
    String sql = &quot;SELECT * FROM account WHERE id = ?&quot;;
    return jdbcTemplate.queryForObject(sql, new BeanPropertyRowMapper&lt;&gt;(Account.class), id);
&#125;

@Override
public List&lt;Account&gt; findAll() &#123;
    String sql = &quot;SELECT * FROM account&quot;;
    return jdbcTemplate.query(sql, new BeanPropertyRowMapper&lt;&gt;(Account.class));
&#125;
</code></pre>
<p>}<br>编写AccountService</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>public interface AccountService {</p>
<pre><code>List&lt;Account&gt; findAll();

void save(Account account);

void update(Account account);

void delete(Integer id);

Account findById(Integer id);
</code></pre>
<p>}<br>编写AccountServiceImpl</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>@Service<br>public class AccountServiceImpl implements AccountService {</p>
<pre><code>@Autowired
private AccountDao accountDao;

@Override
public void save(Account account) &#123;
    accountDao.save(account);
&#125;

@Override
public void update(Account account) &#123;
    accountDao.update(account);
&#125;

@Override
public void delete(Integer id) &#123;
    accountDao.delete(id);
&#125;

@Override
public Account findById(Integer id) &#123;
    return accountDao.findById(id);
&#125;

@Override
public List&lt;Account&gt; findAll() &#123;
    return accountDao.findAll();
&#125;
</code></pre>
<p>}<br>编写Spring的配置文件</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br><?xml version="1.0" encoding="UTF-8"?><br><beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:aop="http://www.springframework.org/schema/aop" xmlns:context="http://www.springframework.org/schema/context" xsi:schemalocation="
       http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd
       http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd"></beans></p>
<pre><code>&lt;!--加载第三方配置文件--&gt;
&lt;context:property-placeholder location=&quot;classpath:jdbc.properties&quot;/&gt;
&lt;!--开启注解组件扫描--&gt;
&lt;context:component-scan base-package=&quot;com.test&quot;/&gt;
&lt;!--druid交给ioc--&gt;
&lt;bean id=&quot;dataSource&quot; class=&quot;com.alibaba.druid.pool.DruidDataSource&quot;&gt;
    &lt;property name=&quot;driverClassName&quot; value=&quot;$&#123;jdbc.driver&#125;&quot;/&gt;
    &lt;property name=&quot;url&quot; value=&quot;$&#123;jdbc.url&#125;&quot;/&gt;
    &lt;property name=&quot;username&quot; value=&quot;$&#123;jdbc.username&#125;&quot;/&gt;
    &lt;property name=&quot;password&quot; value=&quot;$&#123;jdbc.password&#125;&quot;/&gt;
&lt;/bean&gt;

&lt;!--jdbcTemplate交给ioc--&gt;
&lt;bean  id=&quot;jdbcTemplate&quot; class=&quot;org.springframework.jdbc.core.JdbcTemplate&quot;&gt;
    &lt;constructor-arg name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt;
&lt;/bean&gt;
</code></pre>

测试

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>59<br>60<br>61<br>62<br>63<br>64<br>65<br>66<br>67<br>68<br>69<br>70<br>71<br>72<br>@RunWith(SpringRunner.class)<br>@ContextConfiguration(“classpath:applicationContext.xml”)<br>public class JdbcTemplateTest {</p>
<pre><code>@Autowired
private AccountService accountService;


// 新增
@Test
public void testJdbcTemplate() throws Exception&#123;

    // 1.创建JdbcTemplate核心对象
    JdbcTemplate jdbcTemplate = new JdbcTemplate(JdbcUtils.getDataSource());

    // 2.编写sql
    String sql = &quot;INSERT INTO account(name,money) VALUES (?,?)&quot;;

    // 3.执行sql
    int i = jdbcTemplate.update(sql, &quot;testJdbcTemplate&quot;, 1000d);
&#125;

@Test
public void testJdbcFindByID() throws Exception&#123;
    JdbcTemplate jdbcTemplate = new JdbcTemplate(JdbcUtils.getDataSource());

    String sql = &quot;SELECT * FROM account WHERE id = ?&quot;;

    Account account = jdbcTemplate.queryForObject(sql, new BeanPropertyRowMapper&lt;&gt;(Account.class), 5);

    System.out.println(account);
&#125;

@Test
public void testJdbcFindAll() throws Exception&#123;

    List&lt;Account&gt; list = accountService.findAll();

    for (Account account : list) &#123;
        System.out.println(account);
    &#125;
&#125;

@Test
public void testJdbcFindById() throws Exception&#123;

    Account byId = accountService.findById(4);
    System.out.println(byId);
&#125;

@Test
public void testJdbcDelete() throws Exception&#123;
    accountService.delete(4);
&#125;

@Test
public void testJdbcUpdate() throws Exception&#123;
    Account account = new Account();
    account.setId(5);
    account.setName(&quot;K&quot;);
    account.setMoney(100d);
    accountService.update(account);
&#125;

@Test
public void testJdbcCreate() throws Exception&#123;
    Account account = new Account();
    account.setName(&quot;K&quot;);
    account.setMoney(100d);
    accountService.save(account);
&#125;
</code></pre>
<p>}<br>4.4 实现转账案例<br>Spring当时在设计时，就要求事务交给spring控制,因此无法操作自定义的事务管理器</p>
<p>AccountDao</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>public interface AccountDao {</p>
<pre><code>List&lt;Account&gt; findAll();


void outUser(String outUser,Double money);
void inUser(String inUser,Double money);
</code></pre>
<p>}<br>AccountDaoImpl</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>@Repository<br>public class AccountDaoImpl implements AccountDao {</p>
<p>  @Autowired<br>  private JdbcTemplate jdbcTemplate;</p>
<p>  @Override<br>  public void outUser(String outUser, Double money) {<br>    String sql &#x3D; “update account set money &#x3D; money - ? where name &#x3D; ?”;<br>    jdbcTemplate.update(sql,money,outUser);<br>  }</p>
<p>  @Override<br>  public void inUser(String inUser, Double money) {<br>    String sql &#x3D; “update account set money &#x3D; money + ? where name &#x3D; ?”;<br>    jdbcTemplate.update(sql,money,inUser);</p>
<p>  }<br>  @Override<br>  public List<Account> findAll() {<br>    String sql &#x3D; “SELECT * FROM account”;<br>    return jdbcTemplate.query(sql, new BeanPropertyRowMapper&lt;&gt;(Account.class));<br>  }<br>}<br>AccountService</Account></p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>public interface AccountService {</p>
<pre><code>void transfer(String outUser,String inUser,Double money);

List&lt;Account&gt; findAll();
</code></pre>
<p>}<br>AccountServiceImpl</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>@Service<br>public class AccountServiceImpl implements AccountService {</p>
<p>  @Autowired<br>  private AccountDao accountDao;</p>
<p>  @Override<br>  public void transfer(String outUser, String inUser, Double money) {<br>    accountDao.outUser(outUser,money);<br>    accountDao.inUser(inUser,money);<br>  }<br>  @Override<br>  public List<Account> findAll() {<br>    return accountDao.findAll();<br>  }<br>}<br>测试</Account></p>
<p>1<br>2<br>3<br>4<br>@Test<br>public void testJdbcTransfer() throws Exception{<br>    accountService.transfer(“tom”,”jerry”,100d);<br>}<br>五.Spring的事务<br>Spring的事务控制可以分为编程式事务控制和声明式事务控制。</p>
<p>编程式事务</p>
<p>就是将业务代码和事务代码放在一起书写,它的耦合性太高,开发中不使用</p>
<p>声明式事务</p>
<p>将事务代码（spring内置）和业务代码隔离开发, 然后通过一段配置让他们组装运行, 最后达到事务控制的目的.</p>
<p>声明式事务就是通过AOP原理实现的.</p>
<p>5.1 编程式事务<br>5.1.1 Platform TransactionManager<br>spring事务管理器的顶级接口，里面提供了我们常用的操作事务的方法(需要坐标 spring-orm)</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>    <!--spring的orm--><br>    <dependency><br>        <groupId>org.springframework</groupId><br>        <artifactId>spring-orm</artifactId><br>        <version>5.1.5.RELEASE</version><br>    </dependency><br></p>
<p>事务	功能<br>TransactionStatus getTransaction(TransactionDefinition definition);	获取事务的状态信息<br>void commit(TransactionStatus status)；	提交事务<br>void rollback(TransactionStatus status)；	回滚事务<br>5.1.2 TransactionDefinition<br>Spring事务定义参数的接口，例如定义：事务隔离级别、事务传播行为等</p>
<p>事务隔离级别</p>
<p>事务的隔离级别	<br>ISOLATION_DEFAULT	使用数据库默认级别<br>MySQL可重复读;Oracle读已提交<br>ISOLATION_READ_UNCOMMITTED	读未提交<br>ISOLATION_READ_COMMITTED	读已提交<br>ISOLATION_REPEATABLE_READ	可重复读<br>ISOLATION_SERIALIZABLE	串行化<br>事务传播行为</p>
<p>事务传播行为指的就是当一个业务方法 被 另一个业务方法调用时，应该如何进行事务控制。</p>
<p>行为	说明<br>REQUIRED（默认传播行为）	如果当前没有事务，就新建一个事务，如果已经存在一个事务中，加入到这个事务中。<br>如果单独调用方法B时，没有事务，spring就给当前方法创建一个新事物<br>如果方法A中已经存在了事务，调用方法B时，方法B加方法A的事务中<br>SUPPORTS	支持当前事务，如果当前没有事务，就以非事务方式执行<br>如果单独调用方法B时没有事务，咱们就以非事务方法运行<br>如果方法A中已经存在了事务，调用方法B时，方法B加方法A的事务中<br>MANDATORY	使用当前的事务，如果当前没有事务，就抛出异常<br>REQUERS_NEW	新建事务，如果当前在事务中，把当前事务挂起<br>NOT_SUPPORTED	以非事务方式执行操作，如果当前存在事务，就把当前事务挂起<br>NEVER	以非事务方式运行，如果当前存在事务，抛出异常<br>NESTED	如果当前存在事务，则在嵌套事务内执行。如果当前没有事务，则执行 REQUIRED 类似的操作</p>
<p>是否只读</p>
<p>是否只读	<br>read-only	只读事务(增 删 改不能使用,只能查询使用)<br>超时时间</p>
<p>超时时间	<br>timeout	默认值是-1，没有超时限制。如果有，以秒为单位进行设置<br>5.1.3 TransactionStatus<br>获取spring当前事务运行的状态</p>
<p>5.1.4 知识小结<br>Spring中的事务控制主要就是通过这三个API实现的</p>
<p>API	<br>PlatformTransactionManager	负责事务的管理，它是个接口，其子类负责具体工作<br>TransactionDefinition	定义了事务的一些相关参数<br>TransactionStatus	代表事务运行的一个实时状态<br>可以简单的理解三者的关系:事务管理器通过读取事务定义参数进行事务管理，然后会产生一系列的事务状态。</p>
<p>5.2 使用编程式事务<br>5.2.1 配置事务管理器<br>1<br>2<br>3<br>4</p>
<!--事务管理器-->
<p><bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager"> <property name="dataSource" ref="dataSource"><br></property></bean><br>5.2.2 修改service层代码<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>@Service<br>public class xxxServiceImpl implements xxxService{<br>  @Autowired<br>  private PlatformTransactionManager transactionManager;<br>  public void method() {<br>    DefaultTransactionDefinition def &#x3D; new DefaultTransactionDefinition();<br>    &#x2F;&#x2F; 设置是否只读，为false才支持事务<br>    def.setReadOnly(false);<br>    &#x2F;&#x2F; 设置隔离级别<br>    def.setIsolationLevel(TransactionDefinition.ISOLATION_DEFAULT);<br>    &#x2F;&#x2F; 设置事务的传播行为<br>    def.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRED);<br>    &#x2F;&#x2F; 对事务管理器进行配置<br>    TransactionStatus status &#x3D; transactionManager.getTransaction(def);<br>    try {<br>      &#x2F;&#x2F; 业务操作<br>      &#x2F;&#x2F; 提交事务<br>      transactionManager.commit(status);<br>    } catch (Exception e) {<br>      e.printStackTrace(); &#x2F;&#x2F; 回滚事务<br>      transactionManager.rollback(status); }<br>  }<br>}<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>@Service<br>public class AccountServiceImpl implements AccountService {</p>
<pre><code>// 依赖dao
@Autowired
private AccountDao accountDao;

@Override
public List&lt;Account&gt; findAll() &#123;
    return accountDao.findAll();
&#125;


@Autowired
private PlatformTransactionManager transactionManager;

@Override
public void transfer(String outUser, String inUser, Double money) &#123;
    DefaultTransactionDefinition def = new DefaultTransactionDefinition();
    // 设置是否只读，为false才支持事务
    def.setReadOnly(false);
    // 设置隔离级别
    def.setIsolationLevel(TransactionDefinition.ISOLATION_DEFAULT);
    // 设置事务的传播行为
    def.setPropagationBehavior(TransactionDefinition.PROPAGATION_REQUIRED);
    // 对事务管理器进行配置
    TransactionStatus status = transactionManager.getTransaction(def);
    try &#123;
        // 核心业务
        accountDao.outUser(outUser, money);
        // 模拟异常..
        int i = 1/0;
        accountDao.inUser(inUser, money);

        // 提交事务
        transactionManager.commit(status);
    &#125; catch (Exception e) &#123;
        e.printStackTrace();
        // 回滚事务
        transactionManager.rollback(status);
    &#125;
&#125;
</code></pre>
<p>}<br>总结</p>
<h1 id="spring04"><a href="#spring04" class="headerlink" title="spring04"></a>spring04</h1><h2 id="一-基于XML的AOP开发"><a href="#一-基于XML的AOP开发" class="headerlink" title="一 基于XML的AOP开发"></a>一 基于XML的AOP开发</h2><h3 id="aop织入的配置"><a href="#aop织入的配置" class="headerlink" title="aop织入的配置"></a>aop织入的配置</h3><ul>
<li>aop:config</li>
</ul>
<p>​ &lt;aop:aspect ref&#x3D;“通知类”&gt;</p>
<p>​ &lt;aop:before method&#x3D;“通知方法名称” pointcut&#x3D;“切点表达式”&gt;</p>
<p>​</p>
<h3 id="切点表达式"><a href="#切点表达式" class="headerlink" title="切点表达式"></a>切点表达式</h3><ul>
<li>&lt;aop:pointcut id&#x3D;”myPointcut” expression&#x3D;”execution(* com.test.service…(..))”&gt;</li>
</ul>
<h3 id="通知的类型"><a href="#通知的类型" class="headerlink" title="通知的类型"></a>通知的类型</h3><ul>
<li><p>aop:before</p>
</li>
<li><p>aop:after-returning</p>
</li>
<li><p>aop:after-throwing</p>
</li>
<li><p>aop:after</p>
</li>
<li><p>aop:around</p>
</li>
</ul>
<h2 id="二-基于注解的AOP开发"><a href="#二-基于注解的AOP开发" class="headerlink" title="二 基于注解的AOP开发"></a>二 基于注解的AOP开发</h2><h3 id="切面类"><a href="#切面类" class="headerlink" title="切面类"></a>切面类</h3><ul>
<li>@Aspect</li>
</ul>
<p>public class MyAdvice {}</p>
<h3 id="切点表达式-1"><a href="#切点表达式-1" class="headerlink" title="切点表达式"></a>切点表达式</h3><ul>
<li>@Pointcut(“execution(void com.test.service…(..))”)</li>
</ul>
<p>public void myPoint(){}</p>
<h3 id="通知类型"><a href="#通知类型" class="headerlink" title="通知类型"></a>通知类型</h3><ul>
<li><p>@Before</p>
</li>
<li><p>@AfterReturning</p>
</li>
<li><p>@AfterThrowing</p>
</li>
<li><p>@After</p>
</li>
<li><p>@Around</p>
</li>
</ul>
<h3 id="AOP自动代理"><a href="#AOP自动代理" class="headerlink" title="AOP自动代理"></a>AOP自动代理</h3><ul>
<li><p>aop:aspectj-autoproxy&#x2F;</p>
</li>
<li><p>@EnableAspectJAutoProx</p>
</li>
</ul>
<h2 id="三-AOP优化转账案例"><a href="#三-AOP优化转账案例" class="headerlink" title="三 AOP优化转账案例"></a>三 AOP优化转账案例</h2><h3 id="xml配置实现"><a href="#xml配置实现" class="headerlink" title="xml配置实现"></a>xml配置实现</h3><h3 id="注解配置实现"><a href="#注解配置实现" class="headerlink" title="注解配置实现"></a>注解配置实现</h3><h2 id="四-Spring的JdbcTemplate"><a href="#四-Spring的JdbcTemplate" class="headerlink" title="四 Spring的JdbcTemplate"></a>四 Spring的JdbcTemplate</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><ul>
<li><p>JdbcTemplate是Spring的一款用于简化Dao代码的工具，它底层封装了JDBC技术</p>
</li>
<li><p>核心对象</p>
</li>
</ul>
<p>​ - JdbcTemplate jdbcTemplate &#x3D; new JdbcTemplate(DataSource dataSource);</p>
<ul>
<li>核心方法</li>
</ul>
<p>​ - DML</p>
<p>​ - int update();</p>
<p>​ - DQL</p>
<p>​ - List query();</p>
<p>​ - T queryForObject();</p>
<p>​ - 查询ORM映射处理实现类</p>
<p>​ - BeanPropertyRowMapper&lt;&gt;(Class 字节码对象)</p>
<h3 id="Spring整合JdbcTemplate"><a href="#Spring整合JdbcTemplate" class="headerlink" title="Spring整合JdbcTemplate"></a>Spring整合JdbcTemplate</h3><h3 id="实现转账案例"><a href="#实现转账案例" class="headerlink" title="实现转账案例"></a>实现转账案例</h3><ul>
<li>我们发现了无法使用自己定义的事务管理器（LOW）、需要引出spring内置事务管理器</li>
</ul>
<h2 id="五-Spring的事务"><a href="#五-Spring的事务" class="headerlink" title="五 Spring的事务"></a>五 Spring的事务</h2><h3 id="编程式事务控制（了解）"><a href="#编程式事务控制（了解）" class="headerlink" title="编程式事务控制（了解）"></a>编程式事务控制（了解）</h3><ul>
<li><p>开发者直接把事务的代码和业务代码耦合到一起，在实际开发中不用。</p>
</li>
<li><p>相关对象</p>
</li>
</ul>
<p>​ - PlatformTransactionManager</p>
<p>​ - DataSourceTransactionManager</p>
<p>​ - TransactionDefinition</p>
<p>​ - 隔离级别</p>
<p>​ - 传播行为</p>
<p>​ - REQUIRED</p>
<p>​ - SUPPORTS</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/11/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="extend next" rel="next" href="/page/13/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">swzxsyh</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">199</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/swzxsyh" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;swzxsyh" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/swzxsyh" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;swzxsyh" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">swzxsyh</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
