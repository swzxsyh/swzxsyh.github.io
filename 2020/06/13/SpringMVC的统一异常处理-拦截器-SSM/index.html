<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"swzxsyh.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="一.SpringMVC 实现文件上传1.1 目标掌握文件上传的要求 1.2 学习路径文件上传概述文件上传要求常见的文件上传jar包和框架1.3 讲解1.3.1 文件上传概述就是把客户端(浏览器)的文件保存一份到服务器(参考各类云盘)">
<meta property="og:type" content="article">
<meta property="og:title" content="SpringMVC的统一异常处理 &amp; 拦截器 &amp; SSM">
<meta property="og:url" content="https://swzxsyh.github.io/2020/06/13/SpringMVC%E7%9A%84%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86-%E6%8B%A6%E6%88%AA%E5%99%A8-SSM/index.html">
<meta property="og:site_name" content="swzxsyh">
<meta property="og:description" content="一.SpringMVC 实现文件上传1.1 目标掌握文件上传的要求 1.2 学习路径文件上传概述文件上传要求常见的文件上传jar包和框架1.3 讲解1.3.1 文件上传概述就是把客户端(浏览器)的文件保存一份到服务器(参考各类云盘)">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2020-06-12T17:49:59.000Z">
<meta property="article:modified_time" content="2022-08-09T20:40:38.189Z">
<meta property="article:author" content="swzxsyh">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://swzxsyh.github.io/2020/06/13/SpringMVC%E7%9A%84%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86-%E6%8B%A6%E6%88%AA%E5%99%A8-SSM/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>SpringMVC的统一异常处理 & 拦截器 & SSM | swzxsyh</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="swzxsyh" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">swzxsyh</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">--笔记</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-rss">

    <a href="/atom.xml" rel="section"><i class="fa fa-rss fa-fw"></i>RSS</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://swzxsyh.github.io/2020/06/13/SpringMVC%E7%9A%84%E7%BB%9F%E4%B8%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86-%E6%8B%A6%E6%88%AA%E5%99%A8-SSM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="swzxsyh">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="swzxsyh">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          SpringMVC的统一异常处理 & 拦截器 & SSM
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-06-13 01:49:59" itemprop="dateCreated datePublished" datetime="2020-06-13T01:49:59+08:00">2020-06-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-08-10 04:40:38" itemprop="dateModified" datetime="2022-08-10T04:40:38+08:00">2022-08-10</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>一.SpringMVC 实现文件上传<br>1.1 目标<br>掌握文件上传的要求</p>
<p>1.2 学习路径<br>文件上传概述<br>文件上传要求<br>常见的文件上传jar包和框架<br>1.3 讲解<br>1.3.1 文件上传概述<br>就是把客户端(浏览器)的文件保存一份到服务器(参考各类云盘)</p>
<span id="more"></span>

<p>1.3.2 文件上传要求<br>1.3.2.1 浏览器端要求(通用浏览器的要求)<br>表单提交方式 post<br>提供文件上传框(组件) input type&#x3D;”file”<br>表单的enctype属性必须为 multipart&#x2F;form-data<br>1.3.2.2 服务器端要求<br>要使用request.getInputStream()来获取数据</p>
<p>注意:若表单使用了 multipart&#x2F;form-data ,使用原生request.getParameter()去获取参数的时候都为null</p>
<p>通常借助第三方组件(jar, 框架 SpringMVC)实现文件上传.</p>
<p>1.3.2.3 常见的文件上传jar包和框架<br>serlvet3.0<br>commons-fileupload : apache出品的一款专门处理文件上传的工具包<br>struts2(底层封装了:commons-fileupload)<br>SpringMVC(底层封装了:commons-fileupload)<br>1.3.2.4 小结<br>文件上传可以上传文件，或sql文件直接导入数据等等<br>前端三要素 form post, encpt&#x3D;multipart&#x2F;form-data, input type&#x3D;file<br>原生的api处理复杂，使用commons-fileupload可以帮我们简化了开发<br>案例：SpringMVC 传统方式文件上传<br>1.4 需求<br>使用springmvc 完成传统方式文件上传</p>
<p>1.4.1 步骤<br>创建Maven工厂，添加SpringMVC依赖<br>导入commons-fileupload坐标<br>在控制器的方法的形参里面定义和文件相关的变量 MultipartFile<br>存储到服务器<br>配置文件解析器 (commons-file)<br>在springmvc.xml配置文件解析器<br>1.4.2 实现<br>创建Maven工程,添加依赖</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br><dependencies><br>  <!--springMVC核心--><br>  <dependency><br>    <groupId>org.springframework</groupId><br>    <artifactId>spring-webmvc</artifactId><br>    <version>5.1.5.RELEASE</version><br>  </dependency><br>  <!--servlet--><br>  <dependency><br>    <groupId>javax.servlet</groupId><br>    <artifactId>servlet-api</artifactId><br>    <version>2.5</version><br>    <scope>provided</scope><br>  </dependency><br>  <!--jsp--><br>  <dependency><br>    <groupId>javax.servlet</groupId><br>    <artifactId>jsp-api</artifactId><br>    <version>2.0</version><br>    <scope>provided</scope><br>  </dependency></dependencies></p>
  <!--文件上传-->
  <dependency>
    <groupId>commons-fileupload</groupId>
    <artifactId>commons-fileupload</artifactId>
    <version>1.4</version>
  </dependency>


  <dependency>
    <groupId>com.fasterxml.jackson.core</groupId>
    <artifactId>jackson-databind</artifactId>
    <version>2.9.0</version>
  </dependency>

配置web.xml

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br><filter><br>  <filter-name>characterEncodingFilter</filter-name><br>  <filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class><br>  <init-param><br>    <param-name>encoding</param-name><br>    <param-value>utf-8</param-value><br>  </init-param><br>  <init-param><br>    <param-name>forceEncoding</param-name><br>    <param-value>true</param-value><br>  </init-param><br></filter><br><filter-mapping><br>  <filter-name>characterEncodingFilter</filter-name><br>  <url-pattern>&#x2F;*</url-pattern><br></filter-mapping></p>
<!--前端核心控制器-->
<servlet>
  <servlet-name>dispatcherServlet</servlet-name>
  <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
  <init-param>
    <param-name>contextConfigLocation</param-name>
    <param-value>classpath:springmvc.xml</param-value>
  </init-param>
  <!--    启动时加载    -->
  <load-on-startup>1</load-on-startup>
</servlet>
<servlet-mapping>
  <servlet-name>dispatcherServlet</servlet-name>
  <!--  除jsp外的所有      -->
  <url-pattern>/</url-pattern>
</servlet-mapping>
配置springmvc.xml

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15</p>
<!-- 配置spring创建容器时要扫描的包 -->
<p>&lt;context:component-scan base-package&#x3D;”com.test”&gt;</p>
<!-- 配置视图解析器 -->
<bean id="viewResolver" class="org.springframework.web.servlet.view.InternalResourceViewResolver">
  <!--   配置前缀后缀     -->
  <property name="prefix" value="/WEB-INF/pages/"></property>
  <property name="suffix" value=".jsp"></property>
</bean>    

<!-- 处理请求返回json字符串的中文乱码问题 -->
<p><a href="mvc:annotation-driven/">mvc:annotation-driven/</a></p>
<!-- 设置静态资源不过滤 -->
<p><a href="mvc:default-servlet-handler/">mvc:default-servlet-handler/</a><br>导入Utils</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>public class UploadUtils {</p>
<p>  public static String getUUIDName(String fileName){<br>    &#x2F;&#x2F;获取后缀名<br>    int index &#x3D; fileName.lastIndexOf(“.”);<br>    if(index&#x3D;&#x3D;-1){<br>      return UUID.randomUUID().toString().replace(“-“, “”).toUpperCase();<br>    }else{<br>      return UUID.randomUUID().toString().replace(“-“, “”).toUpperCase()+fileName.substring(index);<br>    }<br>  }</p>
<p>  public static String getDir(){<br>    String s&#x3D;”0123456789ABCDEF”;<br>    Random r &#x3D; new Random();<br>    return “&#x2F;“+s.charAt(r.nextInt(16))+”&#x2F;“+s.charAt(r.nextInt(16));<br>  }</p>
<p>}<br>创建前端index.jsp页面</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7</p>
<!-- 要素：enctype ，method -->
<form action="${pageContext.request.contextPath}/upload" enctype="multipart/form-data" method="post">
  <!-- 要素：type="file"  -->
  <input type="file" name="upLoadFile">
  <input name="desc">
  <input type="submit" value="Submit">
</form>
创建FileUploadController控制器

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>@Controller<br>public class FileInputController{</p>
<p>  @RequestMapping(“&#x2F;upload”)<br>  public String upload(HttpServletRequest req,MultipartFile upLoadFile,String desc){<br>    &#x2F;&#x2F;获取原名<br>    String originalFilename &#x3D; upLoadFile.getOriginalFilename();<br>    &#x2F;&#x2F;通过UUID变为唯一<br>    String uuidName &#x3D; UploadUtils.getUUIDName(originalFilename);<br>    &#x2F;&#x2F;获取文件真实存放路径<br>    String realPath &#x3D; req.getSession().getServletContext().getRealPath(“&#x2F;upload”);</p>
<pre><code>//生成新存放目录结构
String dir = UploadUtils.getDir();
//创建保存目录
File savePath = new File(realPath, dir);
if (!savePath.exists()) &#123;
  savePath.mkdirs();
&#125;
//保存文件
upLoadFile.transferTo(new File(savePath, uuidName));

return &quot;success&quot;;
</code></pre>
<p>  }<br>}<br>在springmvc.xml配置文件解析器</p>
<p>注意：</p>
<p>文件上传的解析器 &#x3D;&#x3D;id 是固定的，不能起别的名称&#x3D;&#x3D;，否则无法实现请求参数的绑定。（不光是文件，其他字段也将无法绑定）</p>
<p>1<br>2<br>3<br>4<br>5</p>
<!--配置文件上传解析器-->
<bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver">
  <!-- 设置上传文件的最大尺寸为 5MB --> 
  <property name="maxUploadSize" value="5242880"></property>
</bean>
1.4.3 小结
前端三要素 form post, encpt=multipart/form-data, input type=file
Controller使用MultipartFile接收文件，形参名称必须与 前端中的name 一样，严格大小写
配置使用commons-fileupload
分目录存储
案例：SpringMVC 跨服务器上传
1.5 需求
了解使用springmvc 跨服务器方式的文件上传

<p>1.5.1 分析<br>1.5.2 分服务器的目的<br>服务器分工问题，以及数据安全问题，需要将数据存储到其他服务器，此处使用另一台Tomcat服务器作为数据接收服务器</p>
<p>应用服务器：负责部署我们的应用 (Tomcat,JBOSS等)<br>数据库服务器：运行我们的数据库(Oracle小型机等)<br>缓存和消息服务器：负责处理大并发访问的缓存和消息(MQ等)<br>文件服务器：负责存储用户上传文件的服务器。 (Ceph等)</p>
<p>1.5.3 文件服务器步骤<br>复制一份Tomcat，并更改conf&#x2F;web.xml为非只读</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br><servlet><br>  <servlet-name>default</servlet-name><br>  <servlet-class>org.apache.catalina.servlets.DefaultServlet</servlet-class><br>  <init-param><br>    <param-name>debug</param-name><br>    <param-value>0</param-value><br>  </init-param><br>  <init-param><br>    <param-name>readonly</param-name><br>    <param-value>false</param-value><br>  </init-param><br>  <init-param><br>    <param-name>listings</param-name><br>    <param-value>false</param-value><br>  </init-param><br>  <load-on-startup>1</load-on-startup><br></servlet><br>创建web工程文件服务器的应用(需2台Tomcat，因此需要更改端口)，布署到这个tomcat上来, 创建 upload目录</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>fileUploadServer<br>├── pom.xml<br>└── src<br>    ├── main<br>    │   ├── java<br>    │   ├── resources<br>    │   └── webapp<br>    │       ├── WEB-INF<br>    │       │   └── web.xml<br>    │       └── upload<br>    └── test<br>        └── java<br>1.5.4 实现(使用传统方式文件上传案例)<br>添加添jersey依赖</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br><dependency><br>  <groupId>com.sun.jersey</groupId><br>  <artifactId>jersey-core</artifactId><br>  <version>1.18.1</version><br></dependency><br><dependency><br>  <groupId>com.sun.jersey</groupId><br>  <artifactId>jersey-client</artifactId><br>  <version>1.18.1</version><br></dependency><br>前端页面</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7</p>
<!-- 要素：enctype ，method -->
<form action="${pageContext.request.contextPath}/uploadToRemote" enctype="multipart/form-data" method="post">
  <!-- 要素：type="file"  -->
  <input type="file" name="upLoadFile">
  <input name="desc">
  <input type="submit" value="Submit">
</form>
FileUploadController控制器

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>@RequestMapping(“&#x2F;uploadToRemote”)<br>public String uploadToRemote(HttpServletRequest req, MultipartFile upLoadFile, String desc) throws IOException {<br>    System.out.println(desc);<br>    &#x2F;&#x2F;获取原名<br>    String originalFilename &#x3D; upLoadFile.getOriginalFilename();<br>    &#x2F;&#x2F;通过UUID变为唯一<br>    String uuidName &#x3D; UploadUtils.getUUIDName(originalFilename);<br>    &#x2F;&#x2F; 文件服务器的连接<br>    String url &#x3D; “<a target="_blank" rel="noopener" href="http://localhost:8081/fileUploadServer/upload/&quot;">http://localhost:8081/fileUploadServer/upload/&quot;</a>;<br>    &#x2F;&#x2F; jersey客户端，需要选择jersey的Client<br>    Client client &#x3D; Client.create();<br>    &#x2F;&#x2F; 定位存储的目录, 服务器的地址<br>    WebResource resource &#x3D; client.resource(url + uuidName);<br>    &#x2F;&#x2F; 上传<br>    resource.put(upLoadFile.getBytes());</p>
<pre><code>return &quot;success&quot;;
</code></pre>
<p>}<br>1.6 小结<br>为什么要分服务器存储</p>
<p>安全<br>维护方便<br>服务器性能充分的利用<br>准备文件服务器</p>
<p>准备文件服务器， 复制一份tomcat, 修改conf&#x2F;web.xml 更改只读 为 false<br>创建web工程文件服务器的应用，布署(更改端口), 创建 upload目录<br>修改文件上传代码</p>
<p>使用jersey，上传文件</p>
<p>二.SpringMVC 中的异常处理<br>2.1 目标<br>掌握SpringMVC的统一异常处理</p>
<p>2.2 分析<br>系统中异常包括两类</p>
<p>预期异常：通过捕获异常从而获取异常信息运行时异常<br>RuntimeException：主要通过规范代码开发、测试通过手段减少运行时异常的发生。<br>目前Server中的MVC层均throws Exception，通过SpringMVC前端控制器交由异常处理器进行异常处理</p>
<p>SpringMVC在处理请求过程中出现异常信息交由异常处理器进行处理，自定义异常处理器可以实现一个系统的异常处理逻辑。</p>
<p>步骤</p>
<p>自定义异常类 已知错误。作用：作为已知不符合业务逻辑的继续执行<br>创建异常处理类实现HandlerExceptionResolver接口<br>配置让springMVC使用这个接口<br>测试<br>2.3 代码实现<br>2.3.1 自定义异常类<br>目的: 统一的管理异常, 方便统一管理错误提示语</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>&#x2F;&#x2F;自定义异常类<br>public class SysException extends RuntimeException {<br>  public SysException(String msg){<br>    super(msg);<br>  }<br>}<br>2.3.2 自定义异常处理器<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>&#x2F;&#x2F;全局异常处理<br>public class SysExceptionResolver implements HandlerExceptionResolver {<br>    &#x2F;&#x2F;处理controller往上抛的异常<br>    @Override<br>    public ModelAndView resolveException(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) {<br>        ModelAndView modelAndView &#x3D; new ModelAndView();</p>
<pre><code>    // 对已知道的异常，只要提示信息
    String message=null;

    if(ex instanceof SysException)&#123;
        SysException sysException = (SysException) ex;
        // 自己报错的信息
         message = ex.getMessage();
    &#125;else &#123;
        // 对未知的异常，包装下再返回给页面
        message=&quot;Error,Please Contact Administrator&quot;;
    &#125;
    // 返回给前端的提示信息
    modelAndView.addObject(&quot;message&quot;,message);
    modelAndView.setViewName(&quot;error&quot;);
</code></pre>
<p>&#x2F;&#x2F;        ex.printStackTrace();<br>        return modelAndView;<br>    }<br>}<br>2.3.3 配置异常处理器<br>springmvc.xml</p>
<p>1<br>2</p>
<!--  注册全局异常处理器 由springmvc自动装载 annotation-driven  -->
<bean id="sysExceptionResolver" class="com.test.exception.SysExceptionResolver">
2.3.4 小结
自定义异常：终止已经不符合业务逻辑的继续执行，反馈自定义提示页面
自定义异常继承RuntimeException
全局异常处理器 实现HandlerExceptionResolver接口，对异常封装处理
2.4 扩展异常处理
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
@Controller
public class MyExceptionHandler {


<pre><code>/**
 * ExceptionHandler 获取的是哪种异常，使用这个方法来处理  catch
 * 参数：捕获的异常, 如果运行时抛出的异常与它不匹配，则不会调用这个方法，根据异常的类型来捕获，遵循从小到大
 * model: 数据模型，作用：传递数据给jsp页面
 * @return
 */

@ExceptionHandler(Exception.class)
public String handleException(Exception exception, Model model)&#123;
    model.addAttribute(&quot;message&quot;,&quot;Unknown Error&quot;);
    return &quot;error&quot;;
&#125;
//数字异常
@ExceptionHandler(ArithmeticException.class)
public String handleArithmeticException(ArithmeticException arithmeticException,Model model)&#123;
    model.addAttribute(&quot;message&quot;,&quot;Math Error&quot;);
    return &quot;error&quot;;
&#125;
</code></pre>
<p>}<br>三.SpringMVC 中的拦截器<br>3.1 目标<br>掌握SpringMVC基本使用</p>
<p>3.1.1 学习路径<br>拦截器概述<br>自定义拦截器入门<br>3.1.2 讲解<br>3.1.3 拦截器概述<br>Spring MVC 的处理器拦截器类似于 Servlet 开发中的过滤器 Filter，用于对处理器(自己编写的Controller)进行预处理和后处理。用户可以自己定义一些拦截器来实现特定的功能。</p>
<p>谈到拦截器，还要向大家提一个词——拦截器链（Interceptor Chain）。拦截器链就是将拦截器按一定的顺序联结成一条链。在访问被拦截的方法或字段时，拦截器链中的拦截器就会按其之前定义的顺序被调用。</p>
<p>它和过滤器是有几分相似，但也有区别</p>
<p>类别	使用范围	拦截范围<br>拦截器	SpringMVC项目	只会拦截访问的控制器方法, 可以使用spring容器<br>过滤器	任何web项目	任何资源(servlet,控制器,jsp,html等)， 无法使用Spring容器<br>3.1.4 自定义拦截器入门<br>编写个一测试用的ControllerDemo</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>@Controller<br>public class ControllerDemo {</p>
<pre><code>@RequestMapping(&quot;/demo01&quot;)
public String demo01()&#123;
    System.out.println(&quot;Demo01 By ControllerDemo&quot;);
    return &quot;success&quot;;
&#125;
</code></pre>
<p>}<br>编写一个普通类HandlerInterceptorDemo1实现 HandlerInterceptor 接口</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>public class HandlerInterceptorDemo1 implements HandlerInterceptor{<br>  &#x2F;**<br>     * 前置拦截, 在调用controller的方法前执行<br>     * @return true: 放行， false：阻止<br>     *&#x2F;<br>  @Override<br>  public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {<br>    &#x2F;&#x2F; response 可以重定向， 用户登陆认证(session中不存)<br>    System.out.println(“HandlerInterceptorDemo1.preHandle 执行了”);<br>    return true;<br>  }<br>}<br>在springmvc.xml配置拦截器</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9</p>
<!--配置拦截器-->
<p><a href="mvc:interceptors">mvc:interceptors</a><br>  <!--        interceptor 一个拦截器--><br>  <a href="mvc:interceptor">mvc:interceptor</a><br>    <!--用于指定拦截的路径--><br>    &lt;mvc:mapping path&#x3D;”&#x2F;**”&#x2F;&gt;<br>    <bean id="intercepter01" class="com.test.interceptor.HandlerInterceptorDemo1"></bean><br>  <br><br>3.1.5 小结<br>拦截器，在进入 controller之前拦截。<br>实现HandlerInterceptor接口, preHandler方法， 返回true则可以调用controller方法，false则不会调用controller<br>配置springmvc.xml<br>3.2 目标(进阶版本)<br>掌握自定义拦截器的高级使用</p>
<p>3.2.1 学习路径<br>拦截器的放行<br>拦截后跳转<br>拦截器的路径<br>拦截器的其它方法<br>多个拦截器执行顺序<br>3.2.2 讲解<br>3.2.3 拦截器的放行<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>public class HandlerInterceptorDemo1 implements HandlerInterceptor {<br>  @Override<br>  &#x2F;&#x2F;在达到目标方法之前进行拦截——preHandle<br>  public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {</p>
<pre><code>System.out.println(&quot;HandlerInterceptorDemo1&quot;);
//true放行，false拦截，源码默认放行
return true;
</code></pre>
<p>  }<br>}<br>3.2.4 拦截后跳转<br>拦截器的处理结果</p>
<p>放行： 如果后面还有拦截器就执行下一个拦截器，如果后面没有了拦截器，就执行Controller方法<br>拦截： 但是注意，拦截后也需要返回到一个具体的结果(页面,Controller)<br>在preHandle方法返回false,通过request进行转发,或者通过response对象进行重定向,输出</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>public class Intercepter01 implements HandlerInterceptor {<br>    @Override<br>    &#x2F;&#x2F;在达到目标方法之前执行(拦截的方法)<br>    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {<br>        System.out.println(“preHandle 执行了…”);<br>        &#x2F;&#x2F;转发到拦截后的页面<br>        &#x2F;&#x2F;request.getRequestDispatcher(“&#x2F;intercepter01.jsp”).forward(request,response);<br>        &#x2F;&#x2F;转发到controller<br>        request.getRequestDispatcher(“&#x2F;demo01&#x2F;fun02”).forward(request,response);<br>        return false;&#x2F;&#x2F;返回true放行, 返回false拦截<br>    }<br>3.2.5 拦截器的路径<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br><a href="mvc:interceptors">mvc:interceptors</a><br>  <a href="mvc:interceptor">mvc:interceptor</a><br>    <!-- 指定拦截器  拦截  路径 --><br>    &lt;mvc:mapping path&#x3D;”&#x2F;**”&#x2F;&gt;<br>    <!-- 指定拦截器  放行  路径 --><br>    &lt;mvc:exclude-mapping path&#x3D;”&#x2F;demo&#x2F;fun01”&#x2F;&gt;<br>      <bean id="interceptorDemo1" class="com.test.interceptor.HandlerInterceptorDemo1"><br>   <br><br>3.2.6 拦截器的其它方法<br>afterCompletion 在目标方法完成视图层渲染后执行。</bean></p>
<p>postHandle 在被拦截的目标方法执行完毕获得了返回值后执行。</p>
<p>preHandle 被拦截的目标方法执行之前执行。</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>public class Intercepter01 implements HandlerInterceptor {<br>  @Override<br>  &#x2F;&#x2F;在达到目标方法之前执行(拦截的方法)<br>  public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {<br>    System.out.println(“preHandle 执行了…”);<br>    return true;&#x2F;&#x2F;返回true放行, 返回false拦截<br>  }<br>  @Override<br>  &#x2F;&#x2F;在目标方法执行完成之后,完成页面渲染之前执行<br>  public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable ModelAndView modelAndView) throws Exception {<br>    System.out.println(“postHandle 执行了…”);<br>  }</p>
<p>  @Override<br>  &#x2F;&#x2F;完成页面渲染之后执行<br>  public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, @Nullable Exception ex) throws Exception {<br>    System.out.println(“afterCompletion 执行了…”);<br>  }<br>}<br>3.2.7 多个拦截器执行顺序<br>配置顺序</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17</p>
<!--配置拦截器-->
<p><a href="mvc:interceptors">mvc:interceptors</a><br>  <a href="mvc:interceptor">mvc:interceptor</a><br>    <!--用于指定拦截的路径--><br>    &lt;mvc:mapping path&#x3D;”&#x2F;**”&#x2F;&gt;<br>    <!--用于指定忽略(不拦截的路径)--><br>    &lt;mvc:exclude-mapping path&#x3D;”&#x2F;demo01&#x2F;fun02”&#x2F;&gt;<br>    <bean id="intercepter01" class="com.test.web.interceptor.Intercepter01"></bean><br>  <br>  <a href="mvc:interceptor">mvc:interceptor</a><br>    <!--用于指定拦截的路径--><br>    &lt;mvc:mapping path&#x3D;”&#x2F;**”&#x2F;&gt;<br>    <!--用于指定忽略(不拦截的路径)--><br>    &lt;mvc:exclude-mapping path&#x3D;”&#x2F;demo01&#x2F;fun02”&#x2F;&gt;<br>    <bean id="intercepter02" class="com.test.web.interceptor.Intercepter02"></bean><br>  <br><br>3.2.8 小结<br>拦截器是一个链式模式<br>只有preHandler方法才有返回true 放行，false拦截<br>拦截器的跳转 return false, request转发，response重定向<br>preHandle-&gt;postHandle-&gt;afterCompletion<br>多个执行的顺序与配置文件的顺序有关<br>四.SSM整合环境的准备<br>4.1 目标<br>能够独立准备SSM环境</p>
<p>4.2 步骤<br>创建数据库和表<br>创建Maven工程(war)<br>导入坐标<br>创建实体类<br>拷贝log4J日志到工程<br>4.3 讲解<br>4.3.1 创建数据库和表结构<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>create database ssm;<br>use ssm;<br>create table account(<br>  id int primary key auto_increment,<br>  name varchar(40),<br>  money double<br>)character set utf8 collate utf8_general_ci;</p>
<p>insert into account(name,money) values(‘zs’,1000);<br>insert into account(name,money) values(‘ls’,1000);<br>insert into account(name,money) values(‘ww’,1000);<br>4.3.2 创建Maven工程<br>创建web项目</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>├── SpringMVC_Day02_04_ssm.iml<br>├── pom.xml<br>├── src<br>│   ├── main<br>│   │   ├── java<br>│   │   │   └── com<br>│   │   │       └── test<br>│   │   │           └── dao<br>│   │   │               └── AccountDao.java<br>│   │   ├── resources<br>│   │   │   └── log4j.properties<br>│   │   └── webapp<br>│   │       ├── WEB-INF<br>│   │       │   └── web.xml<br>│   │       └── index.jsp<br>│   └── test<br>│       └── java<br>└── target<br>导入坐标</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br>29<br>30<br>31<br>32<br>33<br>34<br>35<br>36<br>37<br>38<br>39<br>40<br>41<br>42<br>43<br>44<br>45<br>46<br>47<br>48<br>49<br>50<br>51<br>52<br>53<br>54<br>55<br>56<br>57<br>58<br>59<br>60<br>61<br>62<br>63<br>64<br>65<br>66<br>67<br>68<br>69<br>70<br>71<br>72<br>73<br>74<br>75<br>76<br>77<br>78<br>79<br>80<br>81<br>82<br>83<br>84<br>85<br>86<br>87<br>88<br>89<br>90<br>91<br>92<br>93<br>94<br>95<br>96<br>97<br>98<br>99<br>100<br>101<br>102<br>103<br>104<br>105<br>106<br>107<br>108<br>109<br>110<br>111<br><properties><br>        &lt;spring.version&gt;5.0.2.RELEASE&lt;&#x2F;spring.version&gt;<br>        &lt;slf4j.version&gt;1.6.6&lt;&#x2F;slf4j.version&gt;<br>        &lt;log4j.version&gt;1.2.12&lt;&#x2F;log4j.version&gt;<br>              <!-- mysql8 驱动版本坐标 --><br>        &lt;mysql.version&gt;5.1.46&lt;&#x2F;mysql.version&gt;<br>        &lt;mybatis.version&gt;3.4.5&lt;&#x2F;mybatis.version&gt;<br>    </properties><br>    <dependencies><br>        <!-- spring --><br>        <dependency><br>            <groupId>org.aspectj</groupId><br>            <artifactId>aspectjweaver</artifactId><br>            <version>1.6.8</version><br>        </dependency><br>        <dependency><br>            <groupId>org.springframework</groupId><br>            <artifactId>spring-aop</artifactId><br>            <version>${spring.version}</version><br>        </dependency><br>        <dependency><br>            <groupId>org.springframework</groupId><br>            <artifactId>spring-context</artifactId><br>            <version>${spring.version}</version><br>        </dependency><br>        <dependency><br>            <groupId>org.springframework</groupId><br>            <artifactId>spring-web</artifactId><br>            <version>${spring.version}</version><br>        </dependency><br>        <dependency><br>            <groupId>org.springframework</groupId><br>            <artifactId>spring-webmvc</artifactId><br>            <version>${spring.version}</version><br>        </dependency><br>        <dependency><br>            <groupId>org.springframework</groupId><br>            <artifactId>spring-test</artifactId><br>            <version>${spring.version}</version><br>        </dependency><br>        <dependency><br>            <groupId>org.springframework</groupId><br>            <artifactId>spring-tx</artifactId><br>            <version>${spring.version}</version><br>        </dependency><br>        <dependency><br>            <groupId>org.springframework</groupId><br>            <artifactId>spring-jdbc</artifactId><br>            <version>${spring.version}</version><br>        </dependency><br>        <dependency><br>            <groupId>junit</groupId><br>            <artifactId>junit</artifactId><br>            <version>4.12</version><br>            <scope>compile</scope><br>        </dependency><br>        <dependency><br>            <groupId>mysql</groupId><br>            <artifactId>mysql-connector-java</artifactId><br>            <version>${mysql.version}</version><br>        </dependency><br>        <dependency><br>            <groupId>javax.servlet</groupId><br>            <artifactId>servlet-api</artifactId><br>            <version>2.5</version><br>            <scope>provided</scope><br>        </dependency><br>        <dependency><br>            <groupId>javax.servlet.jsp</groupId><br>            <artifactId>jsp-api</artifactId><br>            <version>2.0</version><br>            <scope>provided</scope><br>        </dependency><br>        <dependency><br>            <groupId>jstl</groupId><br>            <artifactId>jstl</artifactId><br>            <version>1.2</version><br>        </dependency><br>        <!-- log start --><br>        <dependency><br>            <groupId>log4j</groupId><br>            <artifactId>log4j</artifactId><br>            <version>${log4j.version}</version><br>        </dependency><br>        <dependency><br>            <groupId>org.slf4j</groupId><br>            <artifactId>slf4j-api</artifactId><br>            <version>${slf4j.version}</version><br>        </dependency><br>        <dependency><br>            <groupId>org.slf4j</groupId><br>            <artifactId>slf4j-log4j12</artifactId><br>            <version>${slf4j.version}</version><br>        </dependency><br>        <!-- log end --><br>        <dependency><br>            <groupId>org.mybatis</groupId><br>            <artifactId>mybatis</artifactId><br>            <version>${mybatis.version}</version><br>        </dependency><br>        <dependency><br>            <groupId>org.mybatis</groupId><br>            <artifactId>mybatis-spring</artifactId><br>            <version>1.3.0</version><br>        </dependency><br>        <dependency><br>            <groupId>com.alibaba</groupId><br>            <artifactId>druid</artifactId><br>            <version>1.0.16</version><br>        </dependency><br>    </dependencies><br>编写实体类</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>public class Account implements Serializable {</p>
<p>  private Integer id;<br>  private String name;<br>  private double money;<br>  &#x2F;&#x2F;省略getter&#x2F;setter，toString<br>}<br>拷贝log4J配置文件到工程</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>##\u8bbe\u7f6e\u65e5\u5fd7\u8bb0\u5f55\u5230\u63a7\u5236\u53f0\u7684\u65b9\u5f0f<br>log4j.appender.std&#x3D;org.apache.log4j.ConsoleAppender<br>log4j.appender.std.Target&#x3D;System.out<br>log4j.appender.std.layout&#x3D;org.apache.log4j.PatternLayout<br>log4j.appender.std.layout.ConversionPattern&#x3D;%d{yyyy-MM-dd HH:mm:ss} %5p %c{1}:%L - %m%n<br>##\u8bbe\u7f6e\u65e5\u5fd7\u8bb0\u5f55\u5230\u6587\u4ef6\u7684\u65b9\u5f0f<br>log4j.appender.file&#x3D;org.apache.log4j.FileAppender<br>log4j.appender.file.File&#x3D;d:&#x2F;mylog.log<br>log4j.appender.file.layout&#x3D;org.apache.log4j.PatternLayout<br>log4j.appender.file.layout.ConversionPattern&#x3D;%d{ABSOLUTE} %5p %c{1}:%L - %m%n<br>##\u65e5\u5fd7\u8f93\u51fa\u7684\u7ea7\u522b\uff0c\u4ee5\u53ca\u914d\u7f6e\u8bb0\u5f55\u65b9\u6848<br>log4j.rootLogger&#x3D;debug,std<br>五.Spring整合SpringMVC<br>5.1 目标(初始版本——SpringMVC独立运行)<br>5.2 步骤<br>创建AccountController, 定义方法 添加注解<br>创建springmvc.xml(开启包扫描, 注册视图解析器,忽略静态资源, 注解驱动)<br>配置web.xml(前端控制器, 编码过滤器)<br>测试<br>5.3 实现<br>创建AccountController.java</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>@Controller<br>@RequestMapping(“&#x2F;account”)<br>public class AccountController{<br>  @RequestMapping(“&#x2F;findAll”)<br>  public String findAll(){<br>    System.out.println(“Find All”);<br>    return “list”;<br>  }<br>}<br>创建springmvc.xml配置文件</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br>28<br><?xml version="1.0" encoding="UTF-8"?><br><beans xmlns="http://www.springframework.org/schema/beans" xmlns:mvc="http://www.springframework.org/schema/mvc" xmlns:context="http://www.springframework.org/schema/context" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemalocation="
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd"></beans></p>
<pre><code>&lt;!--开启包扫描--&gt;
&lt;context:component-scan base-package=&quot;com.test&quot;&gt;&lt;/context:component-scan&gt;

&lt;!--配置视图解析器--&gt;
&lt;bean class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;
    &lt;!--   配置前缀后缀     --&gt;
    &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/pages/&quot;&gt;&lt;/property&gt;
    &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;&gt;&lt;/property&gt;
&lt;/bean&gt;
&lt;!--配置注解驱动支持--&gt;
&lt;mvc:annotation-driven&gt;&lt;/mvc:annotation-driven&gt;
  
&lt;!--  静态资源过滤  --&gt;
&lt;mvc:default-servlet-handler/&gt;
</code></pre>

在web.xml里面配置前端控制器

<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>25<br>26<br>27<br><servlet><br>  <servlet-name>springmvc</servlet-name><br>  <servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class><br>  <init-param><br>    <param-name>contextConfigLocation</param-name><br>    <param-value>classpath:springmvc.xml</param-value><br>  </init-param><br>  <load-on-startup>1</load-on-startup><br></servlet><br><servlet-mapping><br>  <servlet-name>springmvc</servlet-name><br>  <url-pattern>&#x2F;</url-pattern><br></servlet-mapping></p>
<!--编码过滤器-->
<filter>
  <filter-name>CharacterEncodingFilter</filter-name>
  <filter-class>org.springframework.web.filter.CharacterEncodingFilter</filter-class>
  <init-param>
    <param-name>encoding</param-name>
    <param-value>UTF-8</param-value>
  </init-param>
</filter>
<filter-mapping>
  <filter-name>CharacterEncodingFilter</filter-name>
  <url-pattern>/*</url-pattern>
</filter-mapping>
5.4 小结
创建Controller, 创建方法 添加注解
创建springmvc.xml(开启包扫描, 注册视图解析器,忽略静态资源,开启注解驱动)
配置web.xml(前端控制器, 编码过滤器)
5.5 目标(进阶版本——注入业务层)
5.6 步骤
注册Service
在Controller里面注入Service
5.7 实现
编写AccountService.java

<p>1<br>2<br>3<br>public interface AccountService{<br>  List<Account> findAll();<br>}<br>编写AccountServiceImpl.java</Account></p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>@service<br>public class AccountServiceImpl implements AccountService{<br>  @Override<br>  public List<Account> findAll(){<br>    System.out.println(“Find All By AccountServiceImpl”);<br>    return null;<br>  }<br>}<br>在AccountController调用AccountService</Account></p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>@Controller<br>@Requestmapping(“&#x2F;account”)<br>public class AccountController{<br>  @Autowired AccountService accountService;</p>
<p>  @Requestmapping(“&#x2F;findAll”){<br>    System.out.println(“Find All By AccountServiceImpl”);<br>        List<Account> list &#x3D; accountService.findAll();<br>    return “list”;<br>  }<br>}<br>5.8 小结<br>创建业务接口与实现类<br>在实现类上加@Service 把交给spring容器管理<br>AccountController 注入进来 @Autowired, 调用业务方法<br>六.Spring整合MyBatis<br>6.1 目标(初始版本——MyBatis独立运行)<br>6.1.1 步骤<br>创建Dao接口, 定义方法, 添加注解<br>创建SqlMapConfig.xml<br>编写Java代码测试<br>6.1.2 实现<br>创建AccountDao.java, 添加注解</Account></p>
<p>1<br>2<br>3<br>4<br>public interface AccountDao{<br>  @Select(“SELECT * FROM account”)<br> List<Account> findAll();<br>}<br>编写MyBatis核心配置文件:SqlMapConfig.xml</Account></p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br><?xml version="1.0" encoding="UTF-8" ?><br><!DOCTYPE configuration
        PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-config.dtd"><br><configuration><br>  <environments default="development"><br>    <environment id="development"><br>      <transactionManager type="JDBC"><br>      <dataSource type="POOLED"><br>        <property name="driver" value="com.mysql.jdbc.Driver"><br>        <property name="url" value="jdbc:mysql://localhost:3306/ssm"><br>        <property name="username" value="root"><br>        <property name="password" value="123456"><br>      </property></property></property></property></dataSource><br>    </transactionManager></environment><br>  </environments><br>  <mappers><br>    <package name="com.test.dao"></package><br>  </mappers><br></configuration><br>测试运行结果</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>public class DaoTest {</p>
<p>  @Test<br>  public void DaoTest() throws Exception{<br>    &#x2F;&#x2F; 创建工厂对象<br>    SqlSessionFactory sqlSessionFactory &#x3D; new SqlSessionFactoryBuilder().build(Resources.getResourceAsStream(“SqlMapConfig.xml”));</p>
<pre><code>SqlSession sqlSession = sqlSessionFactory.openSession();

AccountDao accountDao = sqlSession.getMapper(AccountDao.class);

List&lt;Account&gt; list = accountDao.findAll();

for (Account account : list) &#123;
  System.out.println(account);
&#125;

sqlSession.close();
</code></pre>
<p>  }<br>}<br>6.1.3 小结<br>创建Dao接口, 定义方法, 添加注解<br>创建SqlMapConfig.xml<br>编写Java测试代码<br>6.2 目标(进阶版本——注解版本)<br>6.2.1 分析<br>问题	优化方式<br>连接池还是用的MyBatis自带的	用第三方的连接池,通过Spring管理<br>SqlSessionFactory还是我们自己构建的	通过Spring管理SqlSessionFactory<br>扫描Dao还是由MyBatis加载的	通过Spring扫描Dao<br>事务还是由MyBatis管理	通过Spring管理事务<br>6.2.2 步骤<br>创建applicationContext.xml<br>注册DataSource(配置四个基本项)<br>注册SqlSessionFactory<br>扫描Dao接口<br>配置事务<br>加载applicationContext.xml<br>6.2.3 实现<br>把SqlSessionFactory交给Spring管理,也就意味着把 mybatis 配置文件（SqlMapConfig.xml）中内容配置到 spring 配置文件中同时，把 mybatis 配置文件的内容清掉。<br>使用Spring管理事务<br>6.2.3.1 Spring 接管MyBatis的Session工厂<br>创建applicationContext.xml</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15</p>
<!--  数据源  -->
<bean id="dataSource" class="com.alibaba.druid.pool.DruidDataSource">
  <property name="driverClassName" value="com.mysql.jdbc.Driver"></property>
  <property name="url" value="jdbc:mysql://localhost:3306/ssm"></property>
  <property name="username" value="root"></property>
  <property name="password" value="root"></property>
</bean>
<!--  sqlsessionFactory交给spring来创建  -->
<bean class="org.mybatis.spring.SqlSessionFactoryBean">
  <property name="dataSource" ref="dataSource"></property>
</bean>
<!--  扫描dao接口 dao已经进入spring 容器了  -->
<bean class="org.mybatis.spring.mapper.MapperScannerConfigurer">
  <property name="basePackage" value="com.test.dao">
</property></bean>
注意:

<p>由于我们使用的是代理 Dao 的模式， Dao 具体实现类由 MyBatis 使用代理方式创建，所以此时 mybatis配置文件不能删。</p>
<p>6.2.3.2 配置 spring 的事务<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22</p>
<!--  事务管理器  -->
<bean id="transactionManager" class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
  <property name="dataSource" ref="dataSource">
</property></bean>
<!--  注解声明式事务  -->
<tx:annotation-driven transaction-manager="transactionManager">

<p>&lt;tx:advice id&#x3D;”advice” transaction-manager&#x3D;”transactionManager”&gt;<br>  <a href="tx:attributes">tx:attributes</a><br>    &lt;tx:method name&#x3D;”add*” propagation&#x3D;”REQUIRED” rollback-for&#x3D;”java.lang.Exception” isolation&#x3D;”DEFAULT”&#x2F;&gt;<br>    &lt;tx:method name&#x3D;”save*” propagation&#x3D;”REQUIRED” rollback-for&#x3D;”java.lang.Exception” isolation&#x3D;”DEFAULT”&#x2F;&gt;<br>    &lt;tx:method name&#x3D;”update*” propagation&#x3D;”REQUIRED” rollback-for&#x3D;”java.lang.Exception” isolation&#x3D;”DEFAULT”&#x2F;&gt;<br>    &lt;tx:method name&#x3D;”delete*” propagation&#x3D;”REQUIRED” rollback-for&#x3D;”java.lang.Exception” isolation&#x3D;”DEFAULT”&#x2F;&gt;<br>    <!--    read-only: true 不需要事务        --><br>    &lt;tx:method name&#x3D;”*” read-only&#x3D;”true”&#x2F;&gt;<br>  <br></p>
<!--  切面  -->
<p><a href="aop:config">aop:config</a><br>  &lt;aop:pointcut id&#x3D;”mypoint” expression&#x3D;”execution(* com.test.service..*.*(..))”&#x2F;&gt;<br>  &lt;aop:advisor advice-ref&#x3D;”advice” pointcut-ref&#x3D;”mypoint”&#x2F;&gt;<br><br>6.2.3.3 加载applicationContext.xml<br>方式一:直接把applicationContext.xml里面的配置定义在springmvc.xml</p>
<p>方式二:更改名称，用通配符导入</p>
<p>1<br>2<br>3<br>4<br>5</p>
<!--初始化参数:加载配置文件-->
<init-param>
  <param-name>contextConfigLocation</param-name>
  <param-value>classpath:applicationContext*.xml</param-value>
</init-param>
方式三: 在springmvc.xml 引入applicationContext.xml

<p>applicationContext.xml已经写完了, 但是发现并没有被加载,也就意味着Spring整合MyBatis的部分并没有生效. 其实我们在Spring整合SpringMVC时候, 当服务器启动的时候已经加载过springmvc.xml, spring容器也就会被初始化. 我们可以通过import标签把applicationContext.xml导入到springmvc.xml中一起加载.</p>
<p>1<br><import resource="classpath:applicationContext.xml"></import><br>6.2.3.4 测试SSM整合结果<br>6.2.3.4.1 查询所有展示页面<br>AccountController.java</p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>@Controller<br>@Requestmapping(“&#x2F;account”)<br>public class AccountController{</p>
<p>  @Autowired<br>  private AccountService accountService;</p>
<p>  @Requestmapping(“&#x2F;findAll”)<br>  public String findAll(Model model){<br>        List<Account> list &#x3D; accountService.findAll();<br>    model.addAttribute(“list”,list)<br>    return “list”;<br>  }<br>}<br>AccountServiceImpl.java</Account></p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>@service<br>public class AccountServiceImpl implements AccountService{<br>  @Autowired<br>  private AccountDao accountDao;</p>
<p>  @Override<br>  public List<Account> findAll(){<br>    return accountDao.findAll();<br>  }<br>}<br>AccountDao.java</Account></p>
<p>1<br>2<br>3<br>4<br>5<br>public interface AccountDao{</p>
<p>  @Select(“SELECT * FROM account”)<br>  List<Account> findAll();<br>}<br>前端list.jsp页面</Account></p>
<p>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>10<br>11<br>12<br>13<br>14<br>15<br>16<br>17<br>18<br>19<br>20<br>21<br>22<br>23<br>24<br>&lt;%@ taglib prefix&#x3D;”c” uri&#x3D;”<a target="_blank" rel="noopener" href="http://java.sun.com/jsp/jstl/core&quot;">http://java.sun.com/jsp/jstl/core&quot;</a> %&gt;<br>&lt;%@ page contentType&#x3D;”text&#x2F;html;charset&#x3D;UTF-8” language&#x3D;”java” %&gt;</p>
<html>
  <head>
    <title>Title</title>
  </head>
  <body>
    <table>
      <tr>
        <td>ID</td>
        <td>Name</td>
        <td>Money</td>
      </tr>
      <c:forEach items="${list}" var="account">
        <tr>
          <td>${account.id}</td>
          <td>${account.name}</td>
          <td>${account.money}</td>
        </tr>
      </c:forEach>
    </table>
  </body>
</html>

<p>6.2.3.4.2 添加账户<br>index.jsp页面</p>
<p>1<br>2<br>3<br>4<br>5</p>
<form action="${pageContext.request.contextPath}/account/add">
    Name:<input name="name">
    Money<input name="money">
    <input type="submit" value="Submit">
</form>
AccountController.java

<p>1<br>2<br>3<br>4<br>5<br>@Requestmapping(“&#x2F;add”)<br>public String add(Account account){<br>  accountService.add(account);<br>  return “redirect:&#x2F;account&#x2F;findAll”<br>}<br>AccountService</p>
<p>1<br>2<br>3<br>4<br>5<br>public interface AccountService{<br>  List<Account> findAll();</Account></p>
<p>  void add(Account account);<br>}<br>AccountServiceImpl.java</p>
<p>1<br>2<br>3<br>4<br>@Override<br>public void add(Account account){<br>  accountDao.add(account);<br>}<br>AccountDao.java</p>
<p>1<br>2<br>@Insert(“INSERT INTO account(name,money) VALUES(#{name},#{money})”)<br>void add(Account account);<br>6.2.4 总结<br>SpringMVC</p>
<p>创建Controller, @RequestMapping, @Controller<br>springmvc.xml<br>扫controller<br>视图解析器<br>资源过滤<br>注解驱动<br>web.xml<br>编码过滤器 filter CharacterEncodingFilter<br>前端核心控制器 DispatcherServlet<br>整合spring业务注入</p>
<p>创建service接口与实现类<br>实现类上加@Service<br>Controller通过@Autowired注入业务，controller中的方法，调用业务层<br>初级版本(MyBatis独立运行)</p>
<p>创建dao接口 注解方法<br>创建SqlMapConfig.xml 配置数据源，扫包<br>测试<br>spring整合mybatis</p>
<p>创建applicationContext.xml<br>注册DataSource(配置四个基本项)<br>注册SqlSessionFactory<br>扫描Dao接口<br>配置事务 advice aop, tx:annotation-driven<br>注意：</p>
<p>applicationContext.xml导入到springmvc.xml</p>
</tx:annotation-driven></bean>
    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/06/12/SpringMVC-%E5%85%A5%E9%97%A8/" rel="prev" title="SpringMVC 入门">
      <i class="fa fa-chevron-left"></i> SpringMVC 入门
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/06/15/Maven-Git/" rel="next" title="Maven & Git">
      Maven & Git <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">swzxsyh</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">202</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/swzxsyh" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;swzxsyh" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/swzxsyh" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;swzxsyh" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
      <span class="links-of-author-item">
        <a href="/atom.xml" title="RSS → &#x2F;atom.xml"><i class="fa fa-rss fa-fw"></i>RSS</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">swzxsyh</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '713a28a3ad93f2aa2323',
      clientSecret: '39dc40bb09b422ca4c99a748b5984a4d205e91be',
      repo        : 'swzxsyh.github.io',
      owner       : 'swzxsyh',
      admin       : ['swzxsyh'],
      id          : '988607ac5a4392eddc8dc62287833c4c',
        language: 'zh-CN',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
